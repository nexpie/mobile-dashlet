function DialogBox(e,t,i,n,a){const s=200,o=$('<div id="modal_overlay" style="display:none;"></div>');var r=$('<div class="modal"></div>'),t=$(`<header><h1 class="title">${t} Settings</h1></header>`).appendTo(r);$("<section></section>").appendTo(r).append(e);let l;(i||n)&&(e=$("<footer></footer>").appendTo(r),l=$('<div class="button-container"></div>').appendTo(e));const d=()=>{freeboard.emit("widget_edit_cancel"),c()};e=()=>{_.isFunction(a)&&a()||(freeboard.emit("widget_edit_ok"),c())};const c=()=>{o.fadeOut(s,function(){$(this).remove()}),freeboard.emit("exit_widget_edit_mode"),freeboard.off("exit_edit_mode",d),freeboard.off("force_dialog_box_cancel"),freeboard.off("force_dialog_box_ok")};n&&($(`<span id="dialog-cancel" class="button button-secondary">${n}</span>`).appendTo(l).click(d),$('<button class="button button-no-border"><i class="fa fa-close"></i></button>').appendTo(t).click(d)),i&&$(`<span id="dialog-ok" class="button button-primary">${i}</span>`).appendTo(l).click(e),window.addEventListener("click",e=>{e.target.id===o.attr("id")&&d()}),o.append(r),$("body").append(o),o.fadeIn(100),freeboard.emit("enter_widget_edit_mode"),freeboard.once("exit_edit_mode",d),freeboard.once("force_dialog_box_cancel",c),freeboard.once("force_dialog_box_ok",e)}function ConfirmModal(e,t,i,n,a,s){const o=200;var r={success:{color:"#48bb78",icon:"./img/success.svg"},warning:{color:"#ecc94b",icon:"./img/warning.svg"},error:{color:"#f56565",icon:"./img/warning.svg"}}[s]||{color:"#4a5568",icon:""};const l=$('<div id="modalOverlay" class="cf-modal-overlay" style="display:none;"></div>');var d=$('<div class="cf-modal"></div>'),c=$(`<div id="modalIconWrapper" class="cf-modal-icon-wrapper cf-modal-icon-background" style="background-color: ${r.color||"#4a5568"}"></div>`),r=$(`<img class="cf-modal-icon" src='${r.icon}' alt="icon" />`),r=(c.append(r),$(`<h2 id="modalTitle" class="cf-modal-title">${e}</h2>`)),e=$(`<p id="modalDescription" class="cf-modal-text">${t}</p>`),t=$('<div class="cf-modal-button-group"></div>');d.append(c,r,e,t);const h=()=>{freeboard.emit("widget_edit_cancel"),u()};c=()=>{_.isFunction(a)&&a()||(freeboard.emit("widget_edit_ok"),u())};const u=()=>{l.fadeOut(o,function(){$(this).remove()}),freeboard.emit("exit_widget_edit_mode"),freeboard.off("exit_edit_mode",h),freeboard.off("force_dialog_box_cancel"),freeboard.off("force_dialog_box_ok")};r=$(`<button id="cancelButton" class="cf-modal-button cf-modal-button-gray">${n||"Cancel"}</button>`).click(h),e=$(`<button id="confirmButton" class="cf-modal-button ${s?"cf-modal-button-"+s:""}">${i||"Confirm"}</button>`).click(c);t.append(r,e),window.addEventListener("click",e=>{e.target.id===l.attr("id")&&h()}),l.append(d),$("body").append(l),l.addClass("show"),l.fadeIn(100),freeboard.emit("enter_widget_edit_mode"),freeboard.once("exit_edit_mode",h),freeboard.once("force_dialog_box_cancel",u),freeboard.once("force_dialog_box_ok",c)}function FreeboardModel(a,s,o){var r=this;this.version=0,this.isEditing=ko.observable(!1),this.allow_edit=ko.observable(!1),this.allow_edit.subscribe(function(e){e?$("#main-header").show():$("#main-header").hide()}),this.setting={},this.header_image=ko.observable(),this.plugins=ko.observableArray(),this.datasources=ko.observableArray(),this.panes=ko.observableArray(),this.datasourceData={},this.messageHandler={},this.postcallback=null,this.processDatasourceUpdate=function(e,t,i){var n=e.name();r.datasourceData[n]=t,_.each(r.panes(),function(e){_.each(e.widgets(),function(e){e.processDatasourceUpdate(n,i)})}),r.postcallback(JSON.stringify({event:"DATA_UPDATED",data:String(Date.now())}))},this._datasourceTypes=ko.observable(),this.datasourceTypes=ko.computed({read:function(){r._datasourceTypes();var n=[];return _.each(a,function(e){var t=e.type_name,i=t;_.isUndefined(e.display_name)||(i=e.display_name),n.push({name:t,display_name:i})}),n}}),this._widgetTypes=ko.observable(),this.widgetTypes=ko.computed({read:function(){r._widgetTypes();var n=[];return _.each(s,function(e){var t=e.type_name,i=t;_.isUndefined(e.display_name)||(i=e.display_name),n.push({name:t,display_name:i})}),n}}),this.addPluginSource=function(e){e&&-1==r.plugins.indexOf(e)&&r.plugins.push(e)},this.serialize=function(){var t=[],i=(_.each(r.panes(),function(e){t.push(e.serialize())}),[]);return _.each(r.datasources(),function(e){i.push(e.serialize())}),{version:1,header_image:r.header_image(),allow_edit:r.allow_edit(),plugins:r.plugins(),panes:t,datasources:i,columns:o.getUserColumns()}},this.clonePane=function(e){freeboard.setConfigUnsaved(!0);var t,i=e.serialize();for(t in i.id=Math.random().toString(36).substring(2,8),i.widgets)i.widgets[t].id=Math.random().toString(36).substring(2,8);e=new PaneModel(r,s);e.deserialize(i),r.panes.push(e)},this.deserialize=function(t,i){function e(){o.setUserColumns(t.columns),_.isUndefined(t.allow_edit)?r.allow_edit(!0):r.allow_edit(t.allow_edit),r.version=t.version||0,r.header_image(t.header_image),_.each(t.datasources,function(e){var t=new DatasourceModel(r,a);t.setPostMessageCallback(r.postcallback),t.deserialize(e),r.addDatasource(t)});var e=_.sortBy(t.panes,function(e){return o.getPositionForScreenSize(e).row});_.each(e,function(e){var t=new PaneModel(r,s);t.deserialize(e),r.panes.push(t)}),r.allow_edit()&&0==r.panes().length&&r.setEditing(!0),_.isFunction(i)&&i(),o.processResize(!0)}r.clearDashboard(),_.each(t.plugins,function(e){r.addPluginSource(e)}),_.isArray(t.plugins)&&0<t.plugins.length?head.js(t.plugins,function(){e()}):e()},this.clearDashboard=function(e){o.removeAllPanes(),e&&_.each(r.datasources(),function(e){e.dispose(),delete e}),_.each(r.panes(),function(e){e.dispose()}),r.plugins.removeAll(),e&&r.datasources.removeAll(),r.panes.removeAll()},this.loadDashboard=function(e,t){o.showLoadingIndicator(!0),r.deserialize(e,function(){o.showLoadingIndicator(!1),_.isFunction(t)&&t(),freeboard.emit("dashboard_loaded"),freeboard.setConfigUnsaved(!1)})},this.loadDashboardFromLocalFile=function(){var e;window.File&&window.FileReader&&window.FileList&&window.Blob?((e=document.createElement("input")).type="file",$(e).on("change",function(e){var t,e=e.target.files;e&&0<e.length&&(e=e[0],(t=new FileReader).addEventListener("load",function(e){e=e.target,e=JSON.parse(e.result);o.showLoadingIndicator(!0),r.deserialize(e,function(){o.showLoadingIndicator(!1),freeboard.emit("dashboard_loaded"),freeboard.setConfigUnsaved(!0)}),r.setEditing(!1)}),t.readAsText(e))}),$(e).trigger("click")):alert("Unable to load a file in this browser.")},this.addDatasource=function(e){r.datasources.push(e)},this.deleteDatasource=function(e){delete r.datasourceData[e.name()],e.dispose(),r.datasources.remove(e)},this.createPane=function(){freeboard.setConfigUnsaved(!0);var e=new PaneModel(r,s);r.addPane(e)},this.addGridColumnLeft=function(){o.addGridColumnLeft()},this.addGridColumnRight=function(){o.addGridColumnRight()},this.subGridColumnLeft=function(){o.subGridColumnLeft()},this.subGridColumnRight=function(){o.subGridColumnRight()},this.addPane=function(e){r.panes.push(e)},this.deletePane=function(e){freeboard.setConfigUnsaved(!0),e.dispose(),r.panes.remove(e)},this.deleteWidget=function(t){freeboard.setConfigUnsaved(!0),ko.utils.arrayForEach(r.panes(),function(e){e.widgets.remove(t)}),t.dispose()},this.setEditing=function(e,t){var i,n;!r.allow_edit()&&e||(r.isEditing(e),i=(t=_.isUndefined(t)?!1:t)?250:0,n=$("#admin-bar").outerHeight(),e?(r.setting.headless||($("#toggle-header-icon").addClass("fa-chevron-up").removeClass("fa-wrench"),$(".gridster .gs_w").css({cursor:"pointer"}),$("#main-header").animate({top:"0px"},i),$("#board-content").animate({top:n+20+"px"},i),$("#main-header").data().shown=!0),o.attachWidgetEditIcons($(".sub-section")),o.enableGrid()):(r.setting.headless||($("#toggle-header-icon").addClass("fa-wrench").removeClass("fa-chevron-up"),$(".gridster .gs_w").css({cursor:"default"}),$("#main-header").animate({top:"-"+n+"px"},i),$("#board-content").animate({top:"20"},i),$("#main-header").data().shown=!1),$(".sub-section").unbind(),o.disableGrid()),o.showPaneEditIcons(e,t))},this.toggleEditing=function(){var e=!r.isEditing();r.setEditing(e)},this.resetDashboard=function(e){r.clearDashboard(e),freeboard.setConfigUnsaved(!0)},this.initSetting=function(e){r.setting=e},this.setPostMessageCallback=function(e){r.postcallback=e}}function FreeboardUI(){var r,s=6,i=16,n=173,a=null,o=null,l=null,t=i,d=$('<div class="wrapperloading"><div class="loading up" ></div><div class="loading down"></div></div>');let c={},h={},u=!1;function p(){var e=window.innerWidth;let t,i;return t=a||(e<=300?1:e<=500?2:Math.floor((e-s)/(n+s))),i="number"==typeof o&&0<o?o:!0===o?l=l||(i=Math.floor((e-2*(t+1)*s)/t)):Math.floor((e-2*(t+1)*s)/t)}function g(){return s+p()+s}let e=function(e,t){c[e]||(c[e]=[]);for(var i of c[e])if(i===t)return;c[e].push(t)},f=function(e,t,i,n,a){if(c[e])for(var s of c[e])"function"==typeof s&&s(t,i,n,a);if(h[e])for(var o of h[e]){"function"==typeof o&&o(t,i,n,a);var r,l=h[e];for(r in l)if(l[r]===o)return void l.splice(r,1)}};function m(e){var n=w(),e=e?function(e){var t=ko.dataFor(this),i=R(t);$(this).attr("data-sizex",Math.min(t.col_width(),n,r.cols)).attr("data-row",i.row).attr("data-col",i.col),t.processSizeChange()}:function(){};C(Math.min(n,t)),x(e),y()}function v(n){C(r.cols+1)&&x(function(){var e=ko.dataFor(this),t=1<r.cols?r.cols-1:1,i=e.col[t],t=e.row[t];t=n?(leftPreviewCol=!0,{row:t,col:i<r.cols?i+1:r.cols}):(rightPreviewCol=!0,{row:t,col:i}),$(this).attr("data-sizex",Math.min(e.col_width(),r.cols)).attr("data-row",t.row).attr("data-col",t.col)}),y(),t=r.cols}function b(n){C(r.cols-1)&&x(function(){var e=ko.dataFor(this),t=r.cols+1,i=e.col[t],t=e.row[t];t=n?{row:t,col:1<i?i-1:1}:{row:t,col:i<=r.cols?i:r.cols},$(this).attr("data-sizex",Math.min(e.col_width(),r.cols)).attr("data-row",t.row).attr("data-col",t.col)}),y(),t=r.cols}function y(){var e=$(".column-tool"),t=$("#board-content").width(),t=Math.floor(t/g());r.cols<=i?e.addClass("min"):e.removeClass("min"),r.cols>=t?e.addClass("max"):e.removeClass("max")}function w(){var e=$("#board-content").width();return Math.floor(e/g())}function C(e){(void 0===e||e<i)&&(e=i);var t=w(),t=(t<e&&(e=t),g()*e+e);return $(".responsive-column-width").css("max-width",t),e!==r.cols}function x(e){if(u){if("1"!=localStorage.getItem("auto_reload_lock"))return localStorage.setItem("auto_reload_lock","1"),void window.location.reload();setTimeout(()=>{localStorage.setItem("auto_reload_lock","0")},1e3)}var t=r.$el;t.find("> li").unbind().removeData(),$(".responsive-column-width").css("width",""),r.generate_grid_and_stylesheet(),t.find("> li").each(e),r.init(),$(".responsive-column-width").css("width",r.cols*p()+r.cols*s*2)}function S(t,i,e){!function(e){for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=i.length,a=0;a<e;a++)t+=i.charAt(Math.floor(Math.random()*n))}(4);var n=R(i),a=n.col,n=n.row,s=Number(i.width()),o=Number(i.getCalculatedHeight());e&&E(!0),r.add_widget(t,s,o,a,n),k(i,n,a),$(t).attrchange({trackValues:!0,callback:function(e){"data-row"==e.attributeName?k(i,Number(e.newValue),void 0):"data-col"==e.attributeName&&k(i,void 0,Number(e.newValue));e=Number($(t).attr("data-sizex"));i.actualColWidth=e}})}function k(e,t,i){var n=r.cols;_.isUndefined(t)||(e.row[n]=t),_.isUndefined(i)||(e.col[n]=i)}function E(e,t){t=(t=_.isUndefined(t)?!0:t)?250:0;e?($(".pane-tools").fadeIn(t),$("#column-tools").fadeIn(t)):($(".pane-tools").fadeOut(t),$("#column-tools").fadeOut(t))}function I(e,t){t?($(e).find(".sub-section-tools").css({"z-index":2}).fadeIn(250),$(e).css({position:"relative",overflow:"hidden"}).append($('<div class="overlay-blur"></div>').css({position:"absolute",top:0,left:0,width:"100%",height:"100%","backdrop-filter":"blur(2px)","z-index":1}))):($(e).css({position:"",overflow:""}).find(".overlay-blur").remove(),$(e).find(".sub-section-tools").css({position:"","z-index":""}).fadeOut(250))}function R(e){var t,i,n,a=r.cols,s=(_.isNumber(e.row)&&_.isNumber(e.col)&&((t={})[a]=e.row,e.row=t,(t={})[a]=e.col,e.col=t),1),o=1e3;for(i in e.col){if(i==a)return{row:e.row[i],col:e.col[i]};e.col[i]>a?s=a:(n=a-i)<o&&(s=i,o=n)}return s in e.col&&s in e.row?{row:e.row[s],col:e.col[s]}:{row:1,col:s}}return this.on=e,this.emit=f,ko.bindingHandlers.grid={init:function(e,t,i,n,a){r=$(e).gridster({widget_margins:[s,6],widget_base_dimensions:[p(),17.2],resize:{enabled:!1,axes:"x"},draggable:{enabled:!0,start:function(e,t,i){},drag:function(e,t,i){},stop:function(e,t,i){freeboard.setConfigUnsaved(!0)}}}).data("gridster"),m(!1),r.disable()}},{addPane:function(e,t,i){S(e,t,i)},showLoadingIndicator:function(e){e?d.fadeOut(0).appendTo("body").fadeIn(500):d.fadeOut(500).remove()},showPaneEditIcons:function(e,t){E(e,t)},attachWidgetEditIcons:function(e){$(e).hover(function(){I(this,!0)},function(){I(this,!1)})},getPositionForScreenSize:R,processResize:function(e){m(e)},disableGrid:function(){r.enabled=!1,r.disable()},enableGrid:function(){r.enabled=!0,r.enable()},updatePane:function(e,t){var i,n,a;e=e,i=(t=t).getCalculatedHeight(),n=Number($(e).attr("data-sizey")),a=Number($(e).attr("data-sizex")),t.actualColWidth=a,i==n&&t.col_width()==a||r.resize_widget($(e),t.col_width(),i,function(){r.set_dom_grid_height()})},removePane:function(e){r.remove_widget(e)},removeAllPanes:function(){r.remove_all_widgets()},addGridColumnLeft:function(){v(!0)},addGridColumnRight:function(){v(!1)},subGridColumnLeft:function(){b(!0)},subGridColumnRight:function(){b(!1)},getUserColumns:function(){return t},setUserColumns:function(e){t=Math.max(i,e)},getGridColumn:function(){return r.cols},hideAllWidgetEditIcons:function(){$(".sub-section-tools").fadeOut(250)},getGrid:function(){return r},getMaxDisplayableColumnCount:w,on:this.on,emit:this.emit}}function PaneModel(n,a){var s=this;this.id=Math.random().toString(36).substring(2,8),this.title=ko.observable(),this.width=ko.observable(1),this.row={},this.col={},this.col_width=ko.observable(1),this.col_width.subscribe(function(e){s.processSizeChange()}),this.widgets=ko.observableArray(),this.addWidget=function(e){this.widgets.push(e)},this.widgetCanMoveUp=function(e){return 1<=s.widgets.indexOf(e)},this.widgetCanMoveDown=function(e){return s.widgets.indexOf(e)<s.widgets().length-1},this.cloneWidget=function(e){freeboard.setConfigUnsaved(!0),(t=e.serialize()).id=Math.random().toString(36).substring(2,8);var t,e=s.widgets.indexOf(e),i=new WidgetModel(n,a);i.deserialize(t),s.widgets.splice(e,0,i)},this.moveWidgetUp=function(e){var t;freeboard.setConfigUnsaved(!0),s.widgetCanMoveUp(e)&&(e=s.widgets.indexOf(e),t=s.widgets(),s.widgets.splice(e-1,2,t[e],t[e-1]))},this.moveWidgetDown=function(e){var t;freeboard.setConfigUnsaved(!0),s.widgetCanMoveDown(e)&&(e=s.widgets.indexOf(e),t=s.widgets(),s.widgets.splice(e,2,t[e+1],t[e]))},this.processSizeChange=function(){setTimeout(function(){_.each(s.widgets(),function(e){try{e.processSizeChange()}catch(e){}})},300)},this.getCalculatedHeight=function(){var e=_.reduce(s.widgets(),function(e,t){return e+t.height()},0),e=(e=((e*=6)+3)*10,Math.ceil((20+e)/30));return Math.max(4,e)},this.serialize=function(){var t=[];return _.each(s.widgets(),function(e){t.push(e.serialize())}),{id:s.id,title:s.title(),width:s.width(),row:s.row,col:s.col,col_width:Number(s.col_width()),widgets:t}},this.deserialize=function(e){e.id&&(s.id=e.id),s.title(e.title),s.width(e.width),s.row=e.row,s.col=e.col,s.col_width(e.col_width||1),_.each(e.widgets,function(e){var t=new WidgetModel(n,a);t.deserialize(e),s.widgets.push(t)})},this.dispose=function(){_.each(s.widgets(),function(e){e.dispose()})}}DatasourceModel=function(i,n){var a=this;function s(){_.isUndefined(a.datasourceInstance)||(_.isFunction(a.datasourceInstance.onDispose)&&a.datasourceInstance.onDispose(),a.datasourceInstance=void 0)}this.name=ko.observable(),this.latestData=ko.observable(),this.settings=ko.observable({}),this.settings.subscribe(function(e){!_.isUndefined(a.datasourceInstance)&&_.isFunction(a.datasourceInstance.onSettingsChanged)&&a.datasourceInstance.onSettingsChanged(e)}),this.statusChangeCallback=function(e){a.status(e),a.postcallback(JSON.stringify({event:"DATASOURCE_STATUS_UPDATED",data:e}))},this.updateCallback=function(e,t){i.processDatasourceUpdate(a,e,t),a.latestData(e);t=new Date;a.last_updated(t.toLocaleTimeString())},this.type=ko.observable(),this.type.subscribe(function(e){function t(){i.newInstance(a.settings(),function(e){(a.datasourceInstance=e).updateNow()},a.updateCallback,a.statusChangeCallback)}var i;s(),e in n&&_.isFunction(n[e].newInstance)&&((i=n[e]).external_scripts?head.js(i.external_scripts.slice(0),t):t())}),this.last_updated=ko.observable("never"),this.status=ko.observable({code:0,text:"DISCONNECTED"}),this.last_error=ko.observable(),this.serialize=function(){return{name:a.name(),type:a.type(),settings:a.settings()}},this.deserialize=function(e){a.settings(e.settings),a.name(e.name),a.type(e.type)},this.getDataRepresentation=function(e){return new Function("data","return "+e+";").call(void 0,a.latestData())},this.updateNow=function(){!_.isUndefined(a.datasourceInstance)&&_.isFunction(a.datasourceInstance.updateNow)&&a.datasourceInstance.updateNow()},this.dispose=function(){s()},this.publish=function(e,t){console.log(e+" --\x3e "+t)},this.setPostMessageCallback=function(e){a.postcallback=e}},DeveloperConsole=function(a){return{showDeveloperConsole:function(){function t(e){var t=$("<tr></tr>"),i=$('<ul class="board-toolbar"></ul>'),n=$('<input class="table-row-value" style="width:100%;" type="text">'),a=$('<li><i class="icon-trash icon-white"></i></li>').click(function(e){s=_.without(s,n),t.remove()});s.push(n),e&&n.val(e),i.append(a),o.append(t.append($("<td></td>").append(n)).append($('<td class="table-row-operation">').append(i)))}var s,e,i,n,o;s=[],e=$("<div></div>"),i=$('<div class="table-operation text-button">ADD</div>'),(n=$('<table class="table table-condensed sub-table"></table>')).append($('<thead style=""><tr><th>Plugin Script URL</th></tr></thead>')),o=$("<tbody></tbody>"),n.append(o),e.append($("<p>Here you can add references to other scripts to load datasource or widget plugins.</p>")).append(n).append(i).append('<p>To learn how to build plugins for freeboard, please visit <a target="_blank" href="http://freeboard.github.io/freeboard/docs/plugin_example.html">http://freeboard.github.io/freeboard/docs/plugin_example.html</a></p>'),_.each(a.plugins(),function(e){t(e)}),i.click(function(e){t()}),new DialogBox(e,"Developer Console","OK",null,function(){_.each(a.plugins(),function(e){$('script[src^="'+e+'"]').remove()}),a.plugins.removeAll(),_.each(s,function(e){e=e.val();e&&0<e.length&&(a.addPluginSource(e),head.js(e+"?"+Date.now()))})})}}},JSEditor=function(){let t;return{displayJSEditor:function(e,t){function i(){n()}function n(){var e=l.getValue();a(e),s.remove(),freeboard.emit("exit_jseditor"),freeboard.off("force_jseditor_ok",i)}var a,s,o,r,l;e=e,a=t,s=$('<div class="code-window"></div>'),t=$('<div class="code-mirror-wrapper"></div>'),o=$('<div class="code-window-footer"></div>'),r=$('<div class="code-window-header cm-s-ambiance">'),s.append([r,t,o]),$("body").append(s),freeboard.emit("enter_jseditor"),l=CodeMirror(t.get(0),{value:e,mode:"javascript",indentUnit:4,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!1,lineWrapping:!0}),$('<span id="dialog-cancel" class="text-button">Close</span>').click(function(){a&&n()}),freeboard.once("force_jseditor_ok",n)},setAssetRoot:function(e){0},initSetting:function(e){t=e}}},PluginEditor=function(v,b){let t;function y(e,t){t=$('<div class="validation-error"></div>').html(t);$("#setting-value-container-"+e).append(t)}function o(e,t,i,d,n){var a,c={type:i,settings:{}};var s=$("<div id='form-container'></div>"),o=$('<div id="plugin-description"></div>').hide();function r(o,t,r,l){var i=document.getElementById("form-container");if(i){let e;if(t)e=function t(i){var e,n,a;if("blank"===i.type)return(e=document.createElement("div")).style.flex="1",e;if("divider"===i.type)return(e=document.createElement("div")).style.width="100%",e.style.height="1px",e.style.marginTop="15px",e.style.marginBottom="15px",e.style.backgroundColor="#ccc",e;if("input"===i.type)return e=o.find(e=>e.name===i.name),!_.isUndefined(e.default_value)&&_.isUndefined(d[e.name])&&(d[e.name]=e.default_value),n=i.label||e.display_name,(a=document.createElement("div")).style.flex=i.col||"1",a.style.display="flex",a.style.flexDirection="column",a.appendChild(createLabel(n,e.description)),a.appendChild(createInput(e,c,d,r,l,b,v)),a;if("vertical"!==i.type&&"horizontal"!==i.type)return null;{const s=document.createElement("div");return s.style.display="horizontal"===i.type?"flex":"block",s.style.flexDirection=window.innerWidth<900||"horizontal"!==i.type?"column":"row",s.style.gap="10px",i.elements.forEach(e=>{(e=t(e))&&s.appendChild(e)}),s}}(t);else{const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.gap="10px",_.each(o,function(e){!_.isUndefined(e.default_value)&&_.isUndefined(d[e.name])&&(d[e.name]=e.default_value);var t=e.name,i=(_.isUndefined(e.display_name)||(t=e.display_name),document.createElement("div"));i.style.display="flex",i.style.flexDirection="column",i.appendChild(createLabel(t,e.description)),i.appendChild(createInput(e,c,d,r,l,b,v)),n.appendChild(i)}),e=n}e&&i.appendChild(e)}else console.error("Container not found.")}s.append(o);let l="Save",h="Cancel";l=null,h=null,new DialogBox(s,e,l,h,function(){$(".validation-error").remove();for(var e,t=0;t<a.settings.length;t++){var i=a.settings[t];if(i.required&&(_.isUndefined(c.settings[i.name])||""==c.settings[i.name]))return y(i.name,"This is required."),!0;if("integer"==i.type&&c.settings[i.name]%1!=0)return y(i.name,"Must be a whole number."),!0;if("number"==i.type&&(e=c.settings[i.name],isNaN(parseFloat(e))||!isFinite(e)))return y(i.name,"Must be a number."),!0}_.isFunction(n)&&n(c)});var u,p,g,f,m,e=_.keys(t);1<e.length?(p="plugin-types",g="Type",s=$('<div id="setting-row-'+p+'" class="form-row"></div>').appendTo(s),(m=$('<div class="form-label"></div>')).append('<label class="control-label">'+g+"</label>"),_.isUndefined(f)||m.append($(`<div class="tooltip">
            <i class="fa fa-info-circle"></i>
            <span class="tooltip-text">${f}</span>
          </div>`)),s.append(m),g=$('<div id="setting-value-container-'+p+'" class="form-value"></div>').appendTo(s),(u=$("<select></select>").appendTo($('<div class="styled-select"></div>').appendTo(g))).append($("<option>Select a type...</option>").attr("value","undefined")),_.each(t,function(e){u.append($("<option></option>").text(e.display_name).attr("value",e.type_name))}),u.change(function(){c.type=$(this).val(),c.settings={},($("#setting-row-instance-name").length?$("#setting-row-instance-name"):$("#setting-row-plugin-types")).nextAll().remove(),a=t[u.val()],_.isUndefined(a)?($("#setting-row-instance-name").hide(),$("#dialog-ok").hide()):($("#setting-row-instance-name").show(),a.description&&0<a.description.length?o.html(a.description).show():o.hide(),$("#dialog-ok").show(),r(a.settings,a.ui_schema||null,a.typeahead_source,a.typeahead_data_segment))})):1==e.length&&(a=t[e[0]],c.type=a.type_name,c.settings={},r(a.settings,a.ui_schema||null)),u&&(_.isUndefined(i)?($("#setting-row-instance-name").hide(),$("#dialog-ok").hide()):($("#dialog-ok").show(),u.val(i).trigger("change")))}return{createPluginEditor:function(e,t,i,n,a,s){o(e,t,i,n,a)},initSetting:function(e){t=e}}};const COLOR_PALETTE=["#D50000","#F50057","#FF6D00","#FFAB00","#FFD600","#64DD17","#00C853","#00BFA5","#00B8D4","#2962FF","#3D5AFE","#9C27B0"];function createLabel(e,t){var i=document.createElement("div"),n=(i.className="form-label",document.createElement("label"));return n.textContent=e,n.className="control-label",i.appendChild(n),_.isUndefined(t)||((e=document.createElement("div")).className="tooltip",(n=document.createElement("i")).className="fa fa-info-circle",e.appendChild(n),(n=document.createElement("span")).textContent=t,n.className="tooltip-text",e.appendChild(n),i.appendChild(e)),i}function createInput(g,f,n,t,o,p,i){switch(g.type){case"array":{var a=document.createElement("div");a.className="array-wrapper";const v=document.createElement("div");v.className="array-card-container",a.appendChild(v);var s=g.name in n?n[g.name]:[];function e(d){const c=generateUniqueId(),h=document.createElement("div");h.className="array-card";var e=document.createElement("button");e.textContent="×",e.className="array-delete-btn";const u={};Array.isArray(f.settings[g.name])||(f.settings[g.name]=[]),f.settings[g.name].push(u),g.settings.forEach(t=>{var n=document.createElement("div"),e=(n.className="array-field-container "+("calculated"===t.type?"calculated-field":""),document.createElement("label"));switch(e.textContent=t.display_name||t.name,e.className="array-field-label",n.appendChild(e),t.type){case"calculated":var i=d[t.name]||null,a=(u[t.name]=i,document.createElement("textarea")),i=(a.onchange=function(){u[t.name]=this.value},i&&(a.value=i),p?.createValueEditor(a,void 0,!0),document.createElement("div")),s=(i.className="calculated-setting-row",document.createElement("div")),o=(s.className="input-container",document.createElement("i"));o.className="fa fa-bolt calicon",s.appendChild(a),s.appendChild(o),i.appendChild(s),n.appendChild(i);break;case"color":{u[t.name]=d[t.name]||"";let i={[c]:""};a=document.createElement("div");a.className="custom-coloris-input";const r=document.createElement("input");r.type="button",r.className="coloris color-picker-button clr-instance-"+c,r.id="color-picker-"+c,r.style.background=u[t.name],r.value="",a.appendChild(r),Coloris({el:".color-picker-button",alpha:!1,swatches:COLOR_PALETTE,clearButton:!0,clearLabel:"Cancel",clearBtnId:"clr-clear-"+c,closeButton:!0,closeLabel:"Select",closeBtnId:"clr-select-"+c}),Coloris.setInstance(".clr-instance-"+c,{defaultColor:u[t.name],onChange:(e,t)=>{t.value="",i[c]=e}});o=document.getElementsByClassName("clr-select-"+c)?.[0];o&&o.addEventListener("click",()=>{""!==i[c]&&(u[t.name]=i[c],r.style.background=i[c],i[c]="")}),n.appendChild(a);break}case"boolean":{s=document.createElement("label");s.className="array-checkbox-container";const l=document.createElement("input");l.type="checkbox",l.className="array-checkbox",l.checked=Boolean(d[t.name]),u[t.name]=l.checked;i=document.createElement("span");i.className="array-checkmark",i.style.opacity=l.checked?"1":"0",l.addEventListener("change",()=>{u[t.name]=l.checked,l.style.backgroundColor=l.checked?"#007bff":"transparent",l.style.borderColor=(l.checked,"#007bff")}),l.style.backgroundColor=l.checked?"#007bff":"transparent",l.style.borderColor=(l.checked,"#007bff"),s.appendChild(l),s.appendChild(i),n.appendChild(s);break}default:{let e=document.createElement("input");e.className="array-input",e.type="number"===t.type?"number":"text",e.value=d[t.name]||"",u[t.name]=e.value,e.addEventListener("input",()=>{u[t.name]=e.value}),n.appendChild(e)}}h.appendChild(n)}),e.addEventListener("click",()=>{var e=f.settings[g.name].indexOf(u);-1!==e&&(f.settings[g.name].splice(e,1),h.remove())}),h.appendChild(e),v.appendChild(h)}var r=document.createElement("button"),l=(r.textContent="Add New",r.className="array-add-btn",document.createElement("i"));return l.className="fa fa-plus",r.prepend(l),r.addEventListener("click",()=>{const t={};g.settings.forEach(e=>{t[e.name]=""}),e(t)}),a.appendChild(r),s.forEach(e),a}case"boolean":{l=Boolean(n[g.name]),r=(f.settings[g.name]=l,document.createElement("div"));r.className="onoffswitch";const h=document.createElement("input");h.type="checkbox",h.className="onoffswitch-checkbox",h.id=g.name+"-onoff",h.checked=l,h.addEventListener("change",()=>{f.settings[g.name]=h.checked});s=document.createElement("label"),a=(s.className="onoffswitch-label",s.htmlFor=h.id,document.createElement("div")),l=(a.className="onoffswitch-inner",a.innerHTML=`
        <span class="on">YES</span>
        <span class="off">NO</span>
      `,document.createElement("div"));return l.className="onoffswitch-switch",s.append(a,l),r.append(h,s),r}case"calculated":case"script":{a=n[g.name]||null;f.settings[g.name]=a;let t=document.createElement("textarea");t.onchange=function(){f.settings[g.name]=this.value},a&&(t.value=a),p?.createValueEditor(t,void 0,!0);l=document.createElement("ul"),s=(l.className="board-toolbar datasource-input-suffix",l.style.minHeight="30px",document.createElement("div")),r=(s.className="calculated-setting-row",document.createElement("div")),a=(r.className="input-container",document.createElement("i")),a=(a.className="fa fa-bolt calicon",r.appendChild(t),r.appendChild(a),s.appendChild(r),s.appendChild(l),document.createElement("li")),r=(a.innerHTML='<i class="fa fa-plus icon-dark"></i><label>DEVICE</label>',a.addEventListener("mousedown",e=>{e.preventDefault(),t.focus(),insertAtCaret(t,"#"),t.dispatchEvent(new Event("freeboard-eval"))}),l.appendChild(a),document.createElement("li")),a=(r.innerHTML='<i class="fa fa-plus icon-dark"></i><label>VARIABLE</label>',r.addEventListener("mousedown",e=>{e.preventDefault(),t.focus(),insertAtCaret(t,"$"),t.dispatchEvent(new Event("freeboard-eval"))}),l.appendChild(r),document.createElement("li"));return a.innerHTML='<i class="fa fa-edit icon-dark"></i><label>EDITOR</label>',a.addEventListener("mousedown",e=>{e.preventDefault(),i?.displayJSEditor(t.value,e=>{t.value=e,t.dispatchEvent(new Event("change"))})}),l.appendChild(a),s}case"taginput":{f.settings[g.name]=n[g.name];let e="";g.name in n&&(e=n[g.name]);r=document.createElement("div"),l=(r.className="tagify-wrapper",document.createElement("input"));l.value=e,l.onchange=function(){f.settings[g.name]=this.value},r.appendChild(l);const u=new Tagify(l,{duplicates:g.option.allowDuplicates||!1,transformTag:function(e){if(e.color=/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3}|[A-Fa-f0-9]{8})$/.test(e.value)?e.value:"rgba(6, 144, 242, 0.3)",e.style=`--tag-bg: ${e.color}; --tag-text-color: `+getContrastingTextColor(e.color),context={currentSettings:f.settings},g.option.transform&&"function"==typeof g.option.transform)return g.option.transform(context,e.value);return e},whitelist:g.option.availableTags||[],dropdown:{enabled:"color"!==g.option.tagType&&0,maxItems:10,position:"all",closeOnSelect:!1,highlightFirst:!0}});g.option?.source&&"function"==typeof g.option.source&&g.option.source({currentSettings:f.settings}).then(e=>{u.whitelist=e});new DragSort(u.DOM.scope,{selector:"."+u.settings.classNames.tag,callbacks:{dragEnd:function(e){u.updateValueByDOMTags()}}});if("color"===g.option.tagType){let i={[g.name]:""};a=document.createElement("div"),s=(a.className="custom-coloris-input",document.createElement("input")),l=(s.type="button",s.className="coloris color-picker-button clr-instance-"+g.name,s.value="",a.appendChild(s),document.getElementById("clr-close").addEventListener("click",()=>{u.addTags(i[g.name]),i[g.name]=""}),Coloris({el:".coloris",alpha:!1,swatches:COLOR_PALETTE,clearButton:!0,clearLabel:"Cancel",clearBtnId:"clr-clear-"+g.name,closeButton:!0,closeLabel:"Select",clearBtnId:"clr-clear-"+g.name}),Coloris.setInstance(".clr-instance-"+g.name,{onChange:(e,t)=>{t.value="",i[g.name]=e}}),document.getElementsByClassName("clr-select-"+g.name)?.[0]);l&&l.addEventListener("click",()=>{""!==i[g.name]&&(u.addTags(i),i[g.name]="")}),r.appendChild(a)}return r}case"color":{f.settings[g.name]=n[g.name]||"";let i={[g.name]:""};s=document.createElement("div");s.className="custom-coloris-input";const b=document.createElement("input");b.type="button",b.className="coloris color-picker-button clr-instance-"+g.name,b.id="color-picker-"+g.name,b.style.background=f.settings[g.name],b.value="",s.appendChild(b),Coloris({el:".color-picker-button",alpha:!1,swatches:COLOR_PALETTE,clearButton:!0,clearLabel:"Cancel",clearBtnId:"clr-clear-"+g.name,closeButton:!0,closeLabel:"Select",closeBtnId:"clr-select-"+g.name}),Coloris.setInstance(".clr-instance-"+g.name,{defaultColor:f.settings[g.name],onChange:(e,t)=>{t.value="",i[g.name]=e}});l=document.getElementsByClassName("clr-select-"+g.name)?.[0];return l&&l.addEventListener("click",()=>{""!==i[g.name]&&(f.settings[g.name]=i[g.name],b.style.background=i[g.name],i[g.name]="")}),s}case"option":{a=n[g.name],r=document.createElement("div");r.className="styled-select";const y=document.createElement("select");return y.addEventListener("change",function(){f.settings[g.name]=this.value}),g.options.forEach(e=>{let t,i;"object"==typeof e?(t=e.name,i=e.value):t=e,void 0===i&&(i=t);e=document.createElement("option");e.textContent=t,e.value=i,y.appendChild(e)}),f.settings[g.name]=a,g.name in n&&(y.value=n[g.name]),r.appendChild(y),r}case"slider":{f.settings[g.name]=n[g.name];const w=g.min,C=g.max;l=g.name+"-"+randomString(8),s=document.createElement("div");s.classList.add("slider-wrapper","form-slider"),s.style.minHeight="30px";const x=document.createElement("input"),S=(x.id=l,x.type="range",x.min=w,x.max=C,x.step=1,x.value=void 0!==n[g.name]?n[g.name]:g.default_value,s.appendChild(x),document.createElement("label")),k=(S.innerText=x.value,s.appendChild(S),()=>{var e=(x.value-w)/(C-w)*100;S.style.left=`calc(${e}% + (${8-.15*e}px))`});return x.addEventListener("input",e=>{e=e.target.value;S.innerText=e,f.settings[g.name]=Number(e),k()}),k(),s}case"timerange":{f.settings[g.name]=n[g.name];let h="",u="";g.name in n&&(h=f.settings[g.name]);const E=[{text:"Last 1 hour",value:"1h"},{text:"Last day",value:"1d"},{text:"Last 7 days",value:"7d"},{text:"Last 30 days",value:"30d"}];let p=E;const $={m:{label:e=>`Last ${e} minute`+(1<e?"s":""),unit:"minutes"},h:{label:e=>`Last ${e} hour`+(1<e?"s":""),unit:"hours"},d:{label:e=>`Last ${e} day`+(1<e?"s":""),unit:"days"}};function m(){var t=parseInt(h.match(/\d+/)[0],10),i=h.match(/[a-z]+/i)[0],i={text:$[i].label(t),value:h};function n(e){var t=parseInt(e.match(/\d+/)[0],10),e=e.match(/[a-z]+/i)[0];return t*("m"===e?1:"h"===e?60:"d"===e?1440:0)}t=[...E];if(!E.some(e=>e.value===h)){let e=t.findIndex(e=>n(h)<n(e.value));-1===e&&(e=t.length),t.splice(e,0,i)}return t}const I=(e,n,t)=>{var i=document.createElement("li"),a=(i.setAttribute("role","option"),i.setAttribute("tabindex","0"),i.setAttribute("data-key",n),i.setAttribute("aria-selected",h===n),i.setAttribute("id","select-list-opc3muy832-option-"+n),i.className="timerange-list-item e1bvpj738",document.createElement("div")),s=(a.className="timerange-dropdown-inner-wrap",document.createElement("span")),o=(s.className="app-18xjr97 e1bvpj736",s.setAttribute("role","presentation"),document.createElement("div")),r=(o.className="timerange-checkmark-container e1bvpj734",document.createElement("div")),l=(r.setAttribute("aria-hidden","true"),r.className="timerange-checkmark-icon e1lwdp4y2",document.createElementNS("http://www.w3.org/2000/svg","svg")),d=(l.setAttribute("viewBox","0 0 16 16"),l.setAttribute("fill",h===n?"currentColor":"transparent"),l.setAttribute("height","14px"),l.setAttribute("width","14px"),document.createElementNS("http://www.w3.org/2000/svg","path")),d=(d.setAttribute("d","M6.19,14.51a.77.77,0,0,1-.57-.25l-4.2-4.8a.75.75,0,0,1,1.13-1l3.56,4.06L13.36,1.82a.75.75,0,0,1,1-.21.76.76,0,0,1,.21,1.05L6.81,14.18a.73.73,0,0,1-.58.33Z"),l.appendChild(d),r.appendChild(l),o.appendChild(r),document.createElement("div")),l=(d.className="timerange-content-wrap e1bvpj735",document.createElement("div")),r=(l.className="timerange-label-wrap e1bvpj733",document.createElement("div")),t=(r.setAttribute("id",t),r.setAttribute("data-test-id","menu-list-item-label"),r.className="timerange-label e1bvpj732",document.createElement("span")),c=(t.className="app-jnhzqm e17v342v7",document.createElement("div"));return c.className="app-1t0mx95 ep7a7xs4",c.textContent=e,t.appendChild(c),r.appendChild(t),l.appendChild(r),d.appendChild(l),a.appendChild(s),a.appendChild(o),a.appendChild(d),i.appendChild(a),i.addEventListener("click",e=>{e.preventDefault(),h=n,f.settings[g.name]=n;e=e.target.closest(".timerange-container");e.querySelector(".timerange-text-span").textContent=n;e.querySelectorAll('li[role="option"]').forEach(e=>{var t=e.querySelector("svg"),i=e.getAttribute("data-key")===n;e.setAttribute("aria-selected",i),t.setAttribute("fill",i?"currentColor":"transparent")});var t=e.querySelector(".dropdown__container"),e=e.querySelector(".timerange-chevron");t.classList.remove("show"),e.classList.remove("open"),u="",document.getElementById("timerange-input").value=u,p=m()}),i};a=document.createElement("div"),d=(a.className="timerange-container",(r=document.createElement("button")).setAttribute("type","button"),r.setAttribute("role","button"),r.className="timerange-button",(l=document.createElement("span")).className="timerange-btn-span1",l.setAttribute("role","presentation"),(s=document.createElement("span")).className="timerange-btn-span2",(d=document.createElement("span")).className="timerange-inner-span",(c=document.createElement("span")).className="timerange-text-span",c.textContent=h,d.appendChild(c),s.appendChild(d),(d=document.createElement("span")).className="timerange-chevron",s.appendChild(d),r.appendChild(l),r.appendChild(s),r.addEventListener("click",e=>{e.preventDefault();var e=e.target.closest(".timerange-container"),t=e.querySelector(".dropdown__container"),e=e.querySelector(".timerange-chevron");t.classList.toggle("show"),e.classList.toggle("open")}),r.dataset.textSpan=c.className,r),c=(()=>{var e=document.createElement("div"),t=(e.className="dropdown__container",document.createElement("div")),i=(t.className="dropdown__overlay",document.createElement("div")),n=(i.className="dropdown__header",document.createElement("span")),a=(n.className="dropdown__header__text",n.textContent="Filter Time Range",document.createElement("input"));a.placeholder="Custom range: 2h, 4d, 8w…",a.className="dropdown__input",a.value=u,a.id="timerange-input";const s=e=>{const t=document.getElementById("timerange-list");for(;t.firstChild;)t.removeChild(t.firstChild);e.forEach(e=>{e=I(e.text,e.value,"list-item-"+e.value);t.appendChild(e)})};a.addEventListener("input",e=>{(u=e.target.value)||(p=m(),s(p));e=u.match(/(?<digits>\d+)\s*(?<string>\w*)/);const t=Number(e?.groups?.digits),i=(e?.groups?.string??"").trim().toLowerCase();var e=!isNaN(t)&&0<t;e&&!i&&(p=Object.keys($).map(e=>({text:$[e].label(t),value:""+t+e})),s(p)),e&&i&&(e=Object.keys($).find(e=>1===i.length?e===i:$[e].unit.startsWith(i)))&&(p=[{text:$[e].label(t),value:""+t+e}],s(p))});var o=document.createElement("div"),r=(o.className="dropdown__list-container",document.createElement("div"));r.setAttribute("role","separator"),r.className="dropdown__separator";const l=document.createElement("ul");l.setAttribute("role","listbox"),l.setAttribute("tabindex","-1"),l.className="dropdown__listbox",l.id="timerange-list",(p=m()).forEach(e=>{e=I(e.text,e.value,"list-item-"+e.value);l.appendChild(e)});var d=document.createElement("p");return d.className="timerange-empty-message e1lwdp4y1",d.textContent="No options found",d.style.display=0<p.length?"none":"block",o.appendChild(r),o.appendChild(l),o.appendChild(d),t.appendChild(i),i.appendChild(n),t.appendChild(a),t.appendChild(o),e.appendChild(t),e})();return a.append(d),a.append(c),a}default:{f.settings[g.name]=n[g.name];const R=document.createElement("input");if(R.type="number"===g.type?"number":"text",R.addEventListener("change",()=>{"number"===g.type?f.settings[g.name]=Number(R.value):f.settings[g.name]=R.value}),g.name in n&&(R.value=n[g.name]||""),t&&g.typeahead_data_field&&R.classList.add("typeahead_data_field-"+g.typeahead_data_field),R.addEventListener("keyup",()=>{R.dispatchEvent(new Event("change"))}),t&&g.typeahead_field){let s=[];R.addEventListener("keyup",e=>{65<=e.which&&e.which<=91&&R.dispatchEvent(new Event("change"))});const N=new AutoComplete({input:R,source:s,onSelect:e=>{R.value=e,R.dispatchEvent(new Event("change"))}});R.addEventListener("change",()=>{const a=R.value;var e=_.template(t)({input:a});fetch(e).then(e=>e.json()).then(e=>{if(e=(e=o?e[o]:e).filter(e=>e[g.typeahead_field][0]===a[0]),s=e.map(e=>e[g.typeahead_field]),N.setSource(s),1===e.length){var t,i=e[0];for(const n in i)i.hasOwnProperty(n)&&(t=document.querySelector(".typeahead_data_field-"+n))&&(t.value=i[n],t.value!==R.value)&&t.dispatchEvent(new Event("change"))}})})}return R}}var d,c}function insertAtCaret(e,t){var i=e.selectionStart,n=e.selectionEnd;e.value=e.value.substring(0,i)+t+e.value.substring(n),e.selectionStart=e.selectionEnd=i+t.length}function getContrastingTextColor(e){let t,i,n;if(e.startsWith("#"))t=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16);else if(e.startsWith("rgba")){var s=e.replace(/rgba?\(/,"").replace(/\)/,"").split(",").map(e=>parseFloat(e.trim())),s=([t,i,n,a]=s,(e,t)=>Math.round(255*(1-t)+t*e));t=s(t,a),i=s(i,a),n=s(n,a)}else{if(!e.startsWith("rgb"))throw new Error("Invalid color format. Use hex, rgb, or rgba.");s=e.replace(/rgb?\(/,"").replace(/\)/,"").split(",").map(e=>parseInt(e.trim()));[t,i,n]=s}return.5<(.299*t+.587*i+.114*n)/255?"#000000":"#FFFFFF"}function generateUniqueId(){var e=Math.random().toString(36).substring(2);return Date.now().toString(36)+"-"+e}function lightenColor(e,t){var e=parseInt(e.slice(1),16),t=Math.round(2.55*t),i=(e>>16)+t,n=(e>>8&255)+t,e=(255&e)+t;return"#"+(16777216+65536*(i<255?i<1?0:i:255)+256*(n<255?n<1?0:n:255)+(e<255?e<1?0:e:255)).toString(16).slice(1)}function WidgetModel(i,n){var c=this;this.id=Math.random().toString(36).substring(2,8),this.datasourceRefreshNotifications={},this.calculatedSettingScripts={},this.title=ko.observable(),this.fillSize=ko.observable(!1),this.type=ko.observable(),this.listeners={},freeboard.DATASOURCE_INITIALIZED?setTimeout(()=>{if(c.listeners.ready)for(cb of c.listeners.ready)cb()},250):freeboard.on("DATASOURCE_INITIALIZED",()=>{if(c.listeners.ready)for(cb of c.listeners.ready)cb()}),this.type.subscribe(function(e){function t(){var e=c.settings();e.id=c.id;i.newInstance(e,function(e){c.fillSize(!0===i.fill_size),c.widgetInstance=e,c.shouldRender(!0),c._heightUpdate.valueHasMutated(),c.widgetInstance.id=c.id},{getCommand:function(e){return`executeWidgetAction('${c.id}','${e}')`},setCommand:function(e,t){setWidgetAction(c.id,e,t)},triggerAction:function(e,t){executeWidgetAction(c.id,e,t)},execute:function(e,t){executeCodeText(e,t)},on:function(e,t){c.listeners[e]||(c.listeners[e]=[]),c.listeners[e].push(t)},isSet:function(e){return isWidgetActionSet(c.id,e)}})}var i;_.isUndefined(c.widgetInstance)||(_.isFunction(c.widgetInstance.onDispose)&&c.widgetInstance.onDispose(),c.widgetInstance=void 0),e in n&&_.isFunction(n[e].newInstance)&&((i=n[e]).external_scripts?head.js(i.external_scripts.slice(0),t):t())}),this.settings=ko.observable({}),this.settings.subscribe(function(e){!_.isUndefined(c.widgetInstance)&&_.isFunction(c.widgetInstance.onSettingsChanged)&&c.widgetInstance.onSettingsChanged(e),c.updateCalculatedSettings(),c._heightUpdate.valueHasMutated()}),this.processDatasourceUpdate=function(e,t){e=c.datasourceRefreshNotifications[e];_.isArray(e)&&_.each(e,function(e){c.processCalculatedSetting(e,t)})},this.callValueFunction=function(e,t){return t?e.call(void 0,t):e.call(void 0,i.datasourceData)},this.processSizeChange=function(){!_.isUndefined(c.widgetInstance)&&_.isFunction(c.widgetInstance.onSizeChanged)&&c.widgetInstance.onSizeChanged()},this.processCalculatedSetting=function(t,i){if(_.isFunction(c.calculatedSettingScripts[t])){var n=void 0,e=void 0;try{n=c.callValueFunction(c.calculatedSettingScripts[t]),e=c.callValueFunction(c.calculatedSettingScripts[t],{dash:i})}catch(e){i=c.settings()[t];e instanceof ReferenceError&&/^\w+$/.test(i)&&(n=i)}if(!_.isUndefined(c.widgetInstance)&&_.isFunction(c.widgetInstance.onCalculatedValueChanged))try{e=e||{},c.widgetInstance.onCalculatedValueChanged(t,n,e)}catch(e){console.error(e.toString())}}},this.updateCalculatedSettings=function(){if(c.datasourceRefreshNotifications={},c.calculatedSettingScripts={},!_.isUndefined(c.type())){var e=n[c.type()].settings;const t=c.settings();_.each(e,function(e){!function n(a,i,s=""){if("calculated"==a.type){let e=i[a.name];if(!_.isUndefined(e)){"html"==a.name&&(e="`"+e+"`"),e="return "+(e=_.isArray(e)?"["+e.join(",")+"]":e),e=transpile_macro_code(e);let t;try{t=new Function("datasources",e)}catch(e){var o=i[a.name].replace(/"/g,'\\"').replace(/[\r\n]/g," \\\n");t=new Function("datasources",'return "'+o+'";')}for(var r=s?s+"."+a.name:a.name,l=(c.calculatedSettingScripts[r]=t,c.processCalculatedSetting(r),new RegExp("datasources.([\\w_-]+)|datasources\\[['\"]([^'\"]+)","g"));d=l.exec(e);){var d=d[1]||d[2];let e=c.datasourceRefreshNotifications[d];_.isUndefined(e)&&(e=[],c.datasourceRefreshNotifications[d]=e),-1==_.indexOf(e,r)&&e.push(r)}}}else"array"===a.type&&a.settings&&(o=i[a.name]||[],_.each(o,(t,i)=>{_.each(a.settings,e=>{n(e,t,a.name+`[${i}]`)})}))}(e,t)})}},this._heightUpdate=ko.observable(),this.height=ko.computed({read:function(){return c._heightUpdate(),!_.isUndefined(c.widgetInstance)&&_.isFunction(c.widgetInstance.getHeight)?c.widgetInstance.getHeight():1}}),this.shouldRender=ko.observable(!1),this.render=function(e){c.shouldRender(!1),!_.isUndefined(c.widgetInstance)&&_.isFunction(c.widgetInstance.render)&&(c.widgetInstance.render(e),c.updateCalculatedSettings())},this.dispose=function(){c.widgetInstance.onDispose()},this.serialize=function(){return{id:c.id,title:c.title(),type:c.type(),settings:c.settings()}},this.deserialize=function(e){e.id&&(c.id=e.id),c.title(e.title),c.settings(e.settings),c.type(e.type)}}ValueEditor=function(b){var y=new RegExp('.*#\\["([^"]*)("\\])?([^#]*)$'),w=new RegExp(".*\\$([^$]*)([^#]*)$"),C=null,x=0,S=[],k=!0,E=null,n={ANY:"any",ARRAY:"array",OBJECT:"object",STRING:"string",NUMBER:"number",BOOLEAN:"boolean",TAG:"tag"};function I(e,t){return _.isArray(e)||_.isObject(e)||i(e,t)}function i(e,t){switch(t){case n.ANY:return!0;case n.ARRAY:return _.isArray(e);case n.OBJECT:return _.isObject(e);case n.STRING:return _.isString(e);case n.NUMBER:return _.isNumber(e);case n.BOOLEAN:return _.isBoolean(e);case n.TAG:return _.isString(e)}}function R(e,t){$(e).parent().find(".validation-error").remove(),i(E,t)||$(e).parent().append("<div class='validation-error'>This field expects an expression that evaluates to type "+t+".</div>")}function a(i,e){var n,a=(a=$(i).val().substring(0,$(i).getCaretPosition())).replace(String.fromCharCode(160)," "),t=a,s=b.datasources(),o=e,r=y.exec(t),l=w.exec(t),d=[];if(r||"#"==t.substr(t.length-1)&&(r=["#",""]),l){let e;_atVarField=!(k=!1);for(var c of s)if("localstore_datasource"==c.type()){e=c;break}if(""==l[1]){if(!_.isUndefined(e)){var h="data",u="",p=e.getDataRepresentation(h);if(E=p,_.isArray(p))for(var g=0;g<p.length;g++)0==g.toString().indexOf(u)&&I(v=p[g],o)&&d.push({value:g,entity:v,precede_char:"[",follow_char:"]",preview:v.toString(),caret_offset:0});else _.isObject(p)&&_.each(p,function(e,t){0==t.indexOf(u)&&I(e,o)&&d.push({value:t,entity:e,precede_char:"",follow_char:"",caret_offset:0})})}}else d=[]}if(r&&(!l||""!=l[1]))if(_atVarField=!1,""==r[1]){let e;for(var f of s)if("piedash_datasource"==f.type()){e=f;break}if(!_.isUndefined(e)){h="data",u="",p=e.getDataRepresentation(h);if(E=p,_.isArray(p))for(g=0;g<p.length;g++)0==g.toString().indexOf(u)&&I(v=p[g],o)&&d.push({value:g,entity:v,precede_char:"[",follow_char:"]",preview:v.toString(),caret_offset:0});else _.isObject(p)&&_.each(p,function(e,t){0==t.indexOf(u)&&I(e,o)&&d.push({value:t,entity:e,precede_char:'["',follow_char:'"]',caret_offset:0})})}}else{let e;for(var m of s)if("piedash_datasource"==m.type()){e=m;break}if(!_.isUndefined(e)){h=`data["${r[1]}"]`,u="",p=(_.isUndefined(r[2])||(t=r[3].lastIndexOf("]")+1,h+=r[3].substring(0,t),u=(u=(u=r[3].substring(t,r[3].length)).replace(/^[\[\"]*/,"")).replace(/[\"\]]*$/,"")),e.getDataRepresentation(h));if(E=p,_.isArray(p))for(var v,g=0;g<p.length;g++)0==g.toString().indexOf(u)&&I(v=p[g],o)&&d.push({value:g,entity:v,precede_char:"[",follow_char:"]",preview:v.toString(),caret_offset:0});else _.isObject(p)&&_.each(p,function(e,t){0==t.indexOf(u)&&I(e,o)&&d.push({value:t,entity:e,precede_char:'["',follow_char:'"]',caret_offset:0})});r[3]||d.push({value:".writeShadow(",entity:"",precede_char:"",follow_char:'"","")',caret_offset:-5},{value:".publishMsg(",entity:"",precede_char:"",follow_char:'"","")',caret_offset:-5},{value:".privateMsg(",entity:"",precede_char:"",follow_char:'"","")',caret_offset:-5}),k=!r[3]||!r[2]}}0<(S=d).length?(C||(C=$('<ul id="value-selector" class="value-dropdown"></ul>').insertAfter(i).width($(i).outerWidth()-2).css("left",$(i).position().left),$(C).offset({top:$(C).offset().top+$(i).outerHeight()-1})),C.empty(),C.scrollTop(0),n=!0,x=0,_.each(S,function(e,t){e=function(a,s,o,e){var t=o.value;"."==t.substr(0,1)&&(t+=")");o.preview&&(t=t+"<span class='preview'>"+o.preview+"</span>");return $("<li>"+t+"</li>").appendTo(C).mouseenter(function(){$(this).trigger("freeboard-select")}).mousedown(function(e){$(this).trigger("freeboard-insertValue"),e.preventDefault()}).data("freeboard-optionIndex",e).data("freeboard-optionValue",o.value).bind("freeboard-insertValue",function(){var e=o.value,e=o.precede_char+e+o.follow_char;let t="";var i,n=$(a).val(),n=_atVarField?-1:(k&&("#"!=n.substr(n.length-1)&&'#["'!=n.substr(n.length-3,3)&&('"'==n.substr(n.length-1)?t="]":"]"!=n.substr(n.length-1)&&(t='"]')),s+=t),Math.max(s.lastIndexOf("["),s.lastIndexOf("]")+1,s.lastIndexOf("#")+1));-1!=n?$(a).replaceTextAt(n,$(a).val().length,t+e):$(a).insertAtCaret(t+e),0!=o.caret_offset&&(n=o.caret_offset||0,i=(e=$(a)).getCaretPosition(e),console.log({cur:i,off:n}),e.setCaretPosition(i+n,i+n)),E=o.entity,$(a).triggerHandler("mouseup")}).bind("freeboard-select",function(){$(this).parent().find("li.selected").removeClass("selected"),$(this).addClass("selected"),x=$(this).data("freeboard-optionIndex")})}(i,a,e,t);n&&($(e).addClass("selected"),n=!1)})):(R(i,e),$(i).next("ul#value-selector").remove(),C=null,x=-1)}function s(i,t,e=!0){let n;n=e?"calculated-value-input":"script-value-input",$(i).addClass(n).bind("keyup mouseup freeboard-eval",function(e){!C||"keyup"!=e.type||38!=e.keyCode&&40!=e.keyCode&&13!=e.keyCode?a(i,t):e.preventDefault()}).focus(function(){var e,t;$(i).css({"z-index":3001}),e=i,t=($(e).val().match(/\n/g)||[]).length,t=Math.min(200,20*(t+1)),$(e).css({height:t+"px"})}).focusout(function(){R(i,t),$(i).css({height:"","z-index":3e3}),$(i).next("ul#value-selector").remove(),C=null,x=-1}).bind("keydown",function(e){var t;C&&(38==e.keyCode||40==e.keyCode?(e.preventDefault(),t=$(C).find("li"),38==e.keyCode?x--:40==e.keyCode&&x++,x<0?x=t.size()-1:x>=t.size()&&(x=0),(t=$(t).eq(x)).trigger("freeboard-select"),$(C).scrollTop($(t).position().top)):13==e.keyCode&&(e.preventDefault(),-1!=x)&&$(C).find("li").eq(x).trigger("freeboard-insertValue"))})}return{createValueEditor:function(e,t,i){s(e,t||n.ANY,i)},EXPECTED_TYPE:n}},function(o){var a=window.MutationObserver||window.WebKitMutationObserver;o.fn.attrchange=function(e){var t,i,n={trackValues:!1,callback:o.noop};return"function"==typeof e?n.callback=e:o.extend(n,e),n.trackValues&&o(this).each(function(e,t){for(var i,n={},e=0,a=t.attributes,s=a.length;e<s;e++)n[(i=a.item(e)).nodeName]=i.value;o(this).data("attr-old-value",n)}),a?(t={subtree:!1,attributes:!0,attributeOldValue:n.trackValues},i=new a(function(e){e.forEach(function(e){var t=e.target;n.trackValues&&(e.newValue=o(t).attr(e.attributeName)),n.callback.call(t,e)})}),this.each(function(){i.observe(this,t)})):function(){var e=document.createElement("p"),t=!1;if(e.addEventListener)e.addEventListener("DOMAttrModified",function(){t=!0},!1);else{if(!e.attachEvent)return;e.attachEvent("onDOMAttrModified",function(){t=!0})}return e.setAttribute("id","target"),t}()?this.on("DOMAttrModified",function(e){(e=e.originalEvent?e.originalEvent:e).attributeName=e.attrName,e.oldValue=e.prevValue,n.callback.call(this,e)}):"onpropertychange"in document.body?this.on("propertychange",function(e){e.attributeName=window.event.propertyName,function(e,t){var i;e&&(e=this.data("attr-old-value"),0<=t.attributeName.indexOf("style")?(e.style||(e.style={}),i=t.attributeName.split("."),t.attributeName=i[0],t.oldValue=e.style[i[1]],t.newValue=i[1]+":"+this.prop("style")[o.camelCase(i[1])],e.style[i[1]]=t.newValue):(t.oldValue=e[t.attributeName],t.newValue=this.attr(t.attributeName),e[t.attributeName]=t.newValue),this.data("attr-old-value",e))}.call(o(this),n.trackValues,e),n.callback.call(this,e)}):this}}(jQuery),function(e){e.eventEmitter={_JQInit:function(){this._JQ=e(this)},emit:function(e,t){this._JQ||this._JQInit(),this._JQ.trigger(e,t)},once:function(e,t){this._JQ||this._JQInit(),this._JQ.one(e,t)},on:function(e,t){this._JQ||this._JQInit(),this._JQ.bind(e,t)},off:function(e,t){this._JQ||this._JQInit(),this._JQ.unbind(e,t)}}}(jQuery);var freeboard=function(){const t="nexpie.freeboard.json";var e=!0,d={},c={},l={},h=new FreeboardUI,u=new FreeboardModel(d,c,h),i=(this.freeboardmodel=u,new JSEditor),n=new ValueEditor(u),p=new PluginEditor(i,n),s=new DeveloperConsole(u),o={values:{"font-family":'"HelveticaNeue-UltraLight", "Helvetica Neue Ultra Light", "Helvetica Neue", sans-serif',color:"#d3d4d4","font-weight":100}};function r(t){if(self.dashconfig){let e=t.datasources.length;for(;e--;)("piedash_datasource"==t.datasources[e].type||"localstore_datasource"==t.datasources[e].type)&&t.datasources.splice(e,1)}}function g(e){console.log("unsaved = "+e),l(e?JSON.stringify({event:"CONFIG_UNSAVED",data:String(Date.now())}):JSON.stringify({event:"CONFIG_SAVED",data:String(Date.now())}))}return h.on("ConfigChenged",function(){}),ko.bindingHandlers.pluginEditor={init:function(i,e,t,n,a){var s=ko.unwrap(e()),o={},r=void 0,l="";"datasource"==s.type?(o=d,l="Datasource"):"widget"==s.type?(o=c,l="Widget"):"pane"==s.type&&(l="Pane"),$(i).click(function(e){var t;"clone"==s.operation?"pane"==s.type&&u.clonePane(n):"delete"==s.operation?new ConfirmModal("Confirm Delete",`Are you sure you want to delete this ${l}?`,"Delete","Cancel",function(){if("datasource"==s.type)u.deleteDatasource(n);else if("widget"==s.type)u.deleteWidget(n);else if("pane"==s.type){let e=n.col_width();n.actualColWidth||(n.actualColWidth=1),n.actualColWidth<n.col_width()&&(e=n.actualColWidth),n.col_width(e||1),u.deletePane(n)}},"error"):(t=void 0,"datasource"==s.type?"add"==s.operation?r={}:(t=n.type(),(r=n.settings()).name=n.name()):"widget"==s.type?r="add"==s.operation?{}:(t=n.type(),n.settings()):"pane"==s.type&&(r={},"edit"==s.operation&&(r.title=n.title(),r.col_width=n.col_width()),o={settings:{settings:[{name:"title",display_name:"Title",type:"text"},{name:"col_width",display_name:"Columns",type:"slider",default_value:1,required:!0,min:1,max:6}]}}),p.createPluginEditor(l,o,t,r,function(e){var t;"add"==s.operation?"datasource"==s.type?(t=new DatasourceModel(u,d),u.addDatasource(t),t.name(e.settings.name),delete e.settings.name,t.settings(e.settings),t.type(e.type)):"widget"==s.type&&((t=new WidgetModel(u,c)).settings(e.settings),t.type(e.type),n.widgets.push(t),h.attachWidgetEditIcons(i)):"edit"==s.operation&&("pane"==s.type?(n.title(e.settings.title),n.col_width(e.settings.col_width),h.processResize(!1)):("datasource"==s.type&&(n.name(e.settings.name),delete e.settings.name),n.type(e.type),n.settings(e.settings)))}))})}},ko.virtualElements.allowedBindings.datasourceTypeSettings=!0,ko.bindingHandlers.datasourceTypeSettings={update:function(e,t,i,n,a){processPluginSettings(e,t,i,n,a)}},ko.bindingHandlers.pane={init:function(e,t,i,n,a){u.isEditing()&&$(e).css({cursor:"pointer"});var s=u.isEditing();h.addPane(e,n,s)},update:function(e,t,i,n,a){-1==u.panes.indexOf(n)&&h.removePane(e),h.updatePane(e,n)}},ko.bindingHandlers.widget={init:function(e,t,i,n,a){u.isEditing()&&h.attachWidgetEditIcons($(e).parent())},update:function(e,t,i,n,a){n.shouldRender()&&($(e).empty(),n.render(e))}},$(function(){var e;function t(){h.processResize(!0)}h.showLoadingIndicator(!0),$(window).resize(function(){clearTimeout(e),e=setTimeout(t,500)});let i=null;var n=$("#board-content");n&&(n.on("touchstart",function(e){h.getGrid().enabled&&(e=e.originalEvent.changedTouches[0])&&(e=document.elementFromPoint(e.clientX,e.clientY))&&(i=$(e).attr("id"))}),n.on("touchmove",function(e){h.getGrid().enabled&&"board-background"!==i&&e.preventDefault()}),n.on("touchend",function(e){i=null}))}),{initialize:function(e,t){ko.applyBindings(u);i=(i="load").replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=null==(i=new RegExp("[\\?&]"+i+"=([^&#]*)").exec(location.search))?"":decodeURIComponent(i[1].replace(/\+/g," "));""!=i?$.ajax({url:i,success:function(e){u.loadDashboard(e),_.isFunction(t)&&t()}}):(u.allow_edit(e),u.setEditing(!1),h.showLoadingIndicator(!1),_.isFunction(t)&&t(),freeboard.emit("initialized")),freeboard.on("widget_edit_ok",function(){l(JSON.stringify({event:"WIDGET_EDIT_OK",data:{}})),g(!0)}),freeboard.on("widget_edit_cancel",function(){l(JSON.stringify({event:"WIDGET_EDIT_CANCEL",data:{}}))}),freeboard.on("enter_widget_edit_mode",function(){l(JSON.stringify({event:"ENTER_WIDGET_EDIT_MODE",data:{}}))}),freeboard.on("exit_widget_edit_mode",function(){l(JSON.stringify({event:"EXIT_WIDGET_EDIT_MODE",data:{}}))}),freeboard.on("enter_jseditor",function(){l(JSON.stringify({event:"ENTER_JSEDITOR",data:{}}))}),freeboard.on("exit_jseditor",function(){l(JSON.stringify({event:"EXIT_JSEDITOR",data:{}}))})},newDashboard:function(){u.loadDashboard({allow_edit:!0})},loadDashboard:function(e,t){u.loadDashboard(e,t)},serialize:function(){return u.serialize()},setEditing:function(e,t){e?freeboard.emit("enter_edit_mode"):(freeboard.emit("exit_edit_mode"),h.hideAllWidgetEditIcons()),u.setEditing(e,t)},isEditing:function(){return u.isEditing()},loadDatasourcePlugin:function(e){_.isUndefined(e.display_name)&&(e.display_name=e.type_name),e.settings.unshift({name:"name",display_name:"Name",type:"text",required:!0}),u.addPluginSource(e.source),d[e.type_name]=e,u._datasourceTypes.valueHasMutated()},resize:function(){h.processResize(!0)},loadWidgetPlugin:function(e){_.isUndefined(e.display_name)&&(e.display_name=e.type_name),u.addPluginSource(e.source),c[e.type_name]=e,u._widgetTypes.valueHasMutated()},setAssetRoot:function(e){i.setAssetRoot(e)},addStyle:function(e,t){e=e+"{"+t+"}",t=$("style#fb-styles");0==t.length&&(t=$('<style id="fb-styles" type="text/css"></style>'),$("head").append(t)),t[0].styleSheet?t[0].styleSheet.cssText+=e:t.text(t.text()+e)},showLoadingIndicator:function(e){h.showLoadingIndicator(e)},showDialog:function(e,t,i,n,a){new ConfirmModal(e,t,i,n,a,"warning")},getDatasourceSettings:function(t){var e=u.datasources(),e=_.find(e,function(e){return e.name()===t});return e?e.settings():null},setDatasourceSettings:function(t,e){var i=u.datasources(),i=_.find(i,function(e){return e.name()===t});i?(e=_.defaults(e,i.settings()),i.settings(e)):console.log("Datasource not found")},getStyleString:function(e){var i="";return _.each(o[e],function(e,t){i=i+t+":"+e+";"}),i},getStyleObject:function(e){return o[e]},showDeveloperConsole:function(){s.showDeveloperConsole()},resetDashboard:function(e=!0,t){e?freeboard.showDialog("Warning","Are you sure you want to CLEAR ALL?","OK","CANCEL",function(){u.resetDashboard(t)}):u.resetDashboard(t)},createPane:function(){u.createPane()},toggleEditing:function(){u.toggleEditing()},initSetting:function(e){u.initSetting(e),p.initSetting(e),i.initSetting(e)},setPostMessageCallback:function(e){l=e,u.setPostMessageCallback(e)},setConfigUnsaved:function(e){g(e)},initDash:function(e){let t;try{e&&(t=atob(e))}catch(e){console.log("Invalid token")}t&&(a=t.split(":"),self.dashconfig={platform:a[0],dashid:a[2],dashtoken:a[3],gqlhost:getPlatformGraphQLURI(a[0])})},setDashCredential({credential:e,forcereload:t}){let i=!1,n=!1;self.dashconfig||(self.dashconfig={}),e&&(void 0!==e.platform&&self.dashconfig.platform!=e.platform&&(self.dashconfig.platform=e.platform,self.dashconfig.gqlhost=getPlatformGraphQLURI(e.platform),self.dashconfig.mqtthost=getPlatformMQTTURI(e.platform),self.dashconfig.dshost=getPlatformDSURI(e.platform),i=!0),void 0!==e.dashid&&self.dashconfig.dashid!=e.dashid&&(self.dashconfig.dashid=e.dashid,i=!0),t&&(i=!0),void 0!==e.dashtoken&&self.dashconfig.dashtoken!=e.dashtoken&&(self.dashconfig.dashtoken=e.dashtoken,n=!0),i?(emitter.removeAllListeners(),freeboard.resetDashboard(!1,!0),freeboard.loadFromGraphQL()):n&&emitter.emit("DASHTOKEN_UPDATED",self.dashconfig))},initDashCredential:function(e){let t;try{e&&(t=atob(e))}catch(e){console.log("Invalid token encode")}if(t)try{var i=JSON.parse(t);switch((self.dashconfig=i).platform){case"NEXIIOT":self.dashconfig.gqlhost="https://gqlv2.nexiiot.io";break;case"NEXPIE":self.dashconfig.gqlhost="https://gqlv2.nexpie.io";break;case"NETPIE":self.dashconfig.gqlhost="https://gqlv2.netpie.io";break;case"DEV":self.dashconfig.gqlhost="https://dev-gqlv2.nexpie.io"}}catch(e){console.log("Invalid token payload")}},saveConfigToGraphQL:function(e=!0){function t(){r(dashboardjson=u.serialize());var e,i=dashboardjson,t=h.getGridColumn();for(e of i.panes){for(var n in e.col)t!=Number(n)&&delete e.col[n];for(var a in e.row)t!=Number(a)&&delete e.row[a]}if(self.dashconfig&&self.dashconfig.gqlhost){let e;var i=dashconfig?dashconfig.dashid:"",s=dashconfig?dashconfig.dashtoken:"";let t=JSON.stringify(dashboardjson);t=t.replaceAll("\\","\\\\").replaceAll('"','\\"');var o=JSON.stringify({query:`mutation {
 setDashConfig(dashid:"${dashconfig.dashid}", app:"freeboard", data:"${t}") {
 dashid 
 app 
 rev 
}
}`});e=s.startsWith("eyJ")?"Bearer "+s:`Dash ${i}:`+s,$.ajax({url:self.dashconfig.gqlhost,type:"post",data:o,headers:{Authorization:e},contentType:"application/json",success:function(e){g(!1);try{JSON.parse(e.data.dashConfig.data)}catch(e){}}})}}e?freeboard.showDialog("SAVE","Are you sure you want to SAVE SETTING?","OK","CANCEL",function(){t()}):t()},saveConfigToLocalStorage:function(){freeboard.showDialog("SAVE","Are you sure you want to SAVE SETTING?","OK","CANCEL",function(){dashboardjson=u.serialize(),window.localStorage.setItem(t,dashboardjson)})},exportDashboard:function(){var e="application/octet-stream",t=document.createElement("a"),i=u.serialize(),i=(r(i),new Blob([JSON.stringify(i,null,"\t")],{type:e}));document.body.appendChild(t),t.href=window.URL.createObjectURL(i),t.download="dashboard-config.json",t.target="_self",t.click()},loadFromLocalStorage:function(){freeboard.initialize(!0);var e=window.localStorage.getItem(t);if(null!==e){var i=e=JSON.parse(e);if(self.dashconfig){let e=i.datasources.length;for(;e--;)("piedash_datasource"==jsonconfig.datasources[e].type||"localstore_datasource"==jsonconfig.datasources[e].type)&&jsonconfig.datasources.splice(e,1);i.datasources.push({name:self.dashconfig.dashname,settings:{name:self.dashconfig.dashname,dashid:self.dashconfig.dashid,dashtoken:self.dashconfig.dashtoken,platform:self.dashconfig.platform},type:"piedash_datasource"});let t=!1;for(var n in i.datasources)if("localstore_datasource"==i.datasources[n].type){t=!0;break}t||i.datasources.push({name:"var",settings:{},type:"localstore_datasource"}),console.log("Dash Datasource configured...")}u.loadDashboard(e,function(){})}},loadFromGraphQL:async function(){if(self.dashconfig&&self.dashconfig.gqlhost){let e;var t=dashconfig?dashconfig.dashid:"",i=dashconfig?dashconfig.dashtoken:"";if(i.startsWith("eyJ")){let e=0;a=t,s=i;var n=await new Promise((t,e)=>{var i=JSON.stringify({query:`query {
 myDashLevelInfo(dashid:"${a}") {
 dashid 
 dashname 
 dashdescription 
 level 
 enabled 
 }
}`});auth_header="Bearer "+s,$.ajax({url:self.dashconfig.gqlhost,type:"post",data:i,headers:{Authorization:auth_header},contentType:"application/json",success:function(e){t(e.data.myDashLevelInfo)}})});n?(e=3<=n.level?3:1,l(JSON.stringify({event:"DASH_INFO",data:{dashid:t,dashname:n.dashname,platform:dashconfig.platform,enabled:n.enabled,level:e}}))):1!==n?.level||3!==n?.level?l(JSON.stringify({event:"UNAUTHORIZED",data:null})):l(JSON.stringify({event:"DASH_NOT_AVAILABLE",data:null}))}else{if(o=t,r=i,n=await new Promise((t,e)=>{var i=JSON.stringify({query:`query {
 dashTokenInfo(dashid:"${o}", dashtoken:"${r}") {
 dashid 
 dashtoken 
 dashname 
 dashtokenname 
 dashdescription 
 level 
 enabled 
}
}`});auth_header=r.startsWith("eyJ")?"Bearer "+r:`Dash ${o}:`+r,$.ajax({url:self.dashconfig.gqlhost,type:"post",data:i,headers:{Authorization:auth_header},contentType:"application/json",success:function(e){t(e.data.dashTokenInfo)}})}),console.log(n),!n)return void l(JSON.stringify({event:"DASH_NOT_AVAILABLE",data:null}));l(JSON.stringify({event:"DASH_INFO",data:{dashid:t,dashname:n.dashname,dashtokenname:n.dashtokenname,platform:dashconfig.platform,enabled:n.enabled,level:n.level}}))}n=JSON.stringify({query:`query {
 dashConfig(dashid:"${t}") {
 dashid 
 rev 
 data 
}
}`});e=i.startsWith("eyJ")?"Bearer "+i:`Dash ${t}:`+i,$.ajax({url:self.dashconfig.gqlhost,type:"post",data:n,headers:{Authorization:e},contentType:"application/json",success:function(e){let t;try{e.data.dashConfig?t=e.data.dashConfig[0]&&e.data.dashConfig[0].data?JSON.parse(e.data.dashConfig[0].data):{version:1,allow_edit:!0,plugins:[],panes:[],datasources:[]}:l(JSON.stringify({event:"UNAUTHORIZED",data:null}))}catch(e){}if(t){if(self.dashconfig){let e=t.datasources.length;for(;e--;)"piedash_datasource"==t.datasources[e].type&&t.datasources.splice(e,1);t.datasources.push({name:"dash",settings:{name:"dash",dashid:self.dashconfig.dashid,dashtoken:self.dashconfig.dashtoken,platform:self.dashconfig.platform},type:"piedash_datasource"}),console.log("Dash configured...")}let e=!1;for(var i in t.datasources)if("localstore_datasource"==t.datasources[i].type){e=!0;break}e||t.datasources.push({name:"var",settings:{namespace:self.dashconfig.dashid},type:"localstore_datasource"}),t.columns=6,u.loadDashboard(t,function(){u.setEditing(!1)})}}})}var a,s,o,r},loadDashboardFromLocalFile:function(){return u.loadDashboardFromLocalFile()},isConfigSaved:function(){return e},getEditStatus:function(){return{isEditing:u.isEditing(),allow_edit:u.allow_edit()}},closeDialogBox(){freeboard.emit("force_close_dialog_box")},widgetSettingCancel(){freeboard.emit("force_dialog_box_cancel")},widgetSettingSave(){freeboard.emit("force_dialog_box_ok")},jsEditorSave(){freeboard.emit("force_jseditor_ok")}}}();$.extend(freeboard,jQuery.eventEmitter),function(_,O,F){var e;e=function(R){"use strict";var v,I,y,N,T,A,d,C,e,s,c,M,l,t,D,L,r,o,h,u,w,n,p,g,a,f={},m=0,i=function(){return{common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:F,normalRangeMax:F,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:F,chartRangeMax:F,chartRangeMinX:F,chartRangeMaxX:F,tooltipFormat:new v('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:F,nullColor:F,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:F,chartRangeMin:F,chartRangeClip:!1,colorMap:F,tooltipFormat:new v('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new v('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss",0:"Draw",1:"Win"}}},discrete:{lineHeight:"auto",thresholdColor:F,thresholdValue:0,chartRangeMax:F,chartRangeMin:F,chartRangeClip:!1,tooltipFormat:new v("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:F,tooltipFormat:new v("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],borderWidth:0,borderColor:"#000",tooltipFormat:new v('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:F,targetColor:"#4a2",chartRangeMax:F,chartRangeMin:F,tooltipFormat:new v("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}}},b=function(){var e,t=function(){this.init.apply(this,arguments)};return 1<arguments.length?(arguments[0]?(t.prototype=R.extend(new arguments[0],arguments[arguments.length-1]),t._super=arguments[0].prototype):t.prototype=arguments[arguments.length-1],2<arguments.length&&((e=Array.prototype.slice.call(arguments,1,-1)).unshift(t.prototype),R.extend.apply(R,e))):t.prototype=arguments[0],t.prototype.cls=t};R.SPFormatClass=v=b({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(e,t){this.format=e,this.fclass=t},render:function(e,t,i){var n,a,s,o,r=this,l=e;return this.format.replace(this.fre,function(){return n=arguments[1],a=arguments[3],(s=r.precre.exec(n))?(o=s[2],n=s[1]):o=!1,(s=l[n])===F?"":a&&t&&t[a]?t[a].get?t[a].get(s)||s:t[a][s]||s:s=d(s)?i.get("numberFormatter")?i.get("numberFormatter")(s):c(s,o,i.get("numberDigitGroupCount"),i.get("numberDigitGroupSep"),i.get("numberDecimalMark")):s})}}),R.spformat=function(e,t){return new v(e,t)},I=function(e,t,i){return e<t?t:i<e?i:e},y=function(e,t){var i;return 2===t?(i=O.floor(e.length/2),e.length%2?e[i]:(e[i-1]+e[i])/2):(i=e.length%2?(e.length*t+t)/4:(e.length*t+2)/4)%1?(e[O.floor(i)]+e[O.floor(i)-1])/2:e[i-1]},N=function(e){var t;switch(e){case"undefined":e=F;break;case"null":e=null;break;case"true":e=!0;break;case"false":e=!1;break;default:e==(t=parseFloat(e))&&(e=t)}return e},T=function(e){for(var t=[],i=e.length;i--;)t[i]=N(e[i]);return t},A=function(e,t){for(var i=[],n=0,a=e.length;n<a;n++)e[n]!==t&&i.push(e[n]);return i},d=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},c=function(e,t,i,n,a){var s;for(e=(!1===t?parseFloat(e).toString():e.toFixed(t)).split(""),(t=(t=R.inArray(".",e))<0?e.length:t)<e.length&&(e[t]=a),s=t-i;0<s;s-=i)e.splice(s,0,n);return e.join("")},C=function(e,t,i){for(var n=t.length;n--;)if((!i||null!==t[n])&&t[n]!==e)return!1;return!0},s=function(e){return R.isArray(e)?e:[e]},e=function(e){var t;_.createStyleSheet?_.createStyleSheet().cssText=e:((t=_.createElement("style")).type="text/css",_.getElementsByTagName("head")[0].appendChild(t),t["string"==typeof _.body.style.WebkitAppearance?"innerText":"innerHTML"]=e)},R.fn.simpledraw=function(e,t,i,n){var a;if(!i||!(a=this.data("_jqs_vcanvas"))){if(!1===R.fn.sparkline.canvas)return!1;if(R.fn.sparkline.canvas===F){var i=_.createElement("canvas");if(i.getContext&&i.getContext("2d"))R.fn.sparkline.canvas=function(e,t,i,n){return new p(e,t,i,n)};else{if(!_.namespaces||_.namespaces.v)return R.fn.sparkline.canvas=!1;_.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),R.fn.sparkline.canvas=function(e,t,i,n){return new g(e,t,i)}}}e===F&&(e=R(this).innerWidth()),t===F&&(t=R(this).innerHeight()),a=R.fn.sparkline.canvas(e,t,this,n),(i=R(this).data("_jqs_mhandler"))&&i.registerCanvas(a)}return a},R.fn.cleardraw=function(){var e=this.data("_jqs_vcanvas");e&&e.reset()},R.RangeMapClass=M=b({init:function(e){var t,i,n=[];for(t in e)e.hasOwnProperty(t)&&"string"==typeof t&&-1<t.indexOf(":")&&(i=t.split(":"),i[0]=0===i[0].length?-1/0:parseFloat(i[0]),i[1]=0===i[1].length?1/0:parseFloat(i[1]),i[2]=e[t],n.push(i));this.map=e,this.rangelist=n||!1},get:function(e){var t,i,n,a=this.rangelist;if((n=this.map[e])!==F)return n;if(a)for(t=a.length;t--;)if((i=a[t])[0]<=e&&i[1]>=e)return i[2];return F}}),R.range_map=function(e){return new M(e)},l=b({init:function(e,t){var i=R(e);this.$el=i,this.options=t,this.currentPageX=0,this.currentPageY=0,this.el=e,this.splist=[],this.tooltip=null,this.over=!1,this.displayTooltips=!t.get("disableTooltips"),this.highlightEnabled=!t.get("disableHighlight")},registerSparkline:function(e){this.splist.push(e),this.over&&this.updateDisplay()},registerCanvas:function(e){var t=R(e.canvas);this.canvas=e,(this.$canvas=t).mouseenter(R.proxy(this.mouseenter,this)),t.mouseleave(R.proxy(this.mouseleave,this)),t.click(R.proxy(this.mouseclick,this))},reset:function(e){this.splist=[],this.tooltip&&e&&(this.tooltip.remove(),this.tooltip=F)},mouseclick:function(e){var t=R.Event("sparklineClick");t.originalEvent=e,t.sparklines=this.splist,this.$el.trigger(t)},mouseenter:function(e){R(_.body).unbind("mousemove.jqs"),R(_.body).bind("mousemove.jqs",R.proxy(this.mousemove,this)),this.over=!0,this.currentPageX=e.pageX,this.currentPageY=e.pageY,this.currentEl=e.target,!this.tooltip&&this.displayTooltips&&(this.tooltip=new t(this.options),this.tooltip.updatePosition(e.pageX,e.pageY)),this.updateDisplay()},mouseleave:function(){R(_.body).unbind("mousemove.jqs");var e,t=this.splist,i=t.length,n=!1;for(this.over=!1,this.currentEl=null,this.tooltip&&(this.tooltip.remove(),this.tooltip=null),e=0;e<i;e++)t[e].clearRegionHighlight()&&(n=!0);n&&this.canvas.render()},mousemove:function(e){this.currentPageX=e.pageX,this.currentPageY=e.pageY,this.currentEl=e.target,this.tooltip&&this.tooltip.updatePosition(e.pageX,e.pageY),this.updateDisplay()},updateDisplay:function(){var e,t,i,n=this.splist,a=n.length,s=!1,o=this.$canvas.offset(),r=this.currentPageX-o.left,l=this.currentPageY-o.top;if(this.over){for(t=0;t<a;t++)(i=n[t].setRegionHighlight(this.currentEl,r,l))&&(s=!0);if(s){if((o=R.Event("sparklineRegionChange")).sparklines=this.splist,this.$el.trigger(o),this.tooltip){for(e="",t=0;t<a;t++)e+=n[t].getCurrentRegionTooltip();this.tooltip.setContent(e)}this.disableHighlight||this.canvas.render()}null===i&&this.mouseleave()}}}),t=b({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(e){var t=e.get("tooltipClassname","jqstooltip"),i=this.sizeStyle;this.container=e.get("tooltipContainer")||_.body,this.tooltipOffsetX=e.get("tooltipOffsetX",10),this.tooltipOffsetY=e.get("tooltipOffsetY",12),R("#jqssizetip").remove(),R("#jqstooltip").remove(),this.sizetip=R("<div/>",{id:"jqssizetip",style:i,class:t}),this.tooltip=R("<div/>",{id:"jqstooltip",class:t}).appendTo(this.container),e=this.tooltip.offset(),this.offsetLeft=e.left,this.offsetTop=e.top,this.hidden=!0,R(window).unbind("resize.jqs scroll.jqs"),R(window).bind("resize.jqs scroll.jqs",R.proxy(this.updateWindowDims,this)),this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=R(window).scrollTop(),this.scrollLeft=R(window).scrollLeft(),this.scrollRight=this.scrollLeft+R(window).width(),this.updatePosition()},getSize:function(e){this.sizetip.html(e).appendTo(this.container),this.width=this.sizetip.width()+1,this.height=this.sizetip.height(),this.sizetip.remove()},setContent:function(e){e?(this.getSize(e),this.tooltip.html(e).css({width:this.width,height:this.height,visibility:"visible"}),this.hidden&&(this.hidden=!1,this.updatePosition())):(this.tooltip.css("visibility","hidden"),this.hidden=!0)},updatePosition:function(e,t){if(e===F){if(this.mousex===F)return;e=this.mousex-this.offsetLeft,t=this.mousey-this.offsetTop}else this.mousex=e-=this.offsetLeft,this.mousey=t-=this.offsetTop;this.height&&this.width&&!this.hidden&&(t-=this.height+this.tooltipOffsetY,e+=this.tooltipOffsetX,t<this.scrollTop&&(t=this.scrollTop),e<this.scrollLeft?e=this.scrollLeft:e+this.width>this.scrollRight&&(e=this.scrollRight-this.width),this.tooltip.css({left:e,top:t}))},remove:function(){this.tooltip.remove(),this.sizetip.remove(),this.sizetip=this.tooltip=F,R(window).unbind("resize.jqs scroll.jqs")}}),R(function(){e('.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}')}),a=[],R.fn.sparkline=function(r,i){return this.each(function(){var e,s=new R.fn.sparkline.options(this,i),o=R(this),t=function(){var e,t,i,n="html"===r||r===F?(n=(n=this.getAttribute(s.get("tagValuesAttribute")))!==F&&null!==n?n:o.html()).replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(","):r,a="auto"===s.get("width")?n.length*s.get("defaultPixelsPerValue"):s.get("width");"auto"===s.get("height")?s.get("composite")&&R.data(this,"_jqs_vcanvas")||((i=_.createElement("span")).innerHTML="a",o.html(i),e=R(i).innerHeight()||R(i).height(),R(i).remove(),i=null):e=s.get("height"),s.get("disableInteraction")?t=!1:(t=R.data(this,"_jqs_mhandler"))?s.get("composite")||t.reset():(t=new l(this,s),R.data(this,"_jqs_mhandler",t)),s.get("composite")&&!R.data(this,"_jqs_vcanvas")?R.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),R.data(this,"_jqs_errnotify",!0)):((i=new R.fn.sparkline[s.get("type")](this,n,s,a,e)).render(),t&&t.registerSparkline(i))};if(R(this).html()&&!s.get("disableHiddenCheck")&&R(this).is(":hidden")||!R(this).parents("body").length){if(!s.get("composite")&&R.data(this,"_jqs_pending"))for(e=a.length;e;e--)a[e-1][0]==this&&a.splice(e-1,1);a.push([this,t]),R.data(this,"_jqs_pending",!0)}else t.call(this)})},R.fn.sparkline.defaults=i(),R.sparkline_display_visible=function(){for(var e,t=[],i=0,n=a.length;i<n;i++)e=a[i][0],R(e).is(":visible")&&!R(e).parents().is(":hidden")?(a[i][1].call(e),R.data(a[i][0],"_jqs_pending",!1),t.push(i)):R(e).closest("html").length||R.data(e,"_jqs_pending")||(R.data(a[i][0],"_jqs_pending",!1),t.push(i));for(i=t.length;i;i--)a.splice(t[i-1],1)},R.fn.sparkline.options=b({init:function(e,t){var i,n;this.userOptions=t=t||{},this.tag=e,this.tagValCache={},i=(e=R.fn.sparkline.defaults).common,this.tagOptionsPrefix=t.enableTagOptions&&(t.tagOptionsPrefix||i.tagOptionsPrefix),e=(n=this.getTagSetting("type"))===f?e[t.type||i.type]:e[n],this.mergedOptions=R.extend({},i,e,t)},getTagSetting:function(e){var t,i,n,a,s=this.tagOptionsPrefix;if(!1===s||s===F)return f;if(this.tagValCache.hasOwnProperty(e))t=this.tagValCache.key;else{if((t=this.tag.getAttribute(s+e))===F||null===t)t=f;else if("["===t.substr(0,1))for(i=(t=t.substr(1,t.length-2).split(",")).length;i--;)t[i]=N(t[i].replace(/(^\s*)|(\s*$)/g,""));else if("{"===t.substr(0,1))for(n=t.substr(1,t.length-2).split(","),t={},i=n.length;i--;)t[(a=n[i].split(":",2))[0].replace(/(^\s*)|(\s*$)/g,"")]=N(a[1].replace(/(^\s*)|(\s*$)/g,""));else t=N(t);this.tagValCache.key=t}return t},get:function(e,t){var i=this.getTagSetting(e);return i!==f?i:(i=this.mergedOptions[e])===F?t:i}}),R.fn.sparkline._base=b({disabled:!1,init:function(e,t,i,n,a){this.el=e,this.$el=R(e),this.values=t,this.options=i,this.width=n,this.height=a,this.currentRegion=F},initTarget:function(){var e=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),e))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return!this.disabled||(this.el.innerHTML="",!1)},getRegion:function(e,t){},setRegionHighlight:function(e,t,i){var n=this.currentRegion,a=!this.options.get("disableHighlight");return t>this.canvasWidth||i>this.canvasHeight||t<0||i<0?null:n!==(e=this.getRegion(e,t,i))&&(n!==F&&a&&this.removeHighlight(),(this.currentRegion=e)!==F&&a&&this.renderHighlight(),!0)},clearRegionHighlight:function(){return this.currentRegion!==F&&(this.removeHighlight(),!(this.currentRegion=F))},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(e){},getCurrentRegionTooltip:function(){var e,t,i,n,a,s,o,r,l,d,c,h,u,p,g=this.options,f="",m=[];if(this.currentRegion===F)return"";if(e=this.getCurrentRegionFields(),c=g.get("tooltipFormatter"))return c(this,g,e);if(g.get("tooltipChartTitle")&&(f+='<div class="jqs jqstitle">'+g.get("tooltipChartTitle")+"</div>\n"),!(t=this.options.get("tooltipFormat")))return"";if(R.isArray(t)||(t=[t]),R.isArray(e)||(e=[e]),o=this.options.get("tooltipFormatFieldlist"),r=this.options.get("tooltipFormatFieldlistKey"),o&&r){for(l=[],s=e.length;s--;)d=e[s][r],-1!=(p=R.inArray(d,o))&&(l[p]=e[s]);e=l}for(i=t.length,u=e.length,s=0;s<i;s++)for(n=(h="string"==typeof(h=t[s])?new v(h):h).fclass||"jqsfield",p=0;p<u;p++)e[p].isNull&&g.get("tooltipSkipNull")||(R.extend(e[p],{prefix:g.get("tooltipPrefix"),suffix:g.get("tooltipSuffix")}),a=h.render(e[p],g.get("tooltipValueLookups"),g),m.push('<div class="'+n+'">'+a+"</div>"));return m.length?f+m.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(e,t){var i,n,a,s,o=t.get("highlightColor"),r=t.get("highlightLighten");if(o)return o;if(r&&(i=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(e))){for(a=[],n=4===e.length?16:1,s=0;s<3;s++)a[s]=I(O.round(parseInt(i[s+1],16)*n*r),0,255);return"rgb("+a.join(",")+")"}return e}}),i={changeHighlight:function(e){var t=this.currentRegion,i=this.target,n=this.regionShapes[t];n&&(e=this.renderRegion(t,e),R.isArray(e)||R.isArray(n)?(i.replaceWithShapes(n,e),this.regionShapes[t]=R.map(e,function(e){return e.id})):(i.replaceWithShape(n,e),this.regionShapes[t]=e.id))},render:function(){var e,t,i,n,a=this.values,s=this.target,o=this.regionShapes;if(this.cls._super.render.call(this)){for(i=a.length;i--;)if(e=this.renderRegion(i))if(R.isArray(e)){for(t=[],n=e.length;n--;)e[n].append(),t.push(e[n].id);o[i]=t}else e.append(),o[i]=e.id;else o[i]=null;s.render()}}},R.fn.sparkline.line=D=b(R.fn.sparkline._base,{type:"line",init:function(e,t,i,n,a){D._super.init.call(this,e,t,i,n,a),this.vertices=[],this.regionMap=[],this.xvalues=[],this.yvalues=[],this.yminmax=[],this.hightlightSpotId=null,this.lastShapeId=null,this.initTarget()},getRegion:function(e,t,i){for(var n=this.regionMap,a=n.length;a--;)if(null!==n[a]&&t>=n[a][0]&&t<=n[a][1])return n[a][2];return F},getCurrentRegionFields:function(){var e=this.currentRegion;return{isNull:null===this.yvalues[e],x:this.xvalues[e],y:this.yvalues[e],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:e}},renderHighlight:function(){var e=this.currentRegion,t=this.target,e=this.vertices[e],i=this.options,n=i.get("spotRadius"),a=i.get("highlightSpotColor"),i=i.get("highlightLineColor");e&&(n&&a&&(n=t.drawCircle(e[0],e[1],n,F,a),this.highlightSpotId=n.id,t.insertAfterShape(this.lastShapeId,n)),i)&&(a=t.drawLine(e[0],this.canvasTop,e[0],this.canvasTop+this.canvasHeight,i),this.highlightLineId=a.id,t.insertAfterShape(this.lastShapeId,a))},removeHighlight:function(){var e=this.target;this.highlightSpotId&&(e.removeShapeId(this.highlightSpotId),this.highlightSpotId=null),this.highlightLineId&&(e.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){for(var e,t,i,n,a=this.values,s=a.length,o=this.xvalues,r=this.yvalues,l=this.yminmax,d=0;d<s;d++)e=a[d],t="string"==typeof a[d],i="object"==typeof a[d]&&a[d]instanceof Array,n=t&&a[d].split(":"),t&&2===n.length?(o.push(Number(n[0])),r.push(Number(n[1])),l.push(Number(n[1]))):i?(o.push(e[0]),r.push(e[1]),l.push(e[1])):(o.push(d),null===a[d]||"null"===a[d]?r.push(null):(r.push(Number(e)),l.push(Number(e))));this.options.get("xvalues")&&(o=this.options.get("xvalues")),this.maxy=this.maxyorg=O.max.apply(O,l),this.miny=this.minyorg=O.min.apply(O,l),this.maxx=O.max.apply(O,o),this.minx=O.min.apply(O,o),this.xvalues=o,this.yvalues=r,this.yminmax=l},processRangeOptions:function(){var e=this.options,t=e.get("normalRangeMin"),i=e.get("normalRangeMax");t!==F&&(t<this.miny&&(this.miny=t),i>this.maxy)&&(this.maxy=i),e.get("chartRangeMin")!==F&&(e.get("chartRangeClip")||e.get("chartRangeMin")<this.miny)&&(this.miny=e.get("chartRangeMin")),e.get("chartRangeMax")!==F&&(e.get("chartRangeClip")||e.get("chartRangeMax")>this.maxy)&&(this.maxy=e.get("chartRangeMax")),e.get("chartRangeMinX")!==F&&(e.get("chartRangeClipX")||e.get("chartRangeMinX")<this.minx)&&(this.minx=e.get("chartRangeMinX")),e.get("chartRangeMaxX")!==F&&(e.get("chartRangeClipX")||e.get("chartRangeMaxX")>this.maxx)&&(this.maxx=e.get("chartRangeMaxX"))},drawNormalRange:function(e,t,i,n,a){var s=this.options.get("normalRangeMin"),o=this.options.get("normalRangeMax"),t=t+O.round(i-i*((o-this.miny)/a)),i=O.round(i*(o-s)/a);this.target.drawRect(e,t,n,i,F,this.options.get("normalRangeColor")).append()},render:function(){var e,t,i,n,a,s,o,r,l,d,c,h,u,p,g,f,m,v,b,y,w,_,C=this.options,x=this.target,S=this.canvasWidth,k=this.canvasHeight,E=this.vertices,$=C.get("spotRadius"),I=this.regionMap;if(D._super.render.call(this)&&(this.scanValues(),this.processRangeOptions(),y=this.xvalues,w=this.yvalues,this.yminmax.length)&&!(this.yvalues.length<2)){for(n=a=0,e=this.maxx-this.minx==0?1:this.maxx-this.minx,t=this.maxy-this.miny==0?1:this.maxy-this.miny,i=this.yvalues.length-1,($=$&&(S<4*$||k<4*$)?0:$)&&(((v=C.get("highlightSpotColor")&&!C.get("disableInteraction"))||C.get("minSpotColor")||C.get("spotColor")&&w[i]===this.miny)&&(k-=O.ceil($)),(v||C.get("maxSpotColor")||C.get("spotColor")&&w[i]===this.maxy)&&(k-=O.ceil($),n+=O.ceil($)),!v&&(!C.get("minSpotColor")&&!C.get("maxSpotColor")||w[0]!==this.miny&&w[0]!==this.maxy)||(a+=O.ceil($),S-=O.ceil($)),v||C.get("spotColor")||C.get("minSpotColor")||C.get("maxSpotColor")&&(w[i]===this.miny||w[i]===this.maxy))&&(S-=O.ceil($)),k--,C.get("normalRangeMin")===F||C.get("drawNormalOnTop")||this.drawNormalRange(a,n,k,S,t),o=[s=[]],c=null,u=w.length,_=0;_<u;_++)r=y[_],h=y[_+1],l=w[_],d=a+O.round((r-this.minx)*(S/e)),h=_<u-1?a+O.round((h-this.minx)*(S/e)):S,I[_]=[c||0,h=d+(h-d)/2,_],c=h,null===l?_&&(null!==w[_-1]&&o.push(s=[]),E.push(null)):((l=l<this.miny?this.miny:l)>this.maxy&&(l=this.maxy),s.length||s.push([d,n+k]),h=[d,n+O.round(k-k*((l-this.miny)/t))],s.push(h),E.push(h));for(p=[],g=[],f=o.length,_=0;_<f;_++)(s=o[_]).length&&(C.get("fillColor")&&(s.push([s[s.length-1][0],n+k]),g.push(s.slice(0)),s.pop()),2<s.length&&(s[0]=[s[0][0],s[1][1]]),p.push(s));for(f=g.length,_=0;_<f;_++)x.drawShape(g[_],C.get("fillColor"),C.get("fillColor")).append();for(C.get("normalRangeMin")!==F&&C.get("drawNormalOnTop")&&this.drawNormalRange(a,n,k,S,t),f=p.length,_=0;_<f;_++)x.drawShape(p[_],C.get("lineColor"),F,C.get("lineWidth")).append();if($&&C.get("valueSpots"))for((m=C.get("valueSpots")).get===F&&(m=new M(m)),_=0;_<u;_++)(b=m.get(w[_]))&&x.drawCircle(a+O.round((y[_]-this.minx)*(S/e)),n+O.round(k-k*((w[_]-this.miny)/t)),$,F,b).append();$&&C.get("spotColor")&&null!==w[i]&&x.drawCircle(a+O.round((y[y.length-1]-this.minx)*(S/e)),n+O.round(k-k*((w[i]-this.miny)/t)),$,F,C.get("spotColor")).append(),this.maxy!==this.minyorg&&($&&C.get("minSpotColor")&&(r=y[R.inArray(this.minyorg,w)],x.drawCircle(a+O.round((r-this.minx)*(S/e)),n+O.round(k-k*((this.minyorg-this.miny)/t)),$,F,C.get("minSpotColor")).append()),$)&&C.get("maxSpotColor")&&(r=y[R.inArray(this.maxyorg,w)],x.drawCircle(a+O.round((r-this.minx)*(S/e)),n+O.round(k-k*((this.maxyorg-this.miny)/t)),$,F,C.get("maxSpotColor")).append()),this.lastShapeId=x.getLastShapeId(),this.canvasTop=n,x.render()}}}),R.fn.sparkline.bar=L=b(R.fn.sparkline._base,i,{type:"bar",init:function(e,t,i,n,a){var s,o,r,l,d,c,h,u,p,g,f=parseInt(i.get("barWidth"),10),m=parseInt(i.get("barSpacing"),10),v=i.get("chartRangeMin"),b=i.get("chartRangeMax"),y=i.get("chartRangeClip"),w=1/0,_=-1/0;for(L._super.init.call(this,e,t,i,n,a),E=0,$=t.length;E<$;E++)((s="string"==typeof(p=t[E])&&-1<p.indexOf(":"))||R.isArray(p))&&(l=!0,s&&(p=t[E]=T(p.split(":"))),p=A(p,null),(s=O.min.apply(O,p))<w&&(w=s),_<(s=O.max.apply(O,p)))&&(_=s);this.stacked=l,this.regionShapes={},this.barWidth=f,this.barSpacing=m,this.totalBarWidth=f+m,this.width=n=t.length*f+(t.length-1)*m,this.initTarget(),y&&(o=v===F?-1/0:v,r=b===F?1/0:b);for(var C=[],x=l?[]:C,S=[],k=[],E=0,$=t.length;E<$;E++)if(l)for(d=t[E],t[E]=u=[],c=x[E]=k[E]=S[E]=0,h=d.length;c<h;c++)null!==(p=u[c]=y?I(d[c],o,r):d[c])&&(0<p&&(S[E]+=p),w<0&&0<_?p<0?k[E]+=O.abs(p):x[E]+=p:x[E]+=O.abs(p-(p<0?_:w)),C.push(p));else p=y?I(t[E],o,r):t[E],null!==(p=t[E]=N(p))&&C.push(p);this.max=e=O.max.apply(O,C),this.min=a=O.min.apply(O,C),this.stackMax=_=l?O.max.apply(O,S):e,this.stackMin=w=l?O.min.apply(O,C):a,i.get("chartRangeMin")!==F&&(i.get("chartRangeClip")||i.get("chartRangeMin")<a)&&(a=i.get("chartRangeMin")),i.get("chartRangeMax")!==F&&(i.get("chartRangeClip")||i.get("chartRangeMax")>e)&&(e=i.get("chartRangeMax")),this.zeroAxis=f=i.get("zeroAxis",!0),this.xaxisOffset=m=a<=0&&0<=e&&f?0:0==f||0<a?a:e,n=l?O.max.apply(O,x)+O.max.apply(O,k):e-a,this.canvasHeightEf=f&&a<0?this.canvasHeight-2:this.canvasHeight-1,a<m?(g=((l&&0<=e?_:e)-m)/n*this.canvasHeight)!==O.ceil(g)&&(this.canvasHeightEf-=2,g=O.ceil(g)):g=this.canvasHeight,this.yoffset=g,R.isArray(i.get("colorMap"))?(this.colorMapByIndex=i.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=i.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===F&&(this.colorMapByValue=new M(this.colorMapByValue))),this.range=n},getRegion:function(e,t,i){t=O.floor(t/this.totalBarWidth);return t<0||t>=this.values.length?F:t},getCurrentRegionFields:function(){for(var e,t=this.currentRegion,i=s(this.values[t]),n=[],a=i.length;a--;)e=i[a],n.push({isNull:null===e,value:e,color:this.calcColor(a,e,t),offset:t});return n},calcColor:function(e,t,i){var n=this.colorMapByIndex,a=this.colorMapByValue,s=this.options,o=this.stacked?s.get("stackedBarColor"):t<0?s.get("negBarColor"):s.get("barColor");return 0===t&&s.get("zeroColor")!==F&&(o=s.get("zeroColor")),a&&(s=a.get(t))?o=s:n&&n.length>i&&(o=n[i]),R.isArray(o)?o[e%o.length]:o},renderRegion:function(e,t){var i,n,a,s,o,r,l,d=this.values[e],c=this.options,h=this.xaxisOffset,u=[],p=this.range,g=this.stacked,f=this.target,m=e*this.totalBarWidth,v=this.canvasHeightEf,b=this.yoffset,y=(d=R.isArray(d)?d:[d]).length,w=(d[0],C(null,d)),_=C(h,d,!0);if(w)return c.get("nullColor")?(a=t?c.get("nullColor"):this.calcHighlightColor(c.get("nullColor"),c),f.drawRect(m,i=0<b?b-1:b,this.barWidth-1,0,a,a)):F;for(s=b,o=0;o<y;o++){if(l=d[o],g&&l===h){if(!_||r)continue;r=!0}n=0<p?O.floor(v*(O.abs(l-h)/p))+1:1,l<h||l===h&&0===b?(i=s,s+=n):(i=b-n,b-=n),a=this.calcColor(o,l,e),t&&(a=this.calcHighlightColor(a,c)),u.push(f.drawRect(m,i,this.barWidth-1,n-1,a,a))}return 1===u.length?u[0]:u}}),R.fn.sparkline.tristate=r=b(R.fn.sparkline._base,i,{type:"tristate",init:function(e,t,i,n,a){var s=parseInt(i.get("barWidth"),10),o=parseInt(i.get("barSpacing"),10);r._super.init.call(this,e,t,i,n,a),this.regionShapes={},this.barWidth=s,this.barSpacing=o,this.totalBarWidth=s+o,this.values=R.map(t,Number),this.width=n=t.length*s+(t.length-1)*o,R.isArray(i.get("colorMap"))?(this.colorMapByIndex=i.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=i.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===F&&(this.colorMapByValue=new M(this.colorMapByValue))),this.initTarget()},getRegion:function(e,t,i){return O.floor(t/this.totalBarWidth)},getCurrentRegionFields:function(){var e=this.currentRegion;return{isNull:this.values[e]===F,value:this.values[e],color:this.calcColor(this.values[e],e),offset:e}},calcColor:function(e,t){var i=this.values,n=this.options,a=this.colorMapByIndex,s=this.colorMapByValue,e=s&&(s=s.get(e))?s:a&&a.length>t?a[t]:i[t]<0?n.get("negBarColor"):0<i[t]?n.get("posBarColor"):n.get("zeroBarColor");return e},renderRegion:function(e,t){var i,n=this.values,a=this.options,s=this.target,o=s.pixelHeight,o=O.round(o/2),r=e*this.totalBarWidth,o=n[e]<0?(i=o)-1:0<n[e]?(i=0,o-1):(i=o-1,2),n=this.calcColor(n[e],e);if(null!==n)return t&&(n=this.calcHighlightColor(n,a)),s.drawRect(r,i,this.barWidth-1,o-1,n,n)}}),R.fn.sparkline.discrete=o=b(R.fn.sparkline._base,i,{type:"discrete",init:function(e,t,i,n,a){o._super.init.call(this,e,t,i,n,a),this.regionShapes={},this.values=t=R.map(t,Number),this.min=O.min.apply(O,t),this.max=O.max.apply(O,t),this.range=this.max-this.min,this.width=n="auto"===i.get("width")?2*t.length:this.width,this.interval=O.floor(n/t.length),this.itemWidth=n/t.length,i.get("chartRangeMin")!==F&&(i.get("chartRangeClip")||i.get("chartRangeMin")<this.min)&&(this.min=i.get("chartRangeMin")),i.get("chartRangeMax")!==F&&(i.get("chartRangeClip")||i.get("chartRangeMax")>this.max)&&(this.max=i.get("chartRangeMax")),this.initTarget(),this.target&&(this.lineHeight="auto"===i.get("lineHeight")?O.round(.3*this.canvasHeight):i.get("lineHeight"))},getRegion:function(e,t,i){return O.floor(t/this.itemWidth)},getCurrentRegionFields:function(){var e=this.currentRegion;return{isNull:this.values[e]===F,value:this.values[e],offset:e}},renderRegion:function(e,t){var i=this.values,n=this.options,a=this.min,s=this.max,o=this.range,r=this.interval,l=this.target,d=this.canvasHeight,c=this.lineHeight,d=d-c,i=I(i[e],a,s),s=e*r,e=O.round(d-(i-a)/o*d),r=n.get("thresholdColor")&&i<n.get("thresholdValue")?n.get("thresholdColor"):n.get("lineColor");return t&&(r=this.calcHighlightColor(r,n)),l.drawLine(s,e,s,e+c,r)}}),R.fn.sparkline.bullet=h=b(R.fn.sparkline._base,{type:"bullet",init:function(e,t,i,n,a){var s;h._super.init.call(this,e,t,i,n,a),this.values=t=T(t),(e=t.slice())[0]=null===e[0]?e[2]:e[0],e[1]=null===t[1]?e[2]:e[1],e=O.min.apply(O,t),s=O.max.apply(O,t),e=i.get("base")===F?e<0?e:0:i.get("base"),this.min=e,this.max=s,this.range=s-e,this.shapes={},this.valueShapes={},this.regiondata={},this.width=n="auto"===i.get("width")?"4.0em":n,this.target=this.$el.simpledraw(n,a,i.get("composite")),t.length||(this.disabled=!0),this.initTarget()},getRegion:function(e,t,i){e=this.target.getShapeAt(e,t,i);return e!==F&&this.shapes[e]!==F?this.shapes[e]:F},getCurrentRegionFields:function(){var e=this.currentRegion;return{fieldkey:e.substr(0,1),value:this.values[e.substr(1)],region:e}},changeHighlight:function(e){var t,i=this.currentRegion,n=this.valueShapes[i];switch(delete this.shapes[n],i.substr(0,1)){case"r":t=this.renderRange(i.substr(1),e);break;case"p":t=this.renderPerformance(e);break;case"t":t=this.renderTarget(e)}this.valueShapes[i]=t.id,this.shapes[t.id]=i,this.target.replaceWithShape(n,t)},renderRange:function(e,t){var i=this.values[e],i=O.round(this.canvasWidth*((i-this.min)/this.range)),e=this.options.get("rangeColors")[e-2];return t&&(e=this.calcHighlightColor(e,this.options)),this.target.drawRect(0,0,i-1,this.canvasHeight-1,e,e)},renderPerformance:function(e){var t=this.values[1],t=O.round(this.canvasWidth*((t-this.min)/this.range)),i=this.options.get("performanceColor");return e&&(i=this.calcHighlightColor(i,this.options)),this.target.drawRect(0,O.round(.3*this.canvasHeight),t-1,O.round(.4*this.canvasHeight)-1,i,i)},renderTarget:function(e){var t=this.values[0],t=O.round(this.canvasWidth*((t-this.min)/this.range)-this.options.get("targetWidth")/2),i=O.round(.1*this.canvasHeight),n=this.canvasHeight-2*i,a=this.options.get("targetColor");return e&&(a=this.calcHighlightColor(a,this.options)),this.target.drawRect(t,i,this.options.get("targetWidth")-1,n-1,a,a)},render:function(){var e,t,i=this.values.length,n=this.target;if(h._super.render.call(this)){for(e=2;e<i;e++)t=this.renderRange(e).append(),this.shapes[t.id]="r"+e,this.valueShapes["r"+e]=t.id;null!==this.values[1]&&(t=this.renderPerformance().append(),this.shapes[t.id]="p1",this.valueShapes.p1=t.id),null!==this.values[0]&&(t=this.renderTarget().append(),this.shapes[t.id]="t0",this.valueShapes.t0=t.id),n.render()}}}),R.fn.sparkline.pie=u=b(R.fn.sparkline._base,{type:"pie",init:function(e,t,i,n,a){var s,o=0;if(u._super.init.call(this,e,t,i,n,a),this.shapes={},this.valueShapes={},this.values=t=R.map(t,Number),"auto"===i.get("width")&&(this.width=this.height),0<t.length)for(s=t.length;s--;)o+=t[s];this.total=o,this.initTarget(),this.radius=O.floor(O.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(e,t,i){e=this.target.getShapeAt(e,t,i);return e!==F&&this.shapes[e]!==F?this.shapes[e]:F},getCurrentRegionFields:function(){var e=this.currentRegion;return{isNull:this.values[e]===F,value:this.values[e],percent:this.values[e]/this.total*100,color:this.options.get("sliceColors")[e%this.options.get("sliceColors").length],offset:e}},changeHighlight:function(e){var t=this.currentRegion,e=this.renderSlice(t,e),i=this.valueShapes[t];delete this.shapes[i],this.target.replaceWithShape(i,e),this.valueShapes[t]=e.id,this.shapes[e.id]=t},renderSlice:function(e,t){for(var i,n,a,s=this.target,o=this.options,r=this.radius,l=o.get("borderWidth"),d=o.get("offset"),c=2*O.PI,h=this.values,u=this.total,p=d?2*O.PI*(d/360):0,g=h.length,f=0;f<g;f++){if(n=i=p,0<u&&(n=p+c*(h[f]/u)),e===f)return a=o.get("sliceColors")[f%o.get("sliceColors").length],t&&(a=this.calcHighlightColor(a,o)),s.drawPieSlice(r,r,r-l,i,n,F,a);p=n}},render:function(){var e,t,i=this.target,n=this.values,a=this.options,s=this.radius,o=a.get("borderWidth");if(u._super.render.call(this)){for(o&&i.drawCircle(s,s,O.floor(s-o/2),a.get("borderColor"),F,o).append(),t=n.length;t--;)n[t]&&(e=this.renderSlice(t).append(),this.valueShapes[t]=e.id,this.shapes[e.id]=t);i.render()}}}),R.fn.sparkline.box=w=b(R.fn.sparkline._base,{type:"box",init:function(e,t,i,n,a){w._super.init.call(this,e,t,i,n,a),this.values=R.map(t,Number),this.width="auto"===i.get("width")?"4.0em":n,this.initTarget(),this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var e=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];return this.loutlier!==F&&e.push({field:"lo",value:this.loutlier}),this.routlier!==F&&e.push({field:"ro",value:this.routlier}),this.lwhisker!==F&&e.push({field:"lw",value:this.lwhisker}),this.rwhisker!==F&&e.push({field:"rw",value:this.rwhisker}),e},render:function(){var e,t,i,n,a,s,o,r,l,d,c=this.target,h=this.values,u=h.length,p=this.options,g=this.canvasWidth,f=this.canvasHeight,m=p.get("chartRangeMin")===F?O.min.apply(O,h):p.get("chartRangeMin"),v=p.get("chartRangeMax")===F?O.max.apply(O,h):p.get("chartRangeMax"),b=0;if(w._super.render.call(this)){if(p.get("raw"))p.get("showOutliers")&&5<h.length?(t=h[0],e=h[1],n=h[2],a=h[3],s=h[4],o=h[5],r=h[6]):(e=h[0],n=h[1],a=h[2],s=h[3],o=h[4]);else if(h.sort(function(e,t){return e-t}),n=y(h,1),a=y(h,2),i=(s=y(h,3))-n,p.get("showOutliers")){for(e=o=F,l=0;l<u;l++)e===F&&h[l]>n-i*p.get("outlierIQR")&&(e=h[l]),h[l]<s+i*p.get("outlierIQR")&&(o=h[l]);t=h[0],r=h[u-1]}else e=h[0],o=h[u-1];this.quartiles=[n,a,s],this.lwhisker=e,this.rwhisker=o,this.loutlier=t,this.routlier=r,d=g/(v-m+1),p.get("showOutliers")&&(b=O.ceil(p.get("spotRadius")),d=(g-=2*O.ceil(p.get("spotRadius")))/(v-m+1),t<e&&c.drawCircle((t-m)*d+b,f/2,p.get("spotRadius"),p.get("outlierLineColor"),p.get("outlierFillColor")).append(),o<r)&&c.drawCircle((r-m)*d+b,f/2,p.get("spotRadius"),p.get("outlierLineColor"),p.get("outlierFillColor")).append(),c.drawRect(O.round((n-m)*d+b),O.round(.1*f),O.round((s-n)*d),O.round(.8*f),p.get("boxLineColor"),p.get("boxFillColor")).append(),c.drawLine(O.round((e-m)*d+b),O.round(f/2),O.round((n-m)*d+b),O.round(f/2),p.get("lineColor")).append(),c.drawLine(O.round((e-m)*d+b),O.round(f/4),O.round((e-m)*d+b),O.round(f-f/4),p.get("whiskerColor")).append(),c.drawLine(O.round((o-m)*d+b),O.round(f/2),O.round((s-m)*d+b),O.round(f/2),p.get("lineColor")).append(),c.drawLine(O.round((o-m)*d+b),O.round(f/4),O.round((o-m)*d+b),O.round(f-f/4),p.get("whiskerColor")).append(),c.drawLine(O.round((a-m)*d+b),O.round(.1*f),O.round((a-m)*d+b),O.round(.9*f),p.get("medianColor")).append(),p.get("target")&&(g=O.ceil(p.get("spotRadius")),c.drawLine(O.round((p.get("target")-m)*d+b),O.round(f/2-g),O.round((p.get("target")-m)*d+b),O.round(f/2+g),p.get("targetColor")).append(),c.drawLine(O.round((p.get("target")-m)*d+b-g),O.round(f/2),O.round((p.get("target")-m)*d+b+g),O.round(f/2),p.get("targetColor")).append()),c.render()}}}),n=b({init:function(e,t,i,n){this.target=e,this.id=t,this.type=i,this.args=n},append:function(){return this.target.appendShape(this),this}}),i=b({_pxregex:/(\d+)(px)?\s*$/i,init:function(e,t,i){e&&(this.width=e,this.height=t,this.target=i,this.lastShapeId=null,i[0]&&(i=i[0]),R.data(i,"_jqs_vcanvas",this))},drawLine:function(e,t,i,n,a,s){return this.drawShape([[e,t],[i,n]],a,s)},drawShape:function(e,t,i,n){return this._genShape("Shape",[e,t,i,n])},drawCircle:function(e,t,i,n,a,s){return this._genShape("Circle",[e,t,i,n,a,s])},drawPieSlice:function(e,t,i,n,a,s,o){return this._genShape("PieSlice",[e,t,i,n,a,s,o])},drawRect:function(e,t,i,n,a,s){return this._genShape("Rect",[e,t,i,n,a,s])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(e,t){R(t).html(e)},_calculatePixelDims:function(e,t,i){t=this._pxregex.exec(t);this.pixelHeight=t?t[1]:R(i).height(),t=this._pxregex.exec(e),this.pixelWidth=t?t[1]:R(i).width()},_genShape:function(e,t){var i=m++;return t.unshift(i),new n(this,i,e,t)},appendShape:function(e){alert("appendShape not implemented")},replaceWithShape:function(e,t){alert("replaceWithShape not implemented")},insertAfterShape:function(e,t){alert("insertAfterShape not implemented")},removeShapeId:function(e){alert("removeShapeId not implemented")},getShapeAt:function(e,t,i){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}}),p=b(i,{init:function(e,t,i,n){p._super.init.call(this,e,t,i),this.canvas=_.createElement("canvas"),i[0]&&(i=i[0]),R.data(i,"_jqs_vcanvas",this),R(this.canvas).css({display:"inline-block",width:e,height:t,verticalAlign:"top"}),this._insert(this.canvas,i),this._calculatePixelDims(e,t,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,this.interact=n,this.shapes={},this.shapeseq=[],this.currentTargetShapeId=F,R(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(e,t,i){var n=this.canvas.getContext("2d");return e!==F&&(n.strokeStyle=e),n.lineWidth=i===F?1:i,t!==F&&(n.fillStyle=t),n},reset:function(){this._getContext().clearRect(0,0,this.pixelWidth,this.pixelHeight),this.shapes={},this.shapeseq=[],this.currentTargetShapeId=F},_drawShape:function(e,t,i,n,a){var s,o,r=this._getContext(i,n,a);for(r.beginPath(),r.moveTo(t[0][0]+.5,t[0][1]+.5),s=1,o=t.length;s<o;s++)r.lineTo(t[s][0]+.5,t[s][1]+.5);i!==F&&r.stroke(),n!==F&&r.fill(),this.targetX!==F&&this.targetY!==F&&r.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=e)},_drawCircle:function(e,t,i,n,a,s,o){o=this._getContext(a,s,o);o.beginPath(),o.arc(t,i,n,0,2*O.PI,!1),this.targetX!==F&&this.targetY!==F&&o.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=e),a!==F&&o.stroke(),s!==F&&o.fill()},_drawPieSlice:function(e,t,i,n,a,s,o,r){var l=this._getContext(o,r);l.beginPath(),l.moveTo(t,i),l.arc(t,i,n,a,s,!1),l.lineTo(t,i),l.closePath(),o!==F&&l.stroke(),r&&l.fill(),this.targetX!==F&&this.targetY!==F&&l.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=e)},_drawRect:function(e,t,i,n,a,s,o){return this._drawShape(e,[[t,i],[t+n,i],[t+n,i+a],[t,i+a],[t,i]],s,o)},appendShape:function(e){return this.shapes[e.id]=e,this.shapeseq.push(e.id),this.lastShapeId=e.id,e.id},replaceWithShape:function(e,t){var i,n=this.shapeseq;for(this.shapes[t.id]=t,i=n.length;i--;)n[i]==e&&(n[i]=t.id);delete this.shapes[e]},replaceWithShapes:function(e,t){for(var i,n,a=this.shapeseq,s={},o=e.length;o--;)s[e[o]]=!0;for(o=a.length;o--;)s[i=a[o]]&&(a.splice(o,1),delete this.shapes[i],n=o);for(o=t.length;o--;)a.splice(n,0,t[o].id),this.shapes[t[o].id]=t[o]},insertAfterShape:function(e,t){for(var i=this.shapeseq,n=i.length;n--;)if(i[n]===e)return i.splice(n+1,0,t.id),void(this.shapes[t.id]=t)},removeShapeId:function(e){for(var t=this.shapeseq,i=t.length;i--;)if(t[i]===e){t.splice(i,1);break}delete this.shapes[e]},getShapeAt:function(e,t,i){return this.targetX=t,this.targetY=i,this.render(),this.currentTargetShapeId},render:function(){var e,t,i=this.shapeseq,n=this.shapes,a=i.length;for(this._getContext().clearRect(0,0,this.pixelWidth,this.pixelHeight),t=0;t<a;t++)this["_draw"+(e=n[i[t]]).type].apply(this,e.args);this.interact||(this.shapes={},this.shapeseq=[])}}),g=b(i,{init:function(e,t,i){g._super.init.call(this,e,t,i),i[0]&&(i=i[0]),R.data(i,"_jqs_vcanvas",this),this.canvas=_.createElement("span"),R(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:e,height:t,margin:"0px",padding:"0px",verticalAlign:"top"}),this._insert(this.canvas,i),this._calculatePixelDims(e,t,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,i='<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" style="position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height="+this.pixelHeight+'px;"></v:group>',this.canvas.insertAdjacentHTML("beforeEnd",i),this.group=R(this.canvas).children()[0],this.rendered=!1,this.prerender=""},_drawShape:function(e,t,i,n,a){for(var s,o,r=[],l=0,d=t.length;l<d;l++)r[l]=t[l][0]+","+t[l][1];return s=r.splice(0,1),a=a===F?1:a,o=r[0]===r[r.length-1]?"x ":"",'<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+e+'" '+(i===F?' stroked="false" ':' strokeWeight="'+a+'px" strokeColor="'+i+'" ')+(n===F?' filled="false"':' fillColor="'+n+'" filled="true" ')+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+s+" l "+r.join(", ")+" "+o+'e"> </v:shape>'},_drawCircle:function(e,t,i,n,a,s,o){return'<v:oval  id="jqsshape'+e+'" '+(a===F?' stroked="false" ':' strokeWeight="'+o+'px" strokeColor="'+a+'" ')+(s===F?' filled="false"':' fillColor="'+s+'" filled="true" ')+' style="position:absolute;top:'+(i-=n)+"px; left:"+(t-=n)+"px; width:"+2*n+"px; height:"+2*n+'px"></v:oval>'},_drawPieSlice:function(e,t,i,n,a,s,o,r){var l,d,c,h;if(a===s)return"";if(s-a==2*O.PI&&(a=0,s=2*O.PI),l=t+O.round(O.cos(a)*n),d=i+O.round(O.sin(a)*n),c=t+O.round(O.cos(s)*n),h=i+O.round(O.sin(s)*n),l===c&&d===h){if(s-a<O.PI)return"";l=c=t+n,d=h=i}return l===c&&d===h&&s-a<O.PI?"":'<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+e+'" '+(o===F?' stroked="false" ':' strokeWeight="1px" strokeColor="'+o+'" ')+(r===F?' filled="false"':' fillColor="'+r+'" filled="true" ')+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+t+","+i+" wa "+[t-n,i-n,t+n,i+n,l,d,c,h].join(", ")+' x e"> </v:shape>'},_drawRect:function(e,t,i,n,a,s,o){return this._drawShape(e,[[t,i],[t,i+a],[t+n,i+a],[t+n,i],[t,i]],s,o)},reset:function(){this.group.innerHTML=""},appendShape:function(e){var t=this["_draw"+e.type].apply(this,e.args);return this.rendered?this.group.insertAdjacentHTML("beforeEnd",t):this.prerender+=t,this.lastShapeId=e.id,e.id},replaceWithShape:function(e,t){e=R("#jqsshape"+e),t=this["_draw"+t.type].apply(this,t.args);e[0].outerHTML=t},replaceWithShapes:function(e,t){for(var i=R("#jqsshape"+e[0]),n="",a=t.length,s=0;s<a;s++)n+=this["_draw"+t[s].type].apply(this,t[s].args);for(i[0].outerHTML=n,s=1;s<e.length;s++)R("#jqsshape"+e[s]).remove()},insertAfterShape:function(e,t){e=R("#jqsshape"+e),t=this["_draw"+t.type].apply(this,t.args);e[0].insertAdjacentHTML("afterEnd",t)},removeShapeId:function(e){e=R("#jqsshape"+e);this.group.removeChild(e[0])},getShapeAt:function(e,t,i){return e.id.substr(8)},render:function(){this.rendered||(this.group.innerHTML=this.prerender,this.rendered=!0)}})},"function"==typeof define&&define.amd?define(["jquery"],e):jQuery&&!jQuery.fn.sparkline&&e(jQuery)}(document,Math),function(){var d=100,c=["#FF9900","#FFFFFF","#B3B4B4","#6B6B6B","#28DE28","#13F7F9","#E6EE18","#C41204","#CA3CB8","#0B1CFB"];function h(i,e,n){function t(e,t){a[t]||(a[t]=[]),a[t].length>=d&&a[t].shift(),a[t].push(Number(e)),(void 0===s||e<s)&&(s=e),(void 0===o||o<e)&&(o=e)}var a=$(i).data().values,s=$(i).data().valueMin,o=$(i).data().valueMax,r=(a||(a=[],o=s=void 0),_.isArray(e)?_.each(e,t):t(e,0),$(i).data().values=a,$(i).data().valueMin=s,$(i).data().valueMax=o,'<span style="color: {{color}}">&#9679;</span> {{y}}'),l=!1;_.each(a,function(e,t){$(i).sparkline(e,{type:"line",composite:l,height:"100%",width:"100%",fillColor:!1,lineColor:c[t%c.length],lineWidth:2,spotRadius:3,spotColor:!1,minSpotColor:"#78AB49",maxSpotColor:"#78AB49",highlightSpotColor:"#9D3926",highlightLineColor:"#9D3926",chartRangeMin:s,chartRangeMax:o,tooltipFormat:n&&n[t]?r+" ("+n[t]+")":r}),l=!0})}function i(e){var l=e,t=$('<div class="tw-display"></div>'),n=$('<h2 class="section-title tw-title tw-td"></h2>'),d=$('<div class="tw-value"></div>'),a=$('<div class="tw-unit"></div>'),c=$('<div class="tw-sparkline tw-td"></div>');function s(){_.isUndefined(l.units)||""==l.units?d.css("max-width","100%"):d.css("max-width",t.innerWidth()-a.outerWidth(!0)+"px")}this.render=function(e){$(e).empty(),$(t).append($('<div class="tw-tr"></div>').append(n)).append($('<div class="tw-tr"></div>').append($('<div class="tw-value-wrapper tw-td"></div>').append(d).append(a))).append($('<div class="tw-tr"></div>').append(c)),$(e).append(t),s()},this.onSettingsChanged=function(e){l=e;var t=!_.isUndefined(e.title)&&""!=e.title,i=!_.isUndefined(e.units)&&""!=e.units,t=(e.sparkline?c.attr("style",null):(delete c.data().values,c.empty(),c.hide()),t?(n.html(_.isUndefined(e.title)?"":e.title),n.attr("style","user-select: none")):(n.empty(),n.hide()),i?(a.html(_.isUndefined(e.units)?"":e.units),a.attr("style","user-select: none")):(a.empty(),a.hide()),30);"big"==e.size&&(t=75,e.sparkline)&&(t=60),d.css({"font-size":t+"px"}),d.css({"user-select":"none"}),s()},this.onSizeChanged=function(){s()},this.onCalculatedValueChanged=function(e,t){var i,n,a,s,o,r;"value"==e&&(l.animate?(i=t,n=d,e=500,(r=$(n).text())!=i&&($.isNumeric(i)&&$.isNumeric(r)?(s=0,1<(a=i.toString().split(".")).length&&(s=a[1].length),o=0,1<(a=r.toString().split(".")).length&&(o=a[1].length),jQuery({transitionValue:Number(r),precisionValue:o}).animate({transitionValue:Number(i),precisionValue:s},{duration:e,step:function(){$(n).text(this.transitionValue.toFixed(this.precisionValue))},done:function(){$(n).text(i)}})):$(n).text(i))):d.text(t),l.sparkline)&&h(c,t)},this.onDispose=function(){},this.getHeight=function(){return"big"==l.size||l.sparkline?2:1},this.onSettingsChanged(e)}function n(e){var i=$('<div class="html-widget"></div>'),t=e;this.render=function(e){$(e).append(i)},this.onSettingsChanged=function(e){t=e},this.onCalculatedValueChanged=function(e,t){"html"==e&&i.html(t)},this.onDispose=function(){},this.getHeight=function(){return Number(t.height)},this.onSettingsChanged(e)}var e=freeboard.getStyleString("values");freeboard.addStyle(".widget-big-text",e+"font-size:75px;"),freeboard.addStyle(".tw-display","width: 100%; height:100%; display:table; table-layout:fixed;"),freeboard.addStyle(".tw-tr","display:table-row;"),freeboard.addStyle(".tw-tg","display:table-row-group;"),freeboard.addStyle(".tw-tc","display:table-caption;"),freeboard.addStyle(".tw-td","display:table-cell;"),freeboard.addStyle(".tw-value",e+"overflow: hidden;display: inline-block;text-overflow: ellipsis;"),freeboard.addStyle(".tw-unit","display: inline-block;padding-left: 10px;padding-bottom: 1.1em;vertical-align: bottom;"),freeboard.addStyle(".tw-value-wrapper","position: relative;vertical-align: middle;height:100%;"),freeboard.addStyle(".tw-sparkline","height:20px;"),freeboard.loadWidgetPlugin({type_name:"text_widget",display_name:"Text",settings:[{name:"title",display_name:"Title",type:"text"},{name:"size",display_name:"Size",type:"option",options:[{name:"Regular",value:"regular"},{name:"Big",value:"big"}]},{name:"value",display_name:"Value",type:"calculated"},{name:"sparkline",display_name:"Include Sparkline",type:"boolean"},{name:"animate",display_name:"Animate Value Changes",type:"boolean",default_value:!0},{name:"units",display_name:"Units",type:"text"}],newInstance:function(e,t){t(new i(e))}}),freeboard.addStyle(".gm-style-cc a","text-shadow:none;"),freeboard.addStyle(".html-widget","white-space:normal;width:100%;height:100%");freeboard.loadWidgetPlugin({type_name:"html",display_name:"HTML",fill_size:!0,settings:[{name:"html",display_name:"HTML",type:"calculated",description:"Can be literal HTML, or javascript that outputs HTML."},{name:"height",display_name:"Height Blocks",type:"number",default_value:4,description:"A height block is around 60 pixels"}],newInstance:function(e,t){t(new n(e))}})}();