function DialogBox(e,t,i,n,a){var s=$('<div id="modal_overlay" style="display:none;"></div>'),o=$('<div class="modal"></div>');let r=function(){l()};function l(){s.fadeOut(200,function(){$(this).remove()}),freeboard.emit("exit_widget_edit_mode"),freeboard.off("exit_edit_mode",r),freeboard.off("force_dialog_box_cancel"),freeboard.off("force_dialog_box_ok")}function d(){freeboard.emit("widget_edit_cancel"),l()}function h(){var e=!1;(e=_.isFunction(a)?a():e)||(freeboard.emit("widget_edit_ok"),l())}o.append('<header><h1 class="title">'+t+"</h1></header>"),n&&$('<span id="dialog-cancel" class="text-button">'+n+"</span>").appendTo(o).click(d),i&&$('<span id="dialog-ok" class="text-button">'+i+"</span>").appendTo(o).click(h),$("<section></section>").appendTo(o).append(e);$("<footer></footer>").appendTo(o);s.append(o),$("body").append(s),s.fadeIn(100),freeboard.emit("enter_widget_edit_mode"),freeboard.once("exit_edit_mode",d),freeboard.once("force_dialog_box_cancel",r),freeboard.once("force_dialog_box_ok",h)}function FreeboardModel(a,s,o){var r=this;this.version=0,this.isEditing=ko.observable(!1),this.allow_edit=ko.observable(!1),this.allow_edit.subscribe(function(e){e?$("#main-header").show():$("#main-header").hide()}),this.setting={},this.header_image=ko.observable(),this.plugins=ko.observableArray(),this.datasources=ko.observableArray(),this.panes=ko.observableArray(),this.datasourceData={},this.messageHandler={},this.postcallback=null,this.processDatasourceUpdate=function(e,t,i){var n=e.name();r.datasourceData[n]=t,_.each(r.panes(),function(e){_.each(e.widgets(),function(e){e.processDatasourceUpdate(n,i)})}),r.postcallback(JSON.stringify({event:"DATA_UPDATED",data:String(Date.now())}))},this._datasourceTypes=ko.observable(),this.datasourceTypes=ko.computed({read:function(){r._datasourceTypes();var n=[];return _.each(a,function(e){var t=e.type_name,i=t;_.isUndefined(e.display_name)||(i=e.display_name),n.push({name:t,display_name:i})}),n}}),this._widgetTypes=ko.observable(),this.widgetTypes=ko.computed({read:function(){r._widgetTypes();var n=[];return _.each(s,function(e){var t=e.type_name,i=t;_.isUndefined(e.display_name)||(i=e.display_name),n.push({name:t,display_name:i})}),n}}),this.addPluginSource=function(e){e&&-1==r.plugins.indexOf(e)&&r.plugins.push(e)},this.serialize=function(){var t=[],i=(_.each(r.panes(),function(e){t.push(e.serialize())}),[]);return _.each(r.datasources(),function(e){i.push(e.serialize())}),{version:1,header_image:r.header_image(),allow_edit:r.allow_edit(),plugins:r.plugins(),panes:t,datasources:i,columns:o.getUserColumns()}},this.clonePane=function(e){freeboard.setConfigUnsaved(!0);var t,i=e.serialize();for(t in i.id=Math.random().toString(36).substring(2,8),i.widgets)i.widgets[t].id=Math.random().toString(36).substring(2,8);e=new PaneModel(r,s);e.deserialize(i),r.panes.push(e)},this.deserialize=function(t,i){function e(){o.setUserColumns(t.columns),_.isUndefined(t.allow_edit)?r.allow_edit(!0):r.allow_edit(t.allow_edit),r.version=t.version||0,r.header_image(t.header_image),_.each(t.datasources,function(e){var t=new DatasourceModel(r,a);t.setPostMessageCallback(r.postcallback),t.deserialize(e),r.addDatasource(t)});var e=_.sortBy(t.panes,function(e){return o.getPositionForScreenSize(e).row});_.each(e,function(e){var t=new PaneModel(r,s);t.deserialize(e),r.panes.push(t)}),r.allow_edit()&&0==r.panes().length&&r.setEditing(!0),_.isFunction(i)&&i(),o.processResize(!0)}r.clearDashboard(),_.each(t.plugins,function(e){r.addPluginSource(e)}),_.isArray(t.plugins)&&0<t.plugins.length?head.js(t.plugins,function(){e()}):e()},this.clearDashboard=function(e){o.removeAllPanes(),e&&_.each(r.datasources(),function(e){e.dispose(),delete e}),_.each(r.panes(),function(e){e.dispose()}),r.plugins.removeAll(),e&&r.datasources.removeAll(),r.panes.removeAll()},this.loadDashboard=function(e,t){freeboard.setConfigUnsaved(!1),o.showLoadingIndicator(!0),r.deserialize(e,function(){o.showLoadingIndicator(!1),_.isFunction(t)&&t(),freeboard.emit("dashboard_loaded")})},this.loadDashboardFromLocalFile=function(){var e;freeboard.setConfigUnsaved(!1),window.File&&window.FileReader&&window.FileList&&window.Blob?((e=document.createElement("input")).type="file",$(e).on("change",function(e){var t,e=e.target.files;e&&0<e.length&&(e=e[0],(t=new FileReader).addEventListener("load",function(e){e=e.target,e=JSON.parse(e.result);r.loadDashboard(e),r.setEditing(!1)}),t.readAsText(e))}),$(e).trigger("click")):alert("Unable to load a file in this browser.")},this.addDatasource=function(e){r.datasources.push(e)},this.deleteDatasource=function(e){delete r.datasourceData[e.name()],e.dispose(),r.datasources.remove(e)},this.createPane=function(){freeboard.setConfigUnsaved(!0);var e=new PaneModel(r,s);r.addPane(e)},this.addGridColumnLeft=function(){o.addGridColumnLeft()},this.addGridColumnRight=function(){o.addGridColumnRight()},this.subGridColumnLeft=function(){o.subGridColumnLeft()},this.subGridColumnRight=function(){o.subGridColumnRight()},this.addPane=function(e){r.panes.push(e)},this.deletePane=function(e){freeboard.setConfigUnsaved(!0),e.dispose(),r.panes.remove(e)},this.deleteWidget=function(t){freeboard.setConfigUnsaved(!0),ko.utils.arrayForEach(r.panes(),function(e){e.widgets.remove(t)}),t.dispose()},this.setEditing=function(e,t){var i,n;!r.allow_edit()&&e||(r.isEditing(e),i=(t=_.isUndefined(t)?!1:t)?250:0,n=$("#admin-bar").outerHeight(),e?(r.setting.headless||($("#toggle-header-icon").addClass("fa-chevron-up").removeClass("fa-wrench"),$(".gridster .gs_w").css({cursor:"pointer"}),$("#main-header").animate({top:"0px"},i),$("#board-content").animate({top:n+20+"px"},i),$("#main-header").data().shown=!0),o.attachWidgetEditIcons($(".sub-section")),o.enableGrid()):(r.setting.headless||($("#toggle-header-icon").addClass("fa-wrench").removeClass("fa-chevron-up"),$(".gridster .gs_w").css({cursor:"default"}),$("#main-header").animate({top:"-"+n+"px"},i),$("#board-content").animate({top:"20"},i),$("#main-header").data().shown=!1),$(".sub-section").unbind(),o.disableGrid()),o.showPaneEditIcons(e,t))},this.toggleEditing=function(){var e=!r.isEditing();r.setEditing(e)},this.resetDashboard=function(e){r.clearDashboard(e)},this.initSetting=function(e){r.setting=e},this.setPostMessageCallback=function(e){r.postcallback=e}}function FreeboardUI(){var r,s=8,i=16,n=173,a=null,o=null,l=null,t=i,d=$('<div class="wrapperloading"><div class="loading up" ></div><div class="loading down"></div></div>');let h={},c={},u=!1;function p(){var e=window.innerWidth;let t,i;return t=a||(e<=300?1:e<=500?2:Math.floor((e-s)/(n+s))),i="number"==typeof o&&0<o?o:!0===o?l=l||(i=Math.floor((e-2*(t+1)*s)/t)):Math.floor((e-2*(t+1)*s)/t)}function g(){return s+p()+s}let e=function(e,t){h[e]||(h[e]=[]);for(var i of h[e])if(i===t)return;h[e].push(t)},f=function(e,t,i,n,a){if(h[e])for(var s of h[e])"function"==typeof s&&s(t,i,n,a);if(c[e])for(var o of c[e]){"function"==typeof o&&o(t,i,n,a);var r,l=c[e];for(r in l)if(l[r]===o)return void l.splice(r,1)}};function v(e){var n=y(),e=e?function(e){var t=ko.dataFor(this),i=I(t);$(this).attr("data-sizex",Math.min(t.col_width(),n,r.cols)).attr("data-row",i.row).attr("data-col",i.col),t.processSizeChange()}:function(){};x(Math.min(n,t)),C(e),w()}function m(n){x(r.cols+1)&&C(function(){var e=ko.dataFor(this),t=1<r.cols?r.cols-1:1,i=e.col[t],t=e.row[t];t=n?(leftPreviewCol=!0,{row:t,col:i<r.cols?i+1:r.cols}):(rightPreviewCol=!0,{row:t,col:i}),$(this).attr("data-sizex",Math.min(e.col_width(),r.cols)).attr("data-row",t.row).attr("data-col",t.col)}),w(),t=r.cols}function b(n){x(r.cols-1)&&C(function(){var e=ko.dataFor(this),t=r.cols+1,i=e.col[t],t=e.row[t];t=n?{row:t,col:1<i?i-1:1}:{row:t,col:i<=r.cols?i:r.cols},$(this).attr("data-sizex",Math.min(e.col_width(),r.cols)).attr("data-row",t.row).attr("data-col",t.col)}),w(),t=r.cols}function w(){var e=$(".column-tool"),t=$("#board-content").width(),t=Math.floor(t/g());r.cols<=i?e.addClass("min"):e.removeClass("min"),r.cols>=t?e.addClass("max"):e.removeClass("max")}function y(){var e=$("#board-content").width();return Math.floor(e/g())}function x(e){(void 0===e||e<i)&&(e=i);var t=y(),t=(t<e&&(e=t),g()*e+e);return $(".responsive-column-width").css("max-width",t),e!==r.cols}function C(e){if(u){if("1"!=localStorage.getItem("auto_reload_lock"))return localStorage.setItem("auto_reload_lock","1"),void window.location.reload();setTimeout(()=>{localStorage.setItem("auto_reload_lock","0")},1e3)}var t=r.$el;t.find("> li").unbind().removeData(),$(".responsive-column-width").css("width",""),r.generate_grid_and_stylesheet(),t.find("> li").each(e),r.init(),$(".responsive-column-width").css("width",r.cols*p()+r.cols*s*2)}function S(t,i,e){!function(e){for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=i.length,a=0;a<e;a++)t+=i.charAt(Math.floor(Math.random()*n))}(4);var n=I(i),a=n.col,n=n.row,s=Number(i.width()),o=Number(i.getCalculatedHeight());e&&R(!0),r.add_widget(t,s,o,a,n),k(i,n,a),$(t).attrchange({trackValues:!0,callback:function(e){"data-row"==e.attributeName?k(i,Number(e.newValue),void 0):"data-col"==e.attributeName&&k(i,void 0,Number(e.newValue));e=Number($(t).attr("data-sizex"));i.actualColWidth=e}})}function k(e,t,i){var n=r.cols;_.isUndefined(t)||(e.row[n]=t),_.isUndefined(i)||(e.col[n]=i)}function R(e,t){t=(t=_.isUndefined(t)?!0:t)?250:0;e?($(".pane-tools").fadeIn(t),$("#column-tools").fadeIn(t)):($(".pane-tools").fadeOut(t),$("#column-tools").fadeOut(t))}function T(e,t){t?$(e).find(".sub-section-tools").fadeIn(250):$(e).find(".sub-section-tools").fadeOut(250)}function I(e){var t,i,n,a=r.cols,s=(_.isNumber(e.row)&&_.isNumber(e.col)&&((t={})[a]=e.row,e.row=t,(t={})[a]=e.col,e.col=t),1),o=1e3;for(i in e.col){if(i==a)return{row:e.row[i],col:e.col[i]};e.col[i]>a?s=a:(n=a-i)<o&&(s=i,o=n)}return s in e.col&&s in e.row?{row:e.row[s],col:e.col[s]}:{row:1,col:s}}return this.on=e,this.emit=f,ko.bindingHandlers.grid={init:function(e,t,i,n,a){r=$(e).gridster({widget_margins:[s,9],widget_base_dimensions:[p(),11.7],resize:{enabled:!1,axes:"x"},draggable:{enabled:!0,start:function(e,t,i){},drag:function(e,t,i){},stop:function(e,t,i){freeboard.setConfigUnsaved(!0)}}}).data("gridster"),v(!1),r.disable()}},{addPane:function(e,t,i){S(e,t,i)},showLoadingIndicator:function(e){e?d.fadeOut(0).appendTo("body").fadeIn(500):d.fadeOut(500).remove()},showPaneEditIcons:function(e,t){R(e,t)},attachWidgetEditIcons:function(e){$(e).hover(function(){T(this,!0)},function(){T(this,!1)})},getPositionForScreenSize:I,processResize:function(e){v(e)},disableGrid:function(){r.enabled=!1,r.disable()},enableGrid:function(){r.enabled=!0,r.enable()},updatePane:function(e,t){var i,n,a;e=e,i=(t=t).getCalculatedHeight(),n=Number($(e).attr("data-sizey")),a=Number($(e).attr("data-sizex")),t.actualColWidth=a,i==n&&t.col_width()==a||r.resize_widget($(e),t.col_width(),i,function(){r.set_dom_grid_height()})},removePane:function(e){r.remove_widget(e)},removeAllPanes:function(){r.remove_all_widgets()},addGridColumnLeft:function(){m(!0)},addGridColumnRight:function(){m(!1)},subGridColumnLeft:function(){b(!0)},subGridColumnRight:function(){b(!1)},getUserColumns:function(){return t},setUserColumns:function(e){t=Math.max(i,e)},getGridColumn:function(){return r.cols},hideAllWidgetEditIcons:function(){$(".sub-section-tools").fadeOut(250)},getGrid:function(){return r},getMaxDisplayableColumnCount:y,on:this.on,emit:this.emit}}function PaneModel(n,a){var s=this;this.id=Math.random().toString(36).substring(2,8),this.title=ko.observable(),this.width=ko.observable(1),this.row={},this.col={},this.col_width=ko.observable(1),this.col_width.subscribe(function(e){s.processSizeChange()}),this.widgets=ko.observableArray(),this.addWidget=function(e){this.widgets.push(e)},this.widgetCanMoveUp=function(e){return 1<=s.widgets.indexOf(e)},this.widgetCanMoveDown=function(e){return s.widgets.indexOf(e)<s.widgets().length-1},this.cloneWidget=function(e){freeboard.setConfigUnsaved(!0),(t=e.serialize()).id=Math.random().toString(36).substring(2,8);var t,e=s.widgets.indexOf(e),i=new WidgetModel(n,a);i.deserialize(t),s.widgets.splice(e,0,i)},this.moveWidgetUp=function(e){var t;freeboard.setConfigUnsaved(!0),s.widgetCanMoveUp(e)&&(e=s.widgets.indexOf(e),t=s.widgets(),s.widgets.splice(e-1,2,t[e],t[e-1]))},this.moveWidgetDown=function(e){var t;freeboard.setConfigUnsaved(!0),s.widgetCanMoveDown(e)&&(e=s.widgets.indexOf(e),t=s.widgets(),s.widgets.splice(e,2,t[e+1],t[e]))},this.processSizeChange=function(){setTimeout(function(){_.each(s.widgets(),function(e){try{e.processSizeChange()}catch(e){}})},300)},this.getCalculatedHeight=function(){var e=_.reduce(s.widgets(),function(e,t){return e+t.height()},0),e=(e=((e*=6)+3)*10,Math.ceil((20+e)/30));return Math.max(4,e)},this.serialize=function(){var t=[];return _.each(s.widgets(),function(e){t.push(e.serialize())}),{id:s.id,title:s.title(),width:s.width(),row:s.row,col:s.col,col_width:Number(s.col_width()),widgets:t}},this.deserialize=function(e){e.id&&(s.id=e.id),s.title(e.title),s.width(e.width),s.row=e.row,s.col=e.col,s.col_width(e.col_width||1),_.each(e.widgets,function(e){var t=new WidgetModel(n,a);t.deserialize(e),s.widgets.push(t)})},this.dispose=function(){_.each(s.widgets(),function(e){e.dispose()})}}function WidgetModel(i,n){var l=this;this.id=Math.random().toString(36).substring(2,8),this.datasourceRefreshNotifications={},this.calculatedSettingScripts={},this.title=ko.observable(),this.fillSize=ko.observable(!1),this.type=ko.observable(),this.listeners={},freeboard.DATASOURCE_INITIALIZED?setTimeout(()=>{if(l.listeners.ready)for(cb of l.listeners.ready)cb()},250):freeboard.on("DATASOURCE_INITIALIZED",()=>{if(l.listeners.ready)for(cb of l.listeners.ready)cb()}),this.type.subscribe(function(e){function t(){var e=l.settings();e.id=l.id;i.newInstance(e,function(e){l.fillSize(!0===i.fill_size),l.widgetInstance=e,l.shouldRender(!0),l._heightUpdate.valueHasMutated(),l.widgetInstance.id=l.id},{getCommand:function(e){return`executeWidgetAction('${l.id}','${e}')`},setCommand:function(e,t){setWidgetAction(l.id,e,t)},triggerAction:function(e,t){executeWidgetAction(l.id,e,t)},execute:function(e,t){executeCodeText(e,t)},on:function(e,t){l.listeners[e]||(l.listeners[e]=[]),l.listeners[e].push(t)},isSet:function(e){return isWidgetActionSet(l.id,e)}})}var i;_.isUndefined(l.widgetInstance)||(_.isFunction(l.widgetInstance.onDispose)&&l.widgetInstance.onDispose(),l.widgetInstance=void 0),e in n&&_.isFunction(n[e].newInstance)&&((i=n[e]).external_scripts?head.js(i.external_scripts.slice(0),t):t())}),this.settings=ko.observable({}),this.settings.subscribe(function(e){!_.isUndefined(l.widgetInstance)&&_.isFunction(l.widgetInstance.onSettingsChanged)&&l.widgetInstance.onSettingsChanged(e),l.updateCalculatedSettings(),l._heightUpdate.valueHasMutated()}),this.processDatasourceUpdate=function(e,t){e=l.datasourceRefreshNotifications[e];_.isArray(e)&&_.each(e,function(e){l.processCalculatedSetting(e,t)})},this.callValueFunction=function(e,t){return t?e.call(void 0,t):e.call(void 0,i.datasourceData)},this.processSizeChange=function(){!_.isUndefined(l.widgetInstance)&&_.isFunction(l.widgetInstance.onSizeChanged)&&l.widgetInstance.onSizeChanged()},this.processCalculatedSetting=function(t,i){if(_.isFunction(l.calculatedSettingScripts[t])){var n=void 0,e=void 0;try{n=l.callValueFunction(l.calculatedSettingScripts[t]),e=l.callValueFunction(l.calculatedSettingScripts[t],{dash:i})}catch(e){i=l.settings()[t];e instanceof ReferenceError&&/^\w+$/.test(i)&&(n=i)}if(!_.isUndefined(l.widgetInstance)&&_.isFunction(l.widgetInstance.onCalculatedValueChanged))try{e=e||{},l.widgetInstance.onCalculatedValueChanged(t,n,e)}catch(e){}}},this.updateCalculatedSettings=function(){var e,o,r;l.datasourceRefreshNotifications={},l.calculatedSettingScripts={},_.isUndefined(l.type())||(e=n[l.type()].settings,o=new RegExp("datasources.([\\w_-]+)|datasources\\[['\"]([^'\"]+)","g"),r=l.settings(),_.each(e,function(t){if("calculated"==t.type){var e=r[t.name];if(!_.isUndefined(e)){"html"==t.name&&(e="`"+e+"`"),e="return "+(e=_.isArray(e)?"["+e.join(",")+"]":e),e=transpile_macro_code(e);try{n=new Function("datasources",e)}catch(e){var i=r[t.name].replace(/"/g,'\\"').replace(/[\r\n]/g," \\\n"),n=new Function("datasources",'return "'+i+'";')}for(l.calculatedSettingScripts[t.name]=n,l.processCalculatedSetting(t.name);a=o.exec(e);){var a=a[1]||a[2],s=l.datasourceRefreshNotifications[a];_.isUndefined(s)&&(l.datasourceRefreshNotifications[a]=s=[]),-1==_.indexOf(s,t.name)&&s.push(t.name)}}}}))},this._heightUpdate=ko.observable(),this.height=ko.computed({read:function(){return l._heightUpdate(),!_.isUndefined(l.widgetInstance)&&_.isFunction(l.widgetInstance.getHeight)?l.widgetInstance.getHeight():1}}),this.shouldRender=ko.observable(!1),this.render=function(e){l.shouldRender(!1),!_.isUndefined(l.widgetInstance)&&_.isFunction(l.widgetInstance.render)&&(l.widgetInstance.render(e),l.updateCalculatedSettings())},this.dispose=function(){l.widgetInstance.onDispose()},this.serialize=function(){return{id:l.id,title:l.title(),type:l.type(),settings:l.settings()}},this.deserialize=function(e){e.id&&(l.id=e.id),l.title(e.title),l.settings(e.settings),l.type(e.type)}}DatasourceModel=function(i,n){var a=this;function s(){_.isUndefined(a.datasourceInstance)||(_.isFunction(a.datasourceInstance.onDispose)&&a.datasourceInstance.onDispose(),a.datasourceInstance=void 0)}this.name=ko.observable(),this.latestData=ko.observable(),this.settings=ko.observable({}),this.settings.subscribe(function(e){!_.isUndefined(a.datasourceInstance)&&_.isFunction(a.datasourceInstance.onSettingsChanged)&&a.datasourceInstance.onSettingsChanged(e)}),this.statusChangeCallback=function(e){a.status(e),a.postcallback(JSON.stringify({event:"DATASOURCE_STATUS_UPDATED",data:e}))},this.updateCallback=function(e,t){i.processDatasourceUpdate(a,e,t),a.latestData(e);t=new Date;a.last_updated(t.toLocaleTimeString())},this.type=ko.observable(),this.type.subscribe(function(e){function t(){i.newInstance(a.settings(),function(e){(a.datasourceInstance=e).updateNow()},a.updateCallback,a.statusChangeCallback)}var i;s(),e in n&&_.isFunction(n[e].newInstance)&&((i=n[e]).external_scripts?head.js(i.external_scripts.slice(0),t):t())}),this.last_updated=ko.observable("never"),this.status=ko.observable({code:0,text:"DISCONNECTED"}),this.last_error=ko.observable(),this.serialize=function(){return{name:a.name(),type:a.type(),settings:a.settings()}},this.deserialize=function(e){a.settings(e.settings),a.name(e.name),a.type(e.type)},this.getDataRepresentation=function(e){return new Function("data","return "+e+";").call(void 0,a.latestData())},this.updateNow=function(){!_.isUndefined(a.datasourceInstance)&&_.isFunction(a.datasourceInstance.updateNow)&&a.datasourceInstance.updateNow()},this.dispose=function(){s()},this.publish=function(e,t){console.log(e+" --\x3e "+t)},this.setPostMessageCallback=function(e){a.postcallback=e}},DeveloperConsole=function(a){return{showDeveloperConsole:function(){function t(e){var t=$("<tr></tr>"),i=$('<ul class="board-toolbar"></ul>'),n=$('<input class="table-row-value" style="width:100%;" type="text">'),a=$('<li><i class="icon-trash icon-white"></i></li>').click(function(e){s=_.without(s,n),t.remove()});s.push(n),e&&n.val(e),i.append(a),o.append(t.append($("<td></td>").append(n)).append($('<td class="table-row-operation">').append(i)))}var s,e,i,n,o;s=[],e=$("<div></div>"),i=$('<div class="table-operation text-button">ADD</div>'),(n=$('<table class="table table-condensed sub-table"></table>')).append($('<thead style=""><tr><th>Plugin Script URL</th></tr></thead>')),o=$("<tbody></tbody>"),n.append(o),e.append($("<p>Here you can add references to other scripts to load datasource or widget plugins.</p>")).append(n).append(i).append('<p>To learn how to build plugins for freeboard, please visit <a target="_blank" href="http://freeboard.github.io/freeboard/docs/plugin_example.html">http://freeboard.github.io/freeboard/docs/plugin_example.html</a></p>'),_.each(a.plugins(),function(e){t(e)}),i.click(function(e){t()}),new DialogBox(e,"Developer Console","OK",null,function(){_.each(a.plugins(),function(e){$('script[src^="'+e+'"]').remove()}),a.plugins.removeAll(),_.each(s,function(e){e=e.val();e&&0<e.length&&(a.addPluginSource(e),head.js(e+"?"+Date.now()))})})}}},JSEditor=function(){let t;return{displayJSEditor:function(e,t){function i(){n()}function n(){var e=l.getValue();a(e),s.remove(),freeboard.emit("exit_jseditor"),freeboard.off("force_jseditor_ok",i)}var a,s,o,r,l;e=e,a=t,s=$('<div class="code-window"></div>'),t=$('<div class="code-mirror-wrapper"></div>'),o=$('<div class="code-window-footer"></div>'),r=$('<div class="code-window-header cm-s-ambiance">'),s.append([r,t,o]),$("body").append(s),freeboard.emit("enter_jseditor"),l=CodeMirror(t.get(0),{value:e,mode:"javascript",indentUnit:4,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!1,lineWrapping:!0}),$('<span id="dialog-cancel" class="text-button">Close</span>').click(function(){a&&n()}),freeboard.once("force_jseditor_ok",n)},setAssetRoot:function(e){0},initSetting:function(e){t=e}}},PluginEditor=function(d,h){let t;function u(e,t){t=$('<div class="validation-error"></div>').html(t);$("#setting-value-container-"+e).append(t)}function k(i,e,n,t,a,s=!0){var o=$("<textarea></textarea>"),t=(n.multi_input?o.change(function(){var t=[];$(i).find("textarea").each(function(){var e=$(this).val();e&&(t=t.concat(e))}),e.settings[n.name]=t}):o.change(function(){e.settings[n.name]=$(this).val()}),t&&o.val(t),h.createValueEditor(o,void 0,s),$('<ul class="board-toolbar datasource-input-suffix"></ul>')),r=$('<div class="calculated-setting-row"></div>'),l=$('<div class="input-container">'),s=(s?(s=$('<i class="fa fa-bolt calicon"></i>'),l.append(o).append(s)):l.append(o),r.append(l).append(t),$('<li><i class="fa fa-plus icon-white"></i><label>DEVICE</label></li>').mousedown(function(e){e.preventDefault(),$(o).focus().insertAtCaret("#").trigger("freeboard-eval")})),l=(t.append(s),$('<li><i class="fa fa-plus icon-white"></i><label>VARIABLE</label></li>').mousedown(function(e){e.preventDefault(),$(o).focus().insertAtCaret("$").trigger("freeboard-eval")})),s=(t.append(l),$('<li><i class="fa fa-edit icon-white"></i><label>EDITOR</label></li>').mousedown(function(e){e.preventDefault(),d.displayJSEditor(o.val(),function(e){o.val(e),o.change()})}));t.append(s),a&&(l=$('<li class="remove-setting-row"><i class="fa fa-minus icon-white"></i><label></label></li>').mousedown(function(e){e.preventDefault(),r.remove(),$(i).find("textarea:first").change()}),t.prepend(l)),$(i).append(r)}function o(e,t,i,x,n){var a,C={type:i,settings:{}};function S(e,t){var i=$('<div id="setting-row-'+e+'" class="form-row"></div>').appendTo(s);return i.append('<div class="form-label"><label class="control-label">'+t+"</label></div>"),$('<div id="setting-value-container-'+e+'" class="form-value"></div>').appendTo(i)}var s=$("<div></div>"),o=$('<div id="plugin-description"></div>').hide();function r(e,w,y){_.each(e,function(u){!_.isUndefined(u.default_value)&&_.isUndefined(x[u.name])&&(x[u.name]=u.default_value);var e=u.name,p=(_.isUndefined(u.display_name)||(e=u.display_name),S(u.name,e));switch(u.type){case"array":var t=$('<div class="form-table-value-subtable"></div>').appendTo(p),g=$('<table class="table table-condensed sub-table"></table>').appendTo(t),i=$("<thead></thead>").hide().appendTo(g),n=$("<tr></tr>").appendTo(i),r=$("<tbody></tbody>").appendTo(g),g=[];function l(){0<C.settings[u.name].length?i.show():i.hide()}function a(a){var s=$("<tr></tr>").appendTo(r),o={};_.isArray(C.settings[u.name])||(C.settings[u.name]=[]),C.settings[u.name].push(o),_.each(u.settings,function(i){var e=$("<td></td>").appendTo(s),t="";switch(_.isUndefined(a[i.name])||(t=a[i.name]),o[i.name]=t,i.type){case"text":$('<input class="table-row-value" type="text">').appendTo(e).val(t).change(function(){o[i.name]=$(this).val()});break;case"color":var n="cpk"+randomString(6);$(`<input type="hidden" id="${n}" style="height:0;width:0;padding:0;border:none"    />`).appendTo(e),$("#"+n).colorpicker({showOn:"button",color:t||"#1B5E20"}),null!=t&&""!=t.trim()||(o[i.name]="#1B5E20"),$("#"+n).on("change.color",function(e,t){t&&(o[i.name]=t)})}}),s.append($('<td class="table-row-operation"></td>').append($('<ul class="board-toolbar"></ul>').append($("<li></li>").append($('<i class="fa fa-trash icon-white"></i>').click(function(){var e=C.settings[u.name].indexOf(o);-1!=e&&(C.settings[u.name].splice(e,1),s.remove(),l())}))))),t.scrollTop(t[0].scrollHeight),l()}_.each(u.settings,function(e){var t=e.name;_.isUndefined(e.display_name)||(t=e.display_name),$("<th>"+t+"</th>").appendTo(n)}),u.name in x&&(g=x[u.name]),$('<div class="table-operation text-button">ADD</div>').appendTo(p).click(function(){var t={};_.each(u.settings,function(e){t[e.name]=""}),a(t)}),_.each(g,function(e,t){a(e)});break;case"boolean":C.settings[u.name]=x[u.name];var g=$('<div class="onoffswitch"><label class="onoffswitch-label" for="'+u.name+'-onoff"><div class="onoffswitch-inner"><span class="on">YES</span><span class="off">NO</span></div><div class="onoffswitch-switch"></div></label></div>').appendTo(p),s=$('<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="'+u.name+'-onoff">').prependTo(g).change(function(){C.settings[u.name]=this.checked});u.name in x&&s.prop("checked",x[u.name]);break;case"option":var o=x[u.name],s=$("<select></select>").appendTo($('<div class="styled-select"></div>').appendTo(p)).change(function(){C.settings[u.name]=$(this).val()});_.each(u.options,function(e){var t,i;_.isObject(e)?(t=e.name,i=e.value):t=e,_.isUndefined(i)&&(i=t),_.isUndefined(o)&&(o=i),$("<option></option>").text(t).attr("value",i).appendTo(s)}),C.settings[u.name]=o,u.name in x&&s.val(x[u.name]);break;case"calculated":if(C.settings[u.name]=x[u.name],u.name in x){var d=x[u.name];if(u.multi_input&&_.isArray(d))for(var h=!1,c=0;c<d.length;c++)k(p,C,u,d[c],h,!0),h=!0;else k(p,C,u,d,!1,!0)}else k(p,C,u,null,!1,!0);break;case"script":if(C.settings[u.name]=x[u.name],u.name in x){d=x[u.name];if(u.multi_input&&_.isArray(d))for(h=!1,c=0;c<d.length;c++)k(p,C,u,d[c],h,!1),h=!0;else k(p,C,u,d,!1,!1)}else k(p,C,u,null,!1,!1);u.multi_input&&(g=$('<ul class="board-toolbar"><li class="add-setting-row"><i class="fa fa-plus icon-white"></i><label>ADD</label></li></ul>').mousedown(function(e){e.preventDefault(),k(p,C,u,null,!0,!1)}),$(p).siblings(".form-label").append(g));break;case"color":C.settings[u.name]=x[u.name];g=u.name;$(`<input type="hidden" id="${g}" style="height:0;width:0;padding:0;border:none"    />`).appendTo(p);u.name in x?$("#"+g).colorpicker({showOn:"button",color:x[u.name]}):$("#"+g).colorpicker({showOn:"button"}),$("#"+g).on("change.color",function(e,t){t&&(C.settings[u.name]=t)});break;case"taginput":{C.settings[u.name]=x[u.name];let e="",i=!1,a=!1,t,n="",s=!0,o=0,r=(u.name in x&&(e=x[u.name]),"TAGITBOX_"+u.name),l="TAGITDIV_"+u.name;g=$(`<div class="taginput-wrapper" id="${l}-wrapper" style=" "> </div>`);let d,h;"color"==u.option.tagType?(d=$(`<div class="" id="${l}-left" style="width: -webkit-calc(100% - 45px); display: inline-block; vertical-align:top;"> </div>`),h=$(`<div class="" id="${l}-right" style="width:40px; display: inline-block; vertical-align:top; padding-left: 5px"> </div>`),p.append(g).children().append(d).append(h),$(`<input type="hidden" id="${l}-cp" style="height:0;width:0;padding:0;border:none"    />`).appendTo(h),$(`#${l}-cp`).colorpicker({showOn:"button"}),$(`#${l}-cp`).on("change.color",function(e,t){t&&$("#"+l).tagit("createTag",t,null,null)})):(d=$(`<div class="" id="${l}-left" style="width: 100%; display: inline-block; vertical-align:top;"> </div>`),p.append(g).children().append(d));$(`<input type="hidden" id="${l}"  value="${e}"  >`).appendTo(d).change(function(){var e;C.settings[u.name]=$(this).val(),t=n,n=$(this).val(),a||(i=!0,setTimeout(()=>{i=!1},500)),t.length<n.length&&(e=$("#"+r),$(e).next("ul#value-selector").remove(),c=null,i=!0,setTimeout(()=>{i=!1},500))});let c;$("#"+l).tagit({tagitID:r,singleField:!0,availableTags:[],allowDuplicates:u.option.allowDuplicates||!1,showAutocompleteOnFocus:!0,textAsBackgroundColor:"color"==u.option.tagType,transform:function(e){return context={currentSettings:C.settings},u.option.transform&&"function"==typeof u.option.transform?u.option.transform(context,e):e},autocomplete:{source:async function(t,e){if(i)i=!1;else{let e=[],i=(u.option&&(u.option.source?"function"==typeof u.option.source&&(e=await u.option.source({currentSettings:C.settings})):u.option.availableTags&&(e=u.option.availableTags)),_autocompleteOptions=t.term?e.filter(e=>e.startsWith(t.term)):e,$("#"+r));var n;"string"==u.option.tagType?0<_autocompleteOptions.length?(c||(c=$('<ul id="value-selector" class="value-dropdown" ></ul>').insertAfter(i).width($(i).outerWidth()-2).css("left",i.position().left).css("top",i.position().top+$("#"+r).outerHeight()-1),o=0),c.empty(),c.scrollTop(0),n=!0,_.each(_autocompleteOptions,function(e,t){t=$(`<li>${e}</li>`).appendTo(c).mouseenter(function(){console.log("mosue enter"),$(this).trigger("tag-select")}).mousedown(function(e){console.log("mosue down"),$(this).trigger("tag-insertValue"),e.preventDefault()}).data("tag-optionIndex",t).data("tag-optionValue",e).bind("tag-insertValue",function(){$(i).triggerHandler("mouseup"),$(i).next("ul#value-selector").remove(),c=null,$("#"+l).tagit("createTag",e)}).bind("tag-select",function(){$(this).parent().find("li.selected").removeClass("selected"),$(this).addClass("selected"),o=$(this).data("tag-optionIndex")});n&&($(t).addClass("selected"),n=!1)})):($(i).next("ul#value-selector").remove(),c=null,o=-1):u.option.tagType,$(i).focusin(function(e){a=!0}).focusout(function(e){a=!1,$(i).next("ul#value-selector").remove(),c=null,o=-1}).bind("keydown",function(e){var t;c&&s&&(s=!1,38==e.keyCode||40==e.keyCode?(e.preventDefault(),t=$(c).find("li"),38==e.keyCode?o--:40==e.keyCode&&o++,o<0?(o=0,o=t.size()-1):o>=t.size()&&(o=t.size()-1),(t=$(t).eq(o)).trigger("tag-select"),$(c).scrollTop($(t).position().top)):13==e.keyCode&&(e.preventDefault(),-1!=o)&&$(c).find("li").eq(o).trigger("tag-insertValue"))}).bind("keyup mouseup freeboard-eval",function(e){!c||"keyup"!=e.type||38!=e.keyCode&&40!=e.keyCode&&13!=e.keyCode||(s=!0,e.preventDefault())})}}}});break}case"slider":{C.settings[u.name]=x[u.name];var g=u.min,f=u.max,v=u.name+"-"+randomString(8),m=$('<div class="slider-wrapper"></div>'),g=(p.append(m),$(`<input id="${v}" type="range" min="${g}" max="${f}" step="1" style="width:100%" />`).appendTo(m),document.getElementById(v));let n;(n=rangeSlider.create(g,{onSlide:(e,t,i)=>{n.handle.innerHTML=`<div class="rangeSlider__handle_label">${e}</div>`,C.settings[u.name]=Number(e)}})).range.className="rangeSlider rangeSlider_config",n.fill.className="rangeSlider__fill_config",n.handle.className="rangeSlider__handle_config",n.handle.innerHTML=`<div class="rangeSlider__handle_label">${Number(x[u.name])}</div>`,n.update({value:void 0!==x[u.name]?x[u.name]:u.default_value});break}default:C.settings[u.name]=x[u.name];var b,s=$('<input type="text">').appendTo(p).change(function(){"number"==u.type?C.settings[u.name]=Number($(this).val()):C.settings[u.name]=$(this).val()});u.name in x&&s.val(x[u.name]),w&&u.typeahead_data_field&&s.addClass("typeahead_data_field-"+u.typeahead_data_field),s.keyup(function(e){s.trigger("change")}),w&&u.typeahead_field&&(b=[],s.keyup(function(e){65<=e.which&&e.which<=91&&s.trigger("change")}),$(s).autocomplete({source:b,select:function(e,t){s.val(t.item.value),s.trigger("change")}}),s.change(function(e){var n=s.val(),t=_.template(w)({input:n});$.get(t,function(e){if(y&&(e=e[y]),e=_.select(e,function(e){return e[u.typeahead_field][0]==n[0]}),b=_.map(e,function(e){return e[u.typeahead_field]}),$(s).autocomplete("option","source",b),1==e.length)for(var t in e=e[0]){var i;e.hasOwnProperty(t)&&(i=$(_.template("input.typeahead_data_field-<%= field %>")({field:t})))&&(i.val(e[t]),i.val()!=s.val())&&i.trigger("change")}})}))}_.isUndefined(u.suffix)||p.append($('<div class="input-suffix">'+u.suffix+"</div>")),_.isUndefined(u.description)||p.append($('<div class="setting-description">'+u.description+"</div>"))})}s.append(o);let l="Save",d="Cancel";l=null,d=null,new DialogBox(s,e,l,d,function(){$(".validation-error").remove();for(var e,t=0;t<a.settings.length;t++){var i=a.settings[t];if(i.required&&(_.isUndefined(C.settings[i.name])||""==C.settings[i.name]))return u(i.name,"This is required."),!0;if("integer"==i.type&&C.settings[i.name]%1!=0)return u(i.name,"Must be a whole number."),!0;if("number"==i.type&&(e=C.settings[i.name],isNaN(parseFloat(e))||!isFinite(e)))return u(i.name,"Must be a number."),!0}_.isFunction(n)&&n(C)});var h,c,e=_.keys(t);1<e.length?(h=S("plugin-types","Type"),(c=$("<select></select>").appendTo($('<div class="styled-select"></div>').appendTo(h))).append($("<option>Select a type...</option>").attr("value","undefined")),_.each(t,function(e){c.append($("<option></option>").text(e.display_name).attr("value",e.type_name))}),c.change(function(){C.type=$(this).val(),C.settings={},($("#setting-row-instance-name").length?$("#setting-row-instance-name"):$("#setting-row-plugin-types")).nextAll().remove(),a=t[c.val()],_.isUndefined(a)?($("#setting-row-instance-name").hide(),$("#dialog-ok").hide()):($("#setting-row-instance-name").show(),a.description&&0<a.description.length?o.html(a.description).show():o.hide(),$("#dialog-ok").show(),r(a.settings,a.typeahead_source,a.typeahead_data_segment))})):1==e.length&&(a=t[e[0]],C.type=a.type_name,C.settings={},r(a.settings)),c&&(_.isUndefined(i)?($("#setting-row-instance-name").hide(),$("#dialog-ok").hide()):($("#dialog-ok").show(),c.val(i).trigger("change")))}return{createPluginEditor:function(e,t,i,n,a,s){o(e,t,i,n,a)},initSetting:function(e){t=e}}},ValueEditor=function(b){var w=new RegExp('.*#\\["([^"]*)("\\])?([^#]*)$'),y=new RegExp(".*\\$([^$]*)([^#]*)$"),x=null,C=0,S=[],k=!0,R=null,n={ANY:"any",ARRAY:"array",OBJECT:"object",STRING:"string",NUMBER:"number",BOOLEAN:"boolean",TAG:"tag"};function T(e,t){return _.isArray(e)||_.isObject(e)||i(e,t)}function i(e,t){switch(t){case n.ANY:return!0;case n.ARRAY:return _.isArray(e);case n.OBJECT:return _.isObject(e);case n.STRING:return _.isString(e);case n.NUMBER:return _.isNumber(e);case n.BOOLEAN:return _.isBoolean(e);case n.TAG:return _.isString(e)}}function I(e,t){$(e).parent().find(".validation-error").remove(),i(R,t)||$(e).parent().append("<div class='validation-error'>This field expects an expression that evaluates to type "+t+".</div>")}function a(i,e){var n,a=(a=$(i).val().substring(0,$(i).getCaretPosition())).replace(String.fromCharCode(160)," "),t=a,s=b.datasources(),o=e,r=w.exec(t),l=y.exec(t),d=[];if(r||"#"==t.substr(t.length-1)&&(r=["#",""]),l){let e;_atVarField=!(k=!1);for(var h of s)if("localstore_datasource"==h.type()){e=h;break}if(""==l[1]){if(!_.isUndefined(e)){var c="data",u="",p=e.getDataRepresentation(c);if(R=p,_.isArray(p))for(var g=0;g<p.length;g++)0==g.toString().indexOf(u)&&T(m=p[g],o)&&d.push({value:g,entity:m,precede_char:"[",follow_char:"]",preview:m.toString(),caret_offset:0});else _.isObject(p)&&_.each(p,function(e,t){0==t.indexOf(u)&&T(e,o)&&d.push({value:t,entity:e,precede_char:"",follow_char:"",caret_offset:0})})}}else d=[]}if(r&&(!l||""!=l[1]))if(_atVarField=!1,""==r[1]){let e;for(var f of s)if("piedash_datasource"==f.type()){e=f;break}if(!_.isUndefined(e)){c="data",u="",p=e.getDataRepresentation(c);if(R=p,_.isArray(p))for(g=0;g<p.length;g++)0==g.toString().indexOf(u)&&T(m=p[g],o)&&d.push({value:g,entity:m,precede_char:"[",follow_char:"]",preview:m.toString(),caret_offset:0});else _.isObject(p)&&_.each(p,function(e,t){0==t.indexOf(u)&&T(e,o)&&d.push({value:t,entity:e,precede_char:'["',follow_char:'"]',caret_offset:0})})}}else{let e;for(var v of s)if("piedash_datasource"==v.type()){e=v;break}if(!_.isUndefined(e)){c=`data["${r[1]}"]`,u="",p=(_.isUndefined(r[2])||(t=r[3].lastIndexOf("]")+1,c+=r[3].substring(0,t),u=(u=(u=r[3].substring(t,r[3].length)).replace(/^[\[\"]*/,"")).replace(/[\"\]]*$/,"")),e.getDataRepresentation(c));if(R=p,_.isArray(p))for(var m,g=0;g<p.length;g++)0==g.toString().indexOf(u)&&T(m=p[g],o)&&d.push({value:g,entity:m,precede_char:"[",follow_char:"]",preview:m.toString(),caret_offset:0});else _.isObject(p)&&_.each(p,function(e,t){0==t.indexOf(u)&&T(e,o)&&d.push({value:t,entity:e,precede_char:'["',follow_char:'"]',caret_offset:0})});r[3]||d.push({value:".writeShadow(",entity:"",precede_char:"",follow_char:'"","")',caret_offset:-5},{value:".publishMsg(",entity:"",precede_char:"",follow_char:'"","")',caret_offset:-5},{value:".privateMsg(",entity:"",precede_char:"",follow_char:'"","")',caret_offset:-5}),k=!r[3]||!r[2]}}0<(S=d).length?((x=x||$('<ul id="value-selector" class="value-dropdown"></ul>').insertAfter(i).width($(i).outerWidth()-2).css("left",$(i).position().left).css("top",$(i).position().top+$(i).outerHeight()-1)).empty(),x.scrollTop(0),n=!0,C=0,_.each(S,function(e,t){e=function(a,s,o,e){var t=o.value;"."==t.substr(0,1)&&(t+=")");o.preview&&(t=t+"<span class='preview'>"+o.preview+"</span>");return $("<li>"+t+"</li>").appendTo(x).mouseenter(function(){$(this).trigger("freeboard-select")}).mousedown(function(e){$(this).trigger("freeboard-insertValue"),e.preventDefault()}).data("freeboard-optionIndex",e).data("freeboard-optionValue",o.value).bind("freeboard-insertValue",function(){var e=o.value,e=o.precede_char+e+o.follow_char;let t="";var i,n=$(a).val(),n=_atVarField?-1:(k&&("#"!=n.substr(n.length-1)&&'#["'!=n.substr(n.length-3,3)&&('"'==n.substr(n.length-1)?t="]":"]"!=n.substr(n.length-1)&&(t='"]')),s+=t),Math.max(s.lastIndexOf("["),s.lastIndexOf("]")+1,s.lastIndexOf("#")+1));-1!=n?$(a).replaceTextAt(n,$(a).val().length,t+e):$(a).insertAtCaret(t+e),0!=o.caret_offset&&(n=o.caret_offset||0,i=(e=$(a)).getCaretPosition(e),console.log({cur:i,off:n}),e.setCaretPosition(i+n,i+n)),R=o.entity,$(a).triggerHandler("mouseup")}).bind("freeboard-select",function(){$(this).parent().find("li.selected").removeClass("selected"),$(this).addClass("selected"),C=$(this).data("freeboard-optionIndex")})}(i,a,e,t);n&&($(e).addClass("selected"),n=!1)})):(I(i,e),$(i).next("ul#value-selector").remove(),x=null,C=-1)}function s(i,t,e=!0){let n;n=e?"calculated-value-input":"script-value-input",$(i).addClass(n).bind("keyup mouseup freeboard-eval",function(e){!x||"keyup"!=e.type||38!=e.keyCode&&40!=e.keyCode&&13!=e.keyCode?a(i,t):e.preventDefault()}).focus(function(){var e,t;$(i).css({"z-index":3001}),e=i,t=($(e).val().match(/\n/g)||[]).length,t=Math.min(200,20*(t+1)),$(e).css({height:t+"px"})}).focusout(function(){I(i,t),$(i).css({height:"","z-index":3e3}),$(i).next("ul#value-selector").remove(),x=null,C=-1}).bind("keydown",function(e){var t;x&&(38==e.keyCode||40==e.keyCode?(e.preventDefault(),t=$(x).find("li"),38==e.keyCode?C--:40==e.keyCode&&C++,C<0?C=t.size()-1:C>=t.size()&&(C=0),(t=$(t).eq(C)).trigger("freeboard-select"),$(x).scrollTop($(t).position().top)):13==e.keyCode&&(e.preventDefault(),-1!=C)&&$(x).find("li").eq(C).trigger("freeboard-insertValue"))})}return{createValueEditor:function(e,t,i){s(e,t||n.ANY,i)},EXPECTED_TYPE:n}},function(o){var a=window.MutationObserver||window.WebKitMutationObserver;o.fn.attrchange=function(e){var t,i,n={trackValues:!1,callback:o.noop};return"function"==typeof e?n.callback=e:o.extend(n,e),n.trackValues&&o(this).each(function(e,t){for(var i,n={},e=0,a=t.attributes,s=a.length;e<s;e++)n[(i=a.item(e)).nodeName]=i.value;o(this).data("attr-old-value",n)}),a?(t={subtree:!1,attributes:!0,attributeOldValue:n.trackValues},i=new a(function(e){e.forEach(function(e){var t=e.target;n.trackValues&&(e.newValue=o(t).attr(e.attributeName)),n.callback.call(t,e)})}),this.each(function(){i.observe(this,t)})):function(){var e=document.createElement("p"),t=!1;if(e.addEventListener)e.addEventListener("DOMAttrModified",function(){t=!0},!1);else{if(!e.attachEvent)return;e.attachEvent("onDOMAttrModified",function(){t=!0})}return e.setAttribute("id","target"),t}()?this.on("DOMAttrModified",function(e){(e=e.originalEvent?e.originalEvent:e).attributeName=e.attrName,e.oldValue=e.prevValue,n.callback.call(this,e)}):"onpropertychange"in document.body?this.on("propertychange",function(e){e.attributeName=window.event.propertyName,function(e,t){var i;e&&(e=this.data("attr-old-value"),0<=t.attributeName.indexOf("style")?(e.style||(e.style={}),i=t.attributeName.split("."),t.attributeName=i[0],t.oldValue=e.style[i[1]],t.newValue=i[1]+":"+this.prop("style")[o.camelCase(i[1])],e.style[i[1]]=t.newValue):(t.oldValue=e[t.attributeName],t.newValue=this.attr(t.attributeName),e[t.attributeName]=t.newValue),this.data("attr-old-value",e))}.call(o(this),n.trackValues,e),n.callback.call(this,e)}):this}}(jQuery),function(e){e.eventEmitter={_JQInit:function(){this._JQ=e(this)},emit:function(e,t){this._JQ||this._JQInit(),this._JQ.trigger(e,t)},once:function(e,t){this._JQ||this._JQInit(),this._JQ.one(e,t)},on:function(e,t){this._JQ||this._JQInit(),this._JQ.bind(e,t)},off:function(e,t){this._JQ||this._JQInit(),this._JQ.unbind(e,t)}}}(jQuery);var freeboard=function(){const t="nexpie.freeboard.json";var e=!0,d={},h={},l={},c=new FreeboardUI,u=new FreeboardModel(d,h,c),i=(this.freeboardmodel=u,new JSEditor),n=new ValueEditor(u),p=new PluginEditor(i,n),s=new DeveloperConsole(u),o={values:{"font-family":'"HelveticaNeue-UltraLight", "Helvetica Neue Ultra Light", "Helvetica Neue", sans-serif',color:"#d3d4d4","font-weight":100}};function r(t){if(self.dashconfig){let e=t.datasources.length;for(;e--;)("piedash_datasource"==t.datasources[e].type||"localstore_datasource"==t.datasources[e].type)&&t.datasources.splice(e,1)}}function g(e){console.log("unsaved = "+e),l(e?JSON.stringify({event:"CONFIG_UNSAVED",data:String(Date.now())}):JSON.stringify({event:"CONFIG_SAVED",data:String(Date.now())}))}return c.on("ConfigChenged",function(){}),ko.bindingHandlers.pluginEditor={init:function(i,e,t,n,a){var s=ko.unwrap(e()),o={},r=void 0,l="";"datasource"==s.type?(o=d,l="Datasource"):"widget"==s.type?(o=h,l="Widget"):"pane"==s.type&&(l="Pane"),$(i).click(function(e){var t;"clone"==s.operation?"pane"==s.type&&u.clonePane(n):"delete"==s.operation?new DialogBox($("<p>Are you sure you want to delete this "+l+"?</p>"),"Confirm Delete","Yes","No",function(){if("datasource"==s.type)u.deleteDatasource(n);else if("widget"==s.type)u.deleteWidget(n);else if("pane"==s.type){let e=n.col_width();n.actualColWidth||(n.actualColWidth=1),n.actualColWidth<n.col_width()&&(e=n.actualColWidth),n.col_width(e||1),u.deletePane(n)}}):(t=void 0,"datasource"==s.type?"add"==s.operation?r={}:(t=n.type(),(r=n.settings()).name=n.name()):"widget"==s.type?r="add"==s.operation?{}:(t=n.type(),n.settings()):"pane"==s.type&&(r={},"edit"==s.operation&&(r.title=n.title(),r.col_width=n.col_width()),o={settings:{settings:[{name:"title",display_name:"Title",type:"text"},{name:"col_width",display_name:"Columns",type:"slider",default_value:1,required:!0,min:1,max:6}]}}),p.createPluginEditor(l,o,t,r,function(e){var t;"add"==s.operation?"datasource"==s.type?(t=new DatasourceModel(u,d),u.addDatasource(t),t.name(e.settings.name),delete e.settings.name,t.settings(e.settings),t.type(e.type)):"widget"==s.type&&((t=new WidgetModel(u,h)).settings(e.settings),t.type(e.type),n.widgets.push(t),c.attachWidgetEditIcons(i)):"edit"==s.operation&&("pane"==s.type?(n.title(e.settings.title),n.col_width(e.settings.col_width),c.processResize(!1)):("datasource"==s.type&&(n.name(e.settings.name),delete e.settings.name),n.type(e.type),n.settings(e.settings)))}))})}},ko.virtualElements.allowedBindings.datasourceTypeSettings=!0,ko.bindingHandlers.datasourceTypeSettings={update:function(e,t,i,n,a){processPluginSettings(e,t,i,n,a)}},ko.bindingHandlers.pane={init:function(e,t,i,n,a){u.isEditing()&&$(e).css({cursor:"pointer"});var s=u.isEditing();c.addPane(e,n,s)},update:function(e,t,i,n,a){-1==u.panes.indexOf(n)&&c.removePane(e),c.updatePane(e,n)}},ko.bindingHandlers.widget={init:function(e,t,i,n,a){u.isEditing()&&c.attachWidgetEditIcons($(e).parent())},update:function(e,t,i,n,a){n.shouldRender()&&($(e).empty(),n.render(e))}},$(function(){var e;function t(){c.processResize(!0)}c.showLoadingIndicator(!0),$(window).resize(function(){clearTimeout(e),e=setTimeout(t,500)});let i=null;var n=$("#board-content");n&&(n.on("touchstart",function(e){c.getGrid().enabled&&(e=e.originalEvent.changedTouches[0])&&(e=document.elementFromPoint(e.clientX,e.clientY))&&(i=$(e).attr("id"))}),n.on("touchmove",function(e){c.getGrid().enabled&&"board-background"!==i&&e.preventDefault()}),n.on("touchend",function(e){i=null}))}),{initialize:function(e,t){ko.applyBindings(u);i=(i="load").replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=null==(i=new RegExp("[\\?&]"+i+"=([^&#]*)").exec(location.search))?"":decodeURIComponent(i[1].replace(/\+/g," "));""!=i?$.ajax({url:i,success:function(e){u.loadDashboard(e),_.isFunction(t)&&t()}}):(u.allow_edit(e),u.setEditing(e),c.showLoadingIndicator(!1),_.isFunction(t)&&t(),freeboard.emit("initialized")),freeboard.on("widget_edit_ok",function(){l(JSON.stringify({event:"WIDGET_EDIT_OK",data:{}})),g(!0)}),freeboard.on("widget_edit_cancel",function(){l(JSON.stringify({event:"WIDGET_EDIT_CANCEL",data:{}}))}),freeboard.on("enter_widget_edit_mode",function(){l(JSON.stringify({event:"ENTER_WIDGET_EDIT_MODE",data:{}}))}),freeboard.on("exit_widget_edit_mode",function(){l(JSON.stringify({event:"EXIT_WIDGET_EDIT_MODE",data:{}}))}),freeboard.on("enter_jseditor",function(){l(JSON.stringify({event:"ENTER_JSEDITOR",data:{}}))}),freeboard.on("exit_jseditor",function(){l(JSON.stringify({event:"EXIT_JSEDITOR",data:{}}))})},newDashboard:function(){u.loadDashboard({allow_edit:!0})},loadDashboard:function(e,t){u.loadDashboard(e,t)},serialize:function(){return u.serialize()},setEditing:function(e,t){e?freeboard.emit("enter_edit_mode"):(freeboard.emit("exit_edit_mode"),c.hideAllWidgetEditIcons()),u.setEditing(e,t)},isEditing:function(){return u.isEditing()},loadDatasourcePlugin:function(e){_.isUndefined(e.display_name)&&(e.display_name=e.type_name),e.settings.unshift({name:"name",display_name:"Name",type:"text",required:!0}),u.addPluginSource(e.source),d[e.type_name]=e,u._datasourceTypes.valueHasMutated()},resize:function(){c.processResize(!0)},loadWidgetPlugin:function(e){_.isUndefined(e.display_name)&&(e.display_name=e.type_name),u.addPluginSource(e.source),h[e.type_name]=e,u._widgetTypes.valueHasMutated()},setAssetRoot:function(e){i.setAssetRoot(e)},addStyle:function(e,t){e=e+"{"+t+"}",t=$("style#fb-styles");0==t.length&&(t=$('<style id="fb-styles" type="text/css"></style>'),$("head").append(t)),t[0].styleSheet?t[0].styleSheet.cssText+=e:t.text(t.text()+e)},showLoadingIndicator:function(e){c.showLoadingIndicator(e)},showDialog:function(e,t,i,n,a){new DialogBox(e,t,i,n,a)},getDatasourceSettings:function(t){var e=u.datasources(),e=_.find(e,function(e){return e.name()===t});return e?e.settings():null},setDatasourceSettings:function(t,e){var i=u.datasources(),i=_.find(i,function(e){return e.name()===t});i?(e=_.defaults(e,i.settings()),i.settings(e)):console.log("Datasource not found")},getStyleString:function(e){var i="";return _.each(o[e],function(e,t){i=i+t+":"+e+";"}),i},getStyleObject:function(e){return o[e]},showDeveloperConsole:function(){s.showDeveloperConsole()},resetDashboard:function(e=!0,t){e?freeboard.showDialog("Are you sure you want to CLEAR ALL?","Warning","OK","CANCEL",function(){u.resetDashboard(t)}):u.resetDashboard(t)},createPane:function(){u.createPane()},toggleEditing:function(){u.toggleEditing()},initSetting:function(e){u.initSetting(e),p.initSetting(e),i.initSetting(e)},setPostMessageCallback:function(e){l=e,u.setPostMessageCallback(e)},setConfigUnsaved:function(e){g(e)},initDash:function(e){let t;try{e&&(t=atob(e))}catch(e){console.log("Invalid token")}t&&(a=t.split(":"),self.dashconfig={platform:a[0],dashid:a[2],dashtoken:a[3],gqlhost:getPlatformGraphQLURI(a[0])})},setDashCredential({credential:e,forcereload:t}){let i=!1,n=!1;self.dashconfig||(self.dashconfig={}),e&&(void 0!==e.platform&&self.dashconfig.platform!=e.platform&&(self.dashconfig.platform=e.platform,self.dashconfig.gqlhost=getPlatformGraphQLURI(e.platform),self.dashconfig.mqtthost=getPlatformMQTTURI(e.platform),self.dashconfig.dshost=getPlatformDSURI(e.platform),i=!0),void 0!==e.dashid&&self.dashconfig.dashid!=e.dashid&&(self.dashconfig.dashid=e.dashid,i=!0),t&&(i=!0),void 0!==e.dashtoken&&self.dashconfig.dashtoken!=e.dashtoken&&(self.dashconfig.dashtoken=e.dashtoken,n=!0),i?(emitter.removeAllListeners(),freeboard.resetDashboard(!1,!0),freeboard.loadFromGraphQL()):n&&emitter.emit("DASHTOKEN_UPDATED",self.dashconfig))},initDashCredential:function(e){let t;try{e&&(t=atob(e))}catch(e){console.log("Invalid token encode")}if(t)try{var i=JSON.parse(t);switch((self.dashconfig=i).platform){case"NEXIIOT":self.dashconfig.gqlhost="https://gqlv2.nexiiot.io";break;case"NEXPIE":self.dashconfig.gqlhost="https://gqlv2.nexpie.io";break;case"NETPIE":self.dashconfig.gqlhost="https://gqlv2.netpie.io";break;case"DEV":self.dashconfig.gqlhost="https://dev-gqlv2.nexpie.io"}}catch(e){console.log("Invalid token payload")}},saveConfigToGraphQL:function(e=!0){function t(){r(dashboardjson=u.serialize());var e,i=dashboardjson,t=c.getGridColumn();for(e of i.panes){for(var n in e.col)t!=Number(n)&&delete e.col[n];for(var a in e.row)t!=Number(a)&&delete e.row[a]}if(self.dashconfig&&self.dashconfig.gqlhost){let e;var i=dashconfig?dashconfig.dashid:"",s=dashconfig?dashconfig.dashtoken:"";let t=JSON.stringify(dashboardjson);t=t.replaceAll("\\","\\\\").replaceAll('"','\\"');var o=JSON.stringify({query:`mutation {
 setDashConfig(dashid:"${dashconfig.dashid}", app:"freeboard", data:"${t}") {
 dashid 
 app 
 rev 
}
}`});e=s.startsWith("eyJ")?"Bearer "+s:`Dash ${i}:`+s,$.ajax({url:self.dashconfig.gqlhost,type:"post",data:o,headers:{Authorization:e},contentType:"application/json",success:function(e){g(!1);try{JSON.parse(e.data.dashConfig.data)}catch(e){}}})}}e?freeboard.showDialog("Are you sure you want to SAVE SETTING?","SAVE","OK","CANCEL",function(){t()}):t()},saveConfigToLocalStorage:function(){freeboard.showDialog("Are you sure you want to SAVE SETTING?","SAVE","OK","CANCEL",function(){dashboardjson=u.serialize(),window.localStorage.setItem(t,dashboardjson)})},exportDashboard:function(){var e="application/octet-stream",t=document.createElement("a"),i=u.serialize(),i=(r(i),new Blob([JSON.stringify(i,null,"\t")],{type:e}));document.body.appendChild(t),t.href=window.URL.createObjectURL(i),t.download="dashboard-config.json",t.target="_self",t.click()},loadFromLocalStorage:function(){freeboard.initialize(!0);var e=window.localStorage.getItem(t);if(null!==e){var i=e=JSON.parse(e);if(self.dashconfig){let e=i.datasources.length;for(;e--;)("piedash_datasource"==jsonconfig.datasources[e].type||"localstore_datasource"==jsonconfig.datasources[e].type)&&jsonconfig.datasources.splice(e,1);i.datasources.push({name:self.dashconfig.dashname,settings:{name:self.dashconfig.dashname,dashid:self.dashconfig.dashid,dashtoken:self.dashconfig.dashtoken,platform:self.dashconfig.platform},type:"piedash_datasource"});let t=!1;for(var n in i.datasources)if("localstore_datasource"==i.datasources[n].type){t=!0;break}t||i.datasources.push({name:"var",settings:{},type:"localstore_datasource"}),console.log("Dash Datasource configured...")}u.loadDashboard(e,function(){})}},loadFromGraphQL:async function(){if(self.dashconfig&&self.dashconfig.gqlhost){let e;var t=dashconfig?dashconfig.dashid:"",i=dashconfig?dashconfig.dashtoken:"";if(i.startsWith("eyJ")){let e=0;a=t,s=i;var n=await new Promise((t,e)=>{var i=JSON.stringify({query:`query {
 myDashLevelInfo(dashid:"${a}") {
 dashid 
 dashname 
 dashdescription 
 level 
 enabled 
 }
}`});auth_header="Bearer "+s,$.ajax({url:self.dashconfig.gqlhost,type:"post",data:i,headers:{Authorization:auth_header},contentType:"application/json",success:function(e){t(e.data.myDashLevelInfo)}})});n?(e=3<=n.level?3:1,l(JSON.stringify({event:"DASH_INFO",data:{dashid:t,dashname:n.dashname,platform:dashconfig.platform,enabled:n.enabled,level:e}}))):1!==n?.level||3!==n?.level?l(JSON.stringify({event:"UNAUTHORIZED",data:null})):l(JSON.stringify({event:"DASH_NOT_AVAILABLE",data:null}))}else{if(o=t,r=i,n=await new Promise((t,e)=>{var i=JSON.stringify({query:`query {
 dashTokenInfo(dashid:"${o}", dashtoken:"${r}") {
 dashid 
 dashtoken 
 dashname 
 dashtokenname 
 dashdescription 
 level 
 enabled 
}
}`});auth_header=r.startsWith("eyJ")?"Bearer "+r:`Dash ${o}:`+r,$.ajax({url:self.dashconfig.gqlhost,type:"post",data:i,headers:{Authorization:auth_header},contentType:"application/json",success:function(e){t(e.data.dashTokenInfo)}})}),console.log(n),!n)return void l(JSON.stringify({event:"DASH_NOT_AVAILABLE",data:null}));l(JSON.stringify({event:"DASH_INFO",data:{dashid:t,dashname:n.dashname,dashtokenname:n.dashtokenname,platform:dashconfig.platform,enabled:n.enabled,level:n.level}}))}n=JSON.stringify({query:`query {
 dashConfig(dashid:"${t}") {
 dashid 
 rev 
 data 
}
}`});e=i.startsWith("eyJ")?"Bearer "+i:`Dash ${t}:`+i,$.ajax({url:self.dashconfig.gqlhost,type:"post",data:n,headers:{Authorization:e},contentType:"application/json",success:function(e){let t;try{e.data.dashConfig?t=e.data.dashConfig[0]&&e.data.dashConfig[0].data?JSON.parse(e.data.dashConfig[0].data):{version:1,allow_edit:!0,plugins:[],panes:[],datasources:[]}:l(JSON.stringify({event:"UNAUTHORIZED",data:null}))}catch(e){}if(t){if(self.dashconfig){let e=t.datasources.length;for(;e--;)"piedash_datasource"==t.datasources[e].type&&t.datasources.splice(e,1);t.datasources.push({name:"dash",settings:{name:"dash",dashid:self.dashconfig.dashid,dashtoken:self.dashconfig.dashtoken,platform:self.dashconfig.platform},type:"piedash_datasource"}),console.log("Dash configured...")}let e=!1;for(var i in t.datasources)if("localstore_datasource"==t.datasources[i].type){e=!0;break}e||t.datasources.push({name:"var",settings:{namespace:self.dashconfig.dashid},type:"localstore_datasource"}),t.columns=6,u.loadDashboard(t,function(){u.setEditing(!1)})}}})}var a,s,o,r},loadDashboardFromLocalFile:function(){return u.loadDashboardFromLocalFile()},isConfigSaved:function(){return e},getEditStatus:function(){return{isEditing:u.isEditing(),allow_edit:u.allow_edit()}},closeDialogBox(){freeboard.emit("force_close_dialog_box")},widgetSettingCancel(){freeboard.emit("force_dialog_box_cancel")},widgetSettingSave(){freeboard.emit("force_dialog_box_ok")},jsEditorSave(){freeboard.emit("force_jseditor_ok")}}}();$.extend(freeboard,jQuery.eventEmitter),function(_,H,P){var e;e=function(I){"use strict";var m,T,w,D,M,A,d,x,e,s,h,E,l,t,N,O,r,o,c,u,y,n,p,g,a,f={},v=0,i=function(){return{common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:P,normalRangeMax:P,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:P,chartRangeMax:P,chartRangeMinX:P,chartRangeMaxX:P,tooltipFormat:new m('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:P,nullColor:P,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:P,chartRangeMin:P,chartRangeClip:!1,colorMap:P,tooltipFormat:new m('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new m('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss",0:"Draw",1:"Win"}}},discrete:{lineHeight:"auto",thresholdColor:P,thresholdValue:0,chartRangeMax:P,chartRangeMin:P,chartRangeClip:!1,tooltipFormat:new m("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:P,tooltipFormat:new m("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],borderWidth:0,borderColor:"#000",tooltipFormat:new m('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:P,targetColor:"#4a2",chartRangeMax:P,chartRangeMin:P,tooltipFormat:new m("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}}},b=function(){var e,t=function(){this.init.apply(this,arguments)};return 1<arguments.length?(arguments[0]?(t.prototype=I.extend(new arguments[0],arguments[arguments.length-1]),t._super=arguments[0].prototype):t.prototype=arguments[arguments.length-1],2<arguments.length&&((e=Array.prototype.slice.call(arguments,1,-1)).unshift(t.prototype),I.extend.apply(I,e))):t.prototype=arguments[0],t.prototype.cls=t};I.SPFormatClass=m=b({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(e,t){this.format=e,this.fclass=t},render:function(e,t,i){var n,a,s,o,r=this,l=e;return this.format.replace(this.fre,function(){return n=arguments[1],a=arguments[3],(s=r.precre.exec(n))?(o=s[2],n=s[1]):o=!1,(s=l[n])===P?"":a&&t&&t[a]?t[a].get?t[a].get(s)||s:t[a][s]||s:s=d(s)?i.get("numberFormatter")?i.get("numberFormatter")(s):h(s,o,i.get("numberDigitGroupCount"),i.get("numberDigitGroupSep"),i.get("numberDecimalMark")):s})}}),I.spformat=function(e,t){return new m(e,t)},T=function(e,t,i){return e<t?t:i<e?i:e},w=function(e,t){var i;return 2===t?(i=H.floor(e.length/2),e.length%2?e[i]:(e[i-1]+e[i])/2):(i=e.length%2?(e.length*t+t)/4:(e.length*t+2)/4)%1?(e[H.floor(i)]+e[H.floor(i)-1])/2:e[i-1]},D=function(e){var t;switch(e){case"undefined":e=P;break;case"null":e=null;break;case"true":e=!0;break;case"false":e=!1;break;default:e==(t=parseFloat(e))&&(e=t)}return e},M=function(e){for(var t=[],i=e.length;i--;)t[i]=D(e[i]);return t},A=function(e,t){for(var i=[],n=0,a=e.length;n<a;n++)e[n]!==t&&i.push(e[n]);return i},d=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},h=function(e,t,i,n,a){var s;for(e=(!1===t?parseFloat(e).toString():e.toFixed(t)).split(""),(t=(t=I.inArray(".",e))<0?e.length:t)<e.length&&(e[t]=a),s=t-i;0<s;s-=i)e.splice(s,0,n);return e.join("")},x=function(e,t,i){for(var n=t.length;n--;)if((!i||null!==t[n])&&t[n]!==e)return!1;return!0},s=function(e){return I.isArray(e)?e:[e]},e=function(e){var t;_.createStyleSheet?_.createStyleSheet().cssText=e:((t=_.createElement("style")).type="text/css",_.getElementsByTagName("head")[0].appendChild(t),t["string"==typeof _.body.style.WebkitAppearance?"innerText":"innerHTML"]=e)},I.fn.simpledraw=function(e,t,i,n){var a;if(!i||!(a=this.data("_jqs_vcanvas"))){if(!1===I.fn.sparkline.canvas)return!1;if(I.fn.sparkline.canvas===P){var i=_.createElement("canvas");if(i.getContext&&i.getContext("2d"))I.fn.sparkline.canvas=function(e,t,i,n){return new p(e,t,i,n)};else{if(!_.namespaces||_.namespaces.v)return I.fn.sparkline.canvas=!1;_.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),I.fn.sparkline.canvas=function(e,t,i,n){return new g(e,t,i)}}}e===P&&(e=I(this).innerWidth()),t===P&&(t=I(this).innerHeight()),a=I.fn.sparkline.canvas(e,t,this,n),(i=I(this).data("_jqs_mhandler"))&&i.registerCanvas(a)}return a},I.fn.cleardraw=function(){var e=this.data("_jqs_vcanvas");e&&e.reset()},I.RangeMapClass=E=b({init:function(e){var t,i,n=[];for(t in e)e.hasOwnProperty(t)&&"string"==typeof t&&-1<t.indexOf(":")&&(i=t.split(":"),i[0]=0===i[0].length?-1/0:parseFloat(i[0]),i[1]=0===i[1].length?1/0:parseFloat(i[1]),i[2]=e[t],n.push(i));this.map=e,this.rangelist=n||!1},get:function(e){var t,i,n,a=this.rangelist;if((n=this.map[e])!==P)return n;if(a)for(t=a.length;t--;)if((i=a[t])[0]<=e&&i[1]>=e)return i[2];return P}}),I.range_map=function(e){return new E(e)},l=b({init:function(e,t){var i=I(e);this.$el=i,this.options=t,this.currentPageX=0,this.currentPageY=0,this.el=e,this.splist=[],this.tooltip=null,this.over=!1,this.displayTooltips=!t.get("disableTooltips"),this.highlightEnabled=!t.get("disableHighlight")},registerSparkline:function(e){this.splist.push(e),this.over&&this.updateDisplay()},registerCanvas:function(e){var t=I(e.canvas);this.canvas=e,(this.$canvas=t).mouseenter(I.proxy(this.mouseenter,this)),t.mouseleave(I.proxy(this.mouseleave,this)),t.click(I.proxy(this.mouseclick,this))},reset:function(e){this.splist=[],this.tooltip&&e&&(this.tooltip.remove(),this.tooltip=P)},mouseclick:function(e){var t=I.Event("sparklineClick");t.originalEvent=e,t.sparklines=this.splist,this.$el.trigger(t)},mouseenter:function(e){I(_.body).unbind("mousemove.jqs"),I(_.body).bind("mousemove.jqs",I.proxy(this.mousemove,this)),this.over=!0,this.currentPageX=e.pageX,this.currentPageY=e.pageY,this.currentEl=e.target,!this.tooltip&&this.displayTooltips&&(this.tooltip=new t(this.options),this.tooltip.updatePosition(e.pageX,e.pageY)),this.updateDisplay()},mouseleave:function(){I(_.body).unbind("mousemove.jqs");var e,t=this.splist,i=t.length,n=!1;for(this.over=!1,this.currentEl=null,this.tooltip&&(this.tooltip.remove(),this.tooltip=null),e=0;e<i;e++)t[e].clearRegionHighlight()&&(n=!0);n&&this.canvas.render()},mousemove:function(e){this.currentPageX=e.pageX,this.currentPageY=e.pageY,this.currentEl=e.target,this.tooltip&&this.tooltip.updatePosition(e.pageX,e.pageY),this.updateDisplay()},updateDisplay:function(){var e,t,i,n=this.splist,a=n.length,s=!1,o=this.$canvas.offset(),r=this.currentPageX-o.left,l=this.currentPageY-o.top;if(this.over){for(t=0;t<a;t++)(i=n[t].setRegionHighlight(this.currentEl,r,l))&&(s=!0);if(s){if((o=I.Event("sparklineRegionChange")).sparklines=this.splist,this.$el.trigger(o),this.tooltip){for(e="",t=0;t<a;t++)e+=n[t].getCurrentRegionTooltip();this.tooltip.setContent(e)}this.disableHighlight||this.canvas.render()}null===i&&this.mouseleave()}}}),t=b({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(e){var t=e.get("tooltipClassname","jqstooltip"),i=this.sizeStyle;this.container=e.get("tooltipContainer")||_.body,this.tooltipOffsetX=e.get("tooltipOffsetX",10),this.tooltipOffsetY=e.get("tooltipOffsetY",12),I("#jqssizetip").remove(),I("#jqstooltip").remove(),this.sizetip=I("<div/>",{id:"jqssizetip",style:i,class:t}),this.tooltip=I("<div/>",{id:"jqstooltip",class:t}).appendTo(this.container),e=this.tooltip.offset(),this.offsetLeft=e.left,this.offsetTop=e.top,this.hidden=!0,I(window).unbind("resize.jqs scroll.jqs"),I(window).bind("resize.jqs scroll.jqs",I.proxy(this.updateWindowDims,this)),this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=I(window).scrollTop(),this.scrollLeft=I(window).scrollLeft(),this.scrollRight=this.scrollLeft+I(window).width(),this.updatePosition()},getSize:function(e){this.sizetip.html(e).appendTo(this.container),this.width=this.sizetip.width()+1,this.height=this.sizetip.height(),this.sizetip.remove()},setContent:function(e){e?(this.getSize(e),this.tooltip.html(e).css({width:this.width,height:this.height,visibility:"visible"}),this.hidden&&(this.hidden=!1,this.updatePosition())):(this.tooltip.css("visibility","hidden"),this.hidden=!0)},updatePosition:function(e,t){if(e===P){if(this.mousex===P)return;e=this.mousex-this.offsetLeft,t=this.mousey-this.offsetTop}else this.mousex=e-=this.offsetLeft,this.mousey=t-=this.offsetTop;this.height&&this.width&&!this.hidden&&(t-=this.height+this.tooltipOffsetY,e+=this.tooltipOffsetX,t<this.scrollTop&&(t=this.scrollTop),e<this.scrollLeft?e=this.scrollLeft:e+this.width>this.scrollRight&&(e=this.scrollRight-this.width),this.tooltip.css({left:e,top:t}))},remove:function(){this.tooltip.remove(),this.sizetip.remove(),this.sizetip=this.tooltip=P,I(window).unbind("resize.jqs scroll.jqs")}}),I(function(){e('.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}')}),a=[],I.fn.sparkline=function(r,i){return this.each(function(){var e,s=new I.fn.sparkline.options(this,i),o=I(this),t=function(){var e,t,i,n="html"===r||r===P?(n=(n=this.getAttribute(s.get("tagValuesAttribute")))!==P&&null!==n?n:o.html()).replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(","):r,a="auto"===s.get("width")?n.length*s.get("defaultPixelsPerValue"):s.get("width");"auto"===s.get("height")?s.get("composite")&&I.data(this,"_jqs_vcanvas")||((i=_.createElement("span")).innerHTML="a",o.html(i),e=I(i).innerHeight()||I(i).height(),I(i).remove(),i=null):e=s.get("height"),s.get("disableInteraction")?t=!1:(t=I.data(this,"_jqs_mhandler"))?s.get("composite")||t.reset():(t=new l(this,s),I.data(this,"_jqs_mhandler",t)),s.get("composite")&&!I.data(this,"_jqs_vcanvas")?I.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),I.data(this,"_jqs_errnotify",!0)):((i=new I.fn.sparkline[s.get("type")](this,n,s,a,e)).render(),t&&t.registerSparkline(i))};if(I(this).html()&&!s.get("disableHiddenCheck")&&I(this).is(":hidden")||!I(this).parents("body").length){if(!s.get("composite")&&I.data(this,"_jqs_pending"))for(e=a.length;e;e--)a[e-1][0]==this&&a.splice(e-1,1);a.push([this,t]),I.data(this,"_jqs_pending",!0)}else t.call(this)})},I.fn.sparkline.defaults=i(),I.sparkline_display_visible=function(){for(var e,t=[],i=0,n=a.length;i<n;i++)e=a[i][0],I(e).is(":visible")&&!I(e).parents().is(":hidden")?(a[i][1].call(e),I.data(a[i][0],"_jqs_pending",!1),t.push(i)):I(e).closest("html").length||I.data(e,"_jqs_pending")||(I.data(a[i][0],"_jqs_pending",!1),t.push(i));for(i=t.length;i;i--)a.splice(t[i-1],1)},I.fn.sparkline.options=b({init:function(e,t){var i,n;this.userOptions=t=t||{},this.tag=e,this.tagValCache={},i=(e=I.fn.sparkline.defaults).common,this.tagOptionsPrefix=t.enableTagOptions&&(t.tagOptionsPrefix||i.tagOptionsPrefix),e=(n=this.getTagSetting("type"))===f?e[t.type||i.type]:e[n],this.mergedOptions=I.extend({},i,e,t)},getTagSetting:function(e){var t,i,n,a,s=this.tagOptionsPrefix;if(!1===s||s===P)return f;if(this.tagValCache.hasOwnProperty(e))t=this.tagValCache.key;else{if((t=this.tag.getAttribute(s+e))===P||null===t)t=f;else if("["===t.substr(0,1))for(i=(t=t.substr(1,t.length-2).split(",")).length;i--;)t[i]=D(t[i].replace(/(^\s*)|(\s*$)/g,""));else if("{"===t.substr(0,1))for(n=t.substr(1,t.length-2).split(","),t={},i=n.length;i--;)t[(a=n[i].split(":",2))[0].replace(/(^\s*)|(\s*$)/g,"")]=D(a[1].replace(/(^\s*)|(\s*$)/g,""));else t=D(t);this.tagValCache.key=t}return t},get:function(e,t){var i=this.getTagSetting(e);return i!==f?i:(i=this.mergedOptions[e])===P?t:i}}),I.fn.sparkline._base=b({disabled:!1,init:function(e,t,i,n,a){this.el=e,this.$el=I(e),this.values=t,this.options=i,this.width=n,this.height=a,this.currentRegion=P},initTarget:function(){var e=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),e))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return!this.disabled||(this.el.innerHTML="",!1)},getRegion:function(e,t){},setRegionHighlight:function(e,t,i){var n=this.currentRegion,a=!this.options.get("disableHighlight");return t>this.canvasWidth||i>this.canvasHeight||t<0||i<0?null:n!==(e=this.getRegion(e,t,i))&&(n!==P&&a&&this.removeHighlight(),(this.currentRegion=e)!==P&&a&&this.renderHighlight(),!0)},clearRegionHighlight:function(){return this.currentRegion!==P&&(this.removeHighlight(),!(this.currentRegion=P))},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(e){},getCurrentRegionTooltip:function(){var e,t,i,n,a,s,o,r,l,d,h,c,u,p,g=this.options,f="",v=[];if(this.currentRegion===P)return"";if(e=this.getCurrentRegionFields(),h=g.get("tooltipFormatter"))return h(this,g,e);if(g.get("tooltipChartTitle")&&(f+='<div class="jqs jqstitle">'+g.get("tooltipChartTitle")+"</div>\n"),!(t=this.options.get("tooltipFormat")))return"";if(I.isArray(t)||(t=[t]),I.isArray(e)||(e=[e]),o=this.options.get("tooltipFormatFieldlist"),r=this.options.get("tooltipFormatFieldlistKey"),o&&r){for(l=[],s=e.length;s--;)d=e[s][r],-1!=(p=I.inArray(d,o))&&(l[p]=e[s]);e=l}for(i=t.length,u=e.length,s=0;s<i;s++)for(n=(c="string"==typeof(c=t[s])?new m(c):c).fclass||"jqsfield",p=0;p<u;p++)e[p].isNull&&g.get("tooltipSkipNull")||(I.extend(e[p],{prefix:g.get("tooltipPrefix"),suffix:g.get("tooltipSuffix")}),a=c.render(e[p],g.get("tooltipValueLookups"),g),v.push('<div class="'+n+'">'+a+"</div>"));return v.length?f+v.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(e,t){var i,n,a,s,o=t.get("highlightColor"),r=t.get("highlightLighten");if(o)return o;if(r&&(i=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(e))){for(a=[],n=4===e.length?16:1,s=0;s<3;s++)a[s]=T(H.round(parseInt(i[s+1],16)*n*r),0,255);return"rgb("+a.join(",")+")"}return e}}),i={changeHighlight:function(e){var t=this.currentRegion,i=this.target,n=this.regionShapes[t];n&&(e=this.renderRegion(t,e),I.isArray(e)||I.isArray(n)?(i.replaceWithShapes(n,e),this.regionShapes[t]=I.map(e,function(e){return e.id})):(i.replaceWithShape(n,e),this.regionShapes[t]=e.id))},render:function(){var e,t,i,n,a=this.values,s=this.target,o=this.regionShapes;if(this.cls._super.render.call(this)){for(i=a.length;i--;)if(e=this.renderRegion(i))if(I.isArray(e)){for(t=[],n=e.length;n--;)e[n].append(),t.push(e[n].id);o[i]=t}else e.append(),o[i]=e.id;else o[i]=null;s.render()}}},I.fn.sparkline.line=N=b(I.fn.sparkline._base,{type:"line",init:function(e,t,i,n,a){N._super.init.call(this,e,t,i,n,a),this.vertices=[],this.regionMap=[],this.xvalues=[],this.yvalues=[],this.yminmax=[],this.hightlightSpotId=null,this.lastShapeId=null,this.initTarget()},getRegion:function(e,t,i){for(var n=this.regionMap,a=n.length;a--;)if(null!==n[a]&&t>=n[a][0]&&t<=n[a][1])return n[a][2];return P},getCurrentRegionFields:function(){var e=this.currentRegion;return{isNull:null===this.yvalues[e],x:this.xvalues[e],y:this.yvalues[e],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:e}},renderHighlight:function(){var e=this.currentRegion,t=this.target,e=this.vertices[e],i=this.options,n=i.get("spotRadius"),a=i.get("highlightSpotColor"),i=i.get("highlightLineColor");e&&(n&&a&&(n=t.drawCircle(e[0],e[1],n,P,a),this.highlightSpotId=n.id,t.insertAfterShape(this.lastShapeId,n)),i)&&(a=t.drawLine(e[0],this.canvasTop,e[0],this.canvasTop+this.canvasHeight,i),this.highlightLineId=a.id,t.insertAfterShape(this.lastShapeId,a))},removeHighlight:function(){var e=this.target;this.highlightSpotId&&(e.removeShapeId(this.highlightSpotId),this.highlightSpotId=null),this.highlightLineId&&(e.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){for(var e,t,i,n,a=this.values,s=a.length,o=this.xvalues,r=this.yvalues,l=this.yminmax,d=0;d<s;d++)e=a[d],t="string"==typeof a[d],i="object"==typeof a[d]&&a[d]instanceof Array,n=t&&a[d].split(":"),t&&2===n.length?(o.push(Number(n[0])),r.push(Number(n[1])),l.push(Number(n[1]))):i?(o.push(e[0]),r.push(e[1]),l.push(e[1])):(o.push(d),null===a[d]||"null"===a[d]?r.push(null):(r.push(Number(e)),l.push(Number(e))));this.options.get("xvalues")&&(o=this.options.get("xvalues")),this.maxy=this.maxyorg=H.max.apply(H,l),this.miny=this.minyorg=H.min.apply(H,l),this.maxx=H.max.apply(H,o),this.minx=H.min.apply(H,o),this.xvalues=o,this.yvalues=r,this.yminmax=l},processRangeOptions:function(){var e=this.options,t=e.get("normalRangeMin"),i=e.get("normalRangeMax");t!==P&&(t<this.miny&&(this.miny=t),i>this.maxy)&&(this.maxy=i),e.get("chartRangeMin")!==P&&(e.get("chartRangeClip")||e.get("chartRangeMin")<this.miny)&&(this.miny=e.get("chartRangeMin")),e.get("chartRangeMax")!==P&&(e.get("chartRangeClip")||e.get("chartRangeMax")>this.maxy)&&(this.maxy=e.get("chartRangeMax")),e.get("chartRangeMinX")!==P&&(e.get("chartRangeClipX")||e.get("chartRangeMinX")<this.minx)&&(this.minx=e.get("chartRangeMinX")),e.get("chartRangeMaxX")!==P&&(e.get("chartRangeClipX")||e.get("chartRangeMaxX")>this.maxx)&&(this.maxx=e.get("chartRangeMaxX"))},drawNormalRange:function(e,t,i,n,a){var s=this.options.get("normalRangeMin"),o=this.options.get("normalRangeMax"),t=t+H.round(i-i*((o-this.miny)/a)),i=H.round(i*(o-s)/a);this.target.drawRect(e,t,n,i,P,this.options.get("normalRangeColor")).append()},render:function(){var e,t,i,n,a,s,o,r,l,d,h,c,u,p,g,f,v,m,b,w,y,_,x=this.options,C=this.target,S=this.canvasWidth,$=this.canvasHeight,k=this.vertices,R=x.get("spotRadius"),T=this.regionMap;if(N._super.render.call(this)&&(this.scanValues(),this.processRangeOptions(),w=this.xvalues,y=this.yvalues,this.yminmax.length)&&!(this.yvalues.length<2)){for(n=a=0,e=this.maxx-this.minx==0?1:this.maxx-this.minx,t=this.maxy-this.miny==0?1:this.maxy-this.miny,i=this.yvalues.length-1,(R=R&&(S<4*R||$<4*R)?0:R)&&(((m=x.get("highlightSpotColor")&&!x.get("disableInteraction"))||x.get("minSpotColor")||x.get("spotColor")&&y[i]===this.miny)&&($-=H.ceil(R)),(m||x.get("maxSpotColor")||x.get("spotColor")&&y[i]===this.maxy)&&($-=H.ceil(R),n+=H.ceil(R)),!m&&(!x.get("minSpotColor")&&!x.get("maxSpotColor")||y[0]!==this.miny&&y[0]!==this.maxy)||(a+=H.ceil(R),S-=H.ceil(R)),m||x.get("spotColor")||x.get("minSpotColor")||x.get("maxSpotColor")&&(y[i]===this.miny||y[i]===this.maxy))&&(S-=H.ceil(R)),$--,x.get("normalRangeMin")===P||x.get("drawNormalOnTop")||this.drawNormalRange(a,n,$,S,t),o=[s=[]],h=null,u=y.length,_=0;_<u;_++)r=w[_],c=w[_+1],l=y[_],d=a+H.round((r-this.minx)*(S/e)),c=_<u-1?a+H.round((c-this.minx)*(S/e)):S,T[_]=[h||0,c=d+(c-d)/2,_],h=c,null===l?_&&(null!==y[_-1]&&o.push(s=[]),k.push(null)):((l=l<this.miny?this.miny:l)>this.maxy&&(l=this.maxy),s.length||s.push([d,n+$]),c=[d,n+H.round($-$*((l-this.miny)/t))],s.push(c),k.push(c));for(p=[],g=[],f=o.length,_=0;_<f;_++)(s=o[_]).length&&(x.get("fillColor")&&(s.push([s[s.length-1][0],n+$]),g.push(s.slice(0)),s.pop()),2<s.length&&(s[0]=[s[0][0],s[1][1]]),p.push(s));for(f=g.length,_=0;_<f;_++)C.drawShape(g[_],x.get("fillColor"),x.get("fillColor")).append();for(x.get("normalRangeMin")!==P&&x.get("drawNormalOnTop")&&this.drawNormalRange(a,n,$,S,t),f=p.length,_=0;_<f;_++)C.drawShape(p[_],x.get("lineColor"),P,x.get("lineWidth")).append();if(R&&x.get("valueSpots"))for((v=x.get("valueSpots")).get===P&&(v=new E(v)),_=0;_<u;_++)(b=v.get(y[_]))&&C.drawCircle(a+H.round((w[_]-this.minx)*(S/e)),n+H.round($-$*((y[_]-this.miny)/t)),R,P,b).append();R&&x.get("spotColor")&&null!==y[i]&&C.drawCircle(a+H.round((w[w.length-1]-this.minx)*(S/e)),n+H.round($-$*((y[i]-this.miny)/t)),R,P,x.get("spotColor")).append(),this.maxy!==this.minyorg&&(R&&x.get("minSpotColor")&&(r=w[I.inArray(this.minyorg,y)],C.drawCircle(a+H.round((r-this.minx)*(S/e)),n+H.round($-$*((this.minyorg-this.miny)/t)),R,P,x.get("minSpotColor")).append()),R)&&x.get("maxSpotColor")&&(r=w[I.inArray(this.maxyorg,y)],C.drawCircle(a+H.round((r-this.minx)*(S/e)),n+H.round($-$*((this.maxyorg-this.miny)/t)),R,P,x.get("maxSpotColor")).append()),this.lastShapeId=C.getLastShapeId(),this.canvasTop=n,C.render()}}}),I.fn.sparkline.bar=O=b(I.fn.sparkline._base,i,{type:"bar",init:function(e,t,i,n,a){var s,o,r,l,d,h,c,u,p,g,f=parseInt(i.get("barWidth"),10),v=parseInt(i.get("barSpacing"),10),m=i.get("chartRangeMin"),b=i.get("chartRangeMax"),w=i.get("chartRangeClip"),y=1/0,_=-1/0;for(O._super.init.call(this,e,t,i,n,a),k=0,R=t.length;k<R;k++)((s="string"==typeof(p=t[k])&&-1<p.indexOf(":"))||I.isArray(p))&&(l=!0,s&&(p=t[k]=M(p.split(":"))),p=A(p,null),(s=H.min.apply(H,p))<y&&(y=s),_<(s=H.max.apply(H,p)))&&(_=s);this.stacked=l,this.regionShapes={},this.barWidth=f,this.barSpacing=v,this.totalBarWidth=f+v,this.width=n=t.length*f+(t.length-1)*v,this.initTarget(),w&&(o=m===P?-1/0:m,r=b===P?1/0:b);for(var x=[],C=l?[]:x,S=[],$=[],k=0,R=t.length;k<R;k++)if(l)for(d=t[k],t[k]=u=[],h=C[k]=$[k]=S[k]=0,c=d.length;h<c;h++)null!==(p=u[h]=w?T(d[h],o,r):d[h])&&(0<p&&(S[k]+=p),y<0&&0<_?p<0?$[k]+=H.abs(p):C[k]+=p:C[k]+=H.abs(p-(p<0?_:y)),x.push(p));else p=w?T(t[k],o,r):t[k],null!==(p=t[k]=D(p))&&x.push(p);this.max=e=H.max.apply(H,x),this.min=a=H.min.apply(H,x),this.stackMax=_=l?H.max.apply(H,S):e,this.stackMin=y=l?H.min.apply(H,x):a,i.get("chartRangeMin")!==P&&(i.get("chartRangeClip")||i.get("chartRangeMin")<a)&&(a=i.get("chartRangeMin")),i.get("chartRangeMax")!==P&&(i.get("chartRangeClip")||i.get("chartRangeMax")>e)&&(e=i.get("chartRangeMax")),this.zeroAxis=f=i.get("zeroAxis",!0),this.xaxisOffset=v=a<=0&&0<=e&&f?0:0==f||0<a?a:e,n=l?H.max.apply(H,C)+H.max.apply(H,$):e-a,this.canvasHeightEf=f&&a<0?this.canvasHeight-2:this.canvasHeight-1,a<v?(g=((l&&0<=e?_:e)-v)/n*this.canvasHeight)!==H.ceil(g)&&(this.canvasHeightEf-=2,g=H.ceil(g)):g=this.canvasHeight,this.yoffset=g,I.isArray(i.get("colorMap"))?(this.colorMapByIndex=i.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=i.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===P&&(this.colorMapByValue=new E(this.colorMapByValue))),this.range=n},getRegion:function(e,t,i){t=H.floor(t/this.totalBarWidth);return t<0||t>=this.values.length?P:t},getCurrentRegionFields:function(){for(var e,t=this.currentRegion,i=s(this.values[t]),n=[],a=i.length;a--;)e=i[a],n.push({isNull:null===e,value:e,color:this.calcColor(a,e,t),offset:t});return n},calcColor:function(e,t,i){var n=this.colorMapByIndex,a=this.colorMapByValue,s=this.options,o=this.stacked?s.get("stackedBarColor"):t<0?s.get("negBarColor"):s.get("barColor");return 0===t&&s.get("zeroColor")!==P&&(o=s.get("zeroColor")),a&&(s=a.get(t))?o=s:n&&n.length>i&&(o=n[i]),I.isArray(o)?o[e%o.length]:o},renderRegion:function(e,t){var i,n,a,s,o,r,l,d=this.values[e],h=this.options,c=this.xaxisOffset,u=[],p=this.range,g=this.stacked,f=this.target,v=e*this.totalBarWidth,m=this.canvasHeightEf,b=this.yoffset,w=(d=I.isArray(d)?d:[d]).length,y=(d[0],x(null,d)),_=x(c,d,!0);if(y)return h.get("nullColor")?(a=t?h.get("nullColor"):this.calcHighlightColor(h.get("nullColor"),h),f.drawRect(v,i=0<b?b-1:b,this.barWidth-1,0,a,a)):P;for(s=b,o=0;o<w;o++){if(l=d[o],g&&l===c){if(!_||r)continue;r=!0}n=0<p?H.floor(m*(H.abs(l-c)/p))+1:1,l<c||l===c&&0===b?(i=s,s+=n):(i=b-n,b-=n),a=this.calcColor(o,l,e),t&&(a=this.calcHighlightColor(a,h)),u.push(f.drawRect(v,i,this.barWidth-1,n-1,a,a))}return 1===u.length?u[0]:u}}),I.fn.sparkline.tristate=r=b(I.fn.sparkline._base,i,{type:"tristate",init:function(e,t,i,n,a){var s=parseInt(i.get("barWidth"),10),o=parseInt(i.get("barSpacing"),10);r._super.init.call(this,e,t,i,n,a),this.regionShapes={},this.barWidth=s,this.barSpacing=o,this.totalBarWidth=s+o,this.values=I.map(t,Number),this.width=n=t.length*s+(t.length-1)*o,I.isArray(i.get("colorMap"))?(this.colorMapByIndex=i.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=i.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===P&&(this.colorMapByValue=new E(this.colorMapByValue))),this.initTarget()},getRegion:function(e,t,i){return H.floor(t/this.totalBarWidth)},getCurrentRegionFields:function(){var e=this.currentRegion;return{isNull:this.values[e]===P,value:this.values[e],color:this.calcColor(this.values[e],e),offset:e}},calcColor:function(e,t){var i=this.values,n=this.options,a=this.colorMapByIndex,s=this.colorMapByValue,e=s&&(s=s.get(e))?s:a&&a.length>t?a[t]:i[t]<0?n.get("negBarColor"):0<i[t]?n.get("posBarColor"):n.get("zeroBarColor");return e},renderRegion:function(e,t){var i,n=this.values,a=this.options,s=this.target,o=s.pixelHeight,o=H.round(o/2),r=e*this.totalBarWidth,o=n[e]<0?(i=o)-1:0<n[e]?(i=0,o-1):(i=o-1,2),n=this.calcColor(n[e],e);if(null!==n)return t&&(n=this.calcHighlightColor(n,a)),s.drawRect(r,i,this.barWidth-1,o-1,n,n)}}),I.fn.sparkline.discrete=o=b(I.fn.sparkline._base,i,{type:"discrete",init:function(e,t,i,n,a){o._super.init.call(this,e,t,i,n,a),this.regionShapes={},this.values=t=I.map(t,Number),this.min=H.min.apply(H,t),this.max=H.max.apply(H,t),this.range=this.max-this.min,this.width=n="auto"===i.get("width")?2*t.length:this.width,this.interval=H.floor(n/t.length),this.itemWidth=n/t.length,i.get("chartRangeMin")!==P&&(i.get("chartRangeClip")||i.get("chartRangeMin")<this.min)&&(this.min=i.get("chartRangeMin")),i.get("chartRangeMax")!==P&&(i.get("chartRangeClip")||i.get("chartRangeMax")>this.max)&&(this.max=i.get("chartRangeMax")),this.initTarget(),this.target&&(this.lineHeight="auto"===i.get("lineHeight")?H.round(.3*this.canvasHeight):i.get("lineHeight"))},getRegion:function(e,t,i){return H.floor(t/this.itemWidth)},getCurrentRegionFields:function(){var e=this.currentRegion;return{isNull:this.values[e]===P,value:this.values[e],offset:e}},renderRegion:function(e,t){var i=this.values,n=this.options,a=this.min,s=this.max,o=this.range,r=this.interval,l=this.target,d=this.canvasHeight,h=this.lineHeight,d=d-h,i=T(i[e],a,s),s=e*r,e=H.round(d-(i-a)/o*d),r=n.get("thresholdColor")&&i<n.get("thresholdValue")?n.get("thresholdColor"):n.get("lineColor");return t&&(r=this.calcHighlightColor(r,n)),l.drawLine(s,e,s,e+h,r)}}),I.fn.sparkline.bullet=c=b(I.fn.sparkline._base,{type:"bullet",init:function(e,t,i,n,a){var s;c._super.init.call(this,e,t,i,n,a),this.values=t=M(t),(e=t.slice())[0]=null===e[0]?e[2]:e[0],e[1]=null===t[1]?e[2]:e[1],e=H.min.apply(H,t),s=H.max.apply(H,t),e=i.get("base")===P?e<0?e:0:i.get("base"),this.min=e,this.max=s,this.range=s-e,this.shapes={},this.valueShapes={},this.regiondata={},this.width=n="auto"===i.get("width")?"4.0em":n,this.target=this.$el.simpledraw(n,a,i.get("composite")),t.length||(this.disabled=!0),this.initTarget()},getRegion:function(e,t,i){e=this.target.getShapeAt(e,t,i);return e!==P&&this.shapes[e]!==P?this.shapes[e]:P},getCurrentRegionFields:function(){var e=this.currentRegion;return{fieldkey:e.substr(0,1),value:this.values[e.substr(1)],region:e}},changeHighlight:function(e){var t,i=this.currentRegion,n=this.valueShapes[i];switch(delete this.shapes[n],i.substr(0,1)){case"r":t=this.renderRange(i.substr(1),e);break;case"p":t=this.renderPerformance(e);break;case"t":t=this.renderTarget(e)}this.valueShapes[i]=t.id,this.shapes[t.id]=i,this.target.replaceWithShape(n,t)},renderRange:function(e,t){var i=this.values[e],i=H.round(this.canvasWidth*((i-this.min)/this.range)),e=this.options.get("rangeColors")[e-2];return t&&(e=this.calcHighlightColor(e,this.options)),this.target.drawRect(0,0,i-1,this.canvasHeight-1,e,e)},renderPerformance:function(e){var t=this.values[1],t=H.round(this.canvasWidth*((t-this.min)/this.range)),i=this.options.get("performanceColor");return e&&(i=this.calcHighlightColor(i,this.options)),this.target.drawRect(0,H.round(.3*this.canvasHeight),t-1,H.round(.4*this.canvasHeight)-1,i,i)},renderTarget:function(e){var t=this.values[0],t=H.round(this.canvasWidth*((t-this.min)/this.range)-this.options.get("targetWidth")/2),i=H.round(.1*this.canvasHeight),n=this.canvasHeight-2*i,a=this.options.get("targetColor");return e&&(a=this.calcHighlightColor(a,this.options)),this.target.drawRect(t,i,this.options.get("targetWidth")-1,n-1,a,a)},render:function(){var e,t,i=this.values.length,n=this.target;if(c._super.render.call(this)){for(e=2;e<i;e++)t=this.renderRange(e).append(),this.shapes[t.id]="r"+e,this.valueShapes["r"+e]=t.id;null!==this.values[1]&&(t=this.renderPerformance().append(),this.shapes[t.id]="p1",this.valueShapes.p1=t.id),null!==this.values[0]&&(t=this.renderTarget().append(),this.shapes[t.id]="t0",this.valueShapes.t0=t.id),n.render()}}}),I.fn.sparkline.pie=u=b(I.fn.sparkline._base,{type:"pie",init:function(e,t,i,n,a){var s,o=0;if(u._super.init.call(this,e,t,i,n,a),this.shapes={},this.valueShapes={},this.values=t=I.map(t,Number),"auto"===i.get("width")&&(this.width=this.height),0<t.length)for(s=t.length;s--;)o+=t[s];this.total=o,this.initTarget(),this.radius=H.floor(H.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(e,t,i){e=this.target.getShapeAt(e,t,i);return e!==P&&this.shapes[e]!==P?this.shapes[e]:P},getCurrentRegionFields:function(){var e=this.currentRegion;return{isNull:this.values[e]===P,value:this.values[e],percent:this.values[e]/this.total*100,color:this.options.get("sliceColors")[e%this.options.get("sliceColors").length],offset:e}},changeHighlight:function(e){var t=this.currentRegion,e=this.renderSlice(t,e),i=this.valueShapes[t];delete this.shapes[i],this.target.replaceWithShape(i,e),this.valueShapes[t]=e.id,this.shapes[e.id]=t},renderSlice:function(e,t){for(var i,n,a,s=this.target,o=this.options,r=this.radius,l=o.get("borderWidth"),d=o.get("offset"),h=2*H.PI,c=this.values,u=this.total,p=d?2*H.PI*(d/360):0,g=c.length,f=0;f<g;f++){if(n=i=p,0<u&&(n=p+h*(c[f]/u)),e===f)return a=o.get("sliceColors")[f%o.get("sliceColors").length],t&&(a=this.calcHighlightColor(a,o)),s.drawPieSlice(r,r,r-l,i,n,P,a);p=n}},render:function(){var e,t,i=this.target,n=this.values,a=this.options,s=this.radius,o=a.get("borderWidth");if(u._super.render.call(this)){for(o&&i.drawCircle(s,s,H.floor(s-o/2),a.get("borderColor"),P,o).append(),t=n.length;t--;)n[t]&&(e=this.renderSlice(t).append(),this.valueShapes[t]=e.id,this.shapes[e.id]=t);i.render()}}}),I.fn.sparkline.box=y=b(I.fn.sparkline._base,{type:"box",init:function(e,t,i,n,a){y._super.init.call(this,e,t,i,n,a),this.values=I.map(t,Number),this.width="auto"===i.get("width")?"4.0em":n,this.initTarget(),this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var e=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];return this.loutlier!==P&&e.push({field:"lo",value:this.loutlier}),this.routlier!==P&&e.push({field:"ro",value:this.routlier}),this.lwhisker!==P&&e.push({field:"lw",value:this.lwhisker}),this.rwhisker!==P&&e.push({field:"rw",value:this.rwhisker}),e},render:function(){var e,t,i,n,a,s,o,r,l,d,h=this.target,c=this.values,u=c.length,p=this.options,g=this.canvasWidth,f=this.canvasHeight,v=p.get("chartRangeMin")===P?H.min.apply(H,c):p.get("chartRangeMin"),m=p.get("chartRangeMax")===P?H.max.apply(H,c):p.get("chartRangeMax"),b=0;if(y._super.render.call(this)){if(p.get("raw"))p.get("showOutliers")&&5<c.length?(t=c[0],e=c[1],n=c[2],a=c[3],s=c[4],o=c[5],r=c[6]):(e=c[0],n=c[1],a=c[2],s=c[3],o=c[4]);else if(c.sort(function(e,t){return e-t}),n=w(c,1),a=w(c,2),i=(s=w(c,3))-n,p.get("showOutliers")){for(e=o=P,l=0;l<u;l++)e===P&&c[l]>n-i*p.get("outlierIQR")&&(e=c[l]),c[l]<s+i*p.get("outlierIQR")&&(o=c[l]);t=c[0],r=c[u-1]}else e=c[0],o=c[u-1];this.quartiles=[n,a,s],this.lwhisker=e,this.rwhisker=o,this.loutlier=t,this.routlier=r,d=g/(m-v+1),p.get("showOutliers")&&(b=H.ceil(p.get("spotRadius")),d=(g-=2*H.ceil(p.get("spotRadius")))/(m-v+1),t<e&&h.drawCircle((t-v)*d+b,f/2,p.get("spotRadius"),p.get("outlierLineColor"),p.get("outlierFillColor")).append(),o<r)&&h.drawCircle((r-v)*d+b,f/2,p.get("spotRadius"),p.get("outlierLineColor"),p.get("outlierFillColor")).append(),h.drawRect(H.round((n-v)*d+b),H.round(.1*f),H.round((s-n)*d),H.round(.8*f),p.get("boxLineColor"),p.get("boxFillColor")).append(),h.drawLine(H.round((e-v)*d+b),H.round(f/2),H.round((n-v)*d+b),H.round(f/2),p.get("lineColor")).append(),h.drawLine(H.round((e-v)*d+b),H.round(f/4),H.round((e-v)*d+b),H.round(f-f/4),p.get("whiskerColor")).append(),h.drawLine(H.round((o-v)*d+b),H.round(f/2),H.round((s-v)*d+b),H.round(f/2),p.get("lineColor")).append(),h.drawLine(H.round((o-v)*d+b),H.round(f/4),H.round((o-v)*d+b),H.round(f-f/4),p.get("whiskerColor")).append(),h.drawLine(H.round((a-v)*d+b),H.round(.1*f),H.round((a-v)*d+b),H.round(.9*f),p.get("medianColor")).append(),p.get("target")&&(g=H.ceil(p.get("spotRadius")),h.drawLine(H.round((p.get("target")-v)*d+b),H.round(f/2-g),H.round((p.get("target")-v)*d+b),H.round(f/2+g),p.get("targetColor")).append(),h.drawLine(H.round((p.get("target")-v)*d+b-g),H.round(f/2),H.round((p.get("target")-v)*d+b+g),H.round(f/2),p.get("targetColor")).append()),h.render()}}}),n=b({init:function(e,t,i,n){this.target=e,this.id=t,this.type=i,this.args=n},append:function(){return this.target.appendShape(this),this}}),i=b({_pxregex:/(\d+)(px)?\s*$/i,init:function(e,t,i){e&&(this.width=e,this.height=t,this.target=i,this.lastShapeId=null,i[0]&&(i=i[0]),I.data(i,"_jqs_vcanvas",this))},drawLine:function(e,t,i,n,a,s){return this.drawShape([[e,t],[i,n]],a,s)},drawShape:function(e,t,i,n){return this._genShape("Shape",[e,t,i,n])},drawCircle:function(e,t,i,n,a,s){return this._genShape("Circle",[e,t,i,n,a,s])},drawPieSlice:function(e,t,i,n,a,s,o){return this._genShape("PieSlice",[e,t,i,n,a,s,o])},drawRect:function(e,t,i,n,a,s){return this._genShape("Rect",[e,t,i,n,a,s])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(e,t){I(t).html(e)},_calculatePixelDims:function(e,t,i){t=this._pxregex.exec(t);this.pixelHeight=t?t[1]:I(i).height(),t=this._pxregex.exec(e),this.pixelWidth=t?t[1]:I(i).width()},_genShape:function(e,t){var i=v++;return t.unshift(i),new n(this,i,e,t)},appendShape:function(e){alert("appendShape not implemented")},replaceWithShape:function(e,t){alert("replaceWithShape not implemented")},insertAfterShape:function(e,t){alert("insertAfterShape not implemented")},removeShapeId:function(e){alert("removeShapeId not implemented")},getShapeAt:function(e,t,i){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}}),p=b(i,{init:function(e,t,i,n){p._super.init.call(this,e,t,i),this.canvas=_.createElement("canvas"),i[0]&&(i=i[0]),I.data(i,"_jqs_vcanvas",this),I(this.canvas).css({display:"inline-block",width:e,height:t,verticalAlign:"top"}),this._insert(this.canvas,i),this._calculatePixelDims(e,t,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,this.interact=n,this.shapes={},this.shapeseq=[],this.currentTargetShapeId=P,I(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(e,t,i){var n=this.canvas.getContext("2d");return e!==P&&(n.strokeStyle=e),n.lineWidth=i===P?1:i,t!==P&&(n.fillStyle=t),n},reset:function(){this._getContext().clearRect(0,0,this.pixelWidth,this.pixelHeight),this.shapes={},this.shapeseq=[],this.currentTargetShapeId=P},_drawShape:function(e,t,i,n,a){var s,o,r=this._getContext(i,n,a);for(r.beginPath(),r.moveTo(t[0][0]+.5,t[0][1]+.5),s=1,o=t.length;s<o;s++)r.lineTo(t[s][0]+.5,t[s][1]+.5);i!==P&&r.stroke(),n!==P&&r.fill(),this.targetX!==P&&this.targetY!==P&&r.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=e)},_drawCircle:function(e,t,i,n,a,s,o){o=this._getContext(a,s,o);o.beginPath(),o.arc(t,i,n,0,2*H.PI,!1),this.targetX!==P&&this.targetY!==P&&o.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=e),a!==P&&o.stroke(),s!==P&&o.fill()},_drawPieSlice:function(e,t,i,n,a,s,o,r){var l=this._getContext(o,r);l.beginPath(),l.moveTo(t,i),l.arc(t,i,n,a,s,!1),l.lineTo(t,i),l.closePath(),o!==P&&l.stroke(),r&&l.fill(),this.targetX!==P&&this.targetY!==P&&l.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=e)},_drawRect:function(e,t,i,n,a,s,o){return this._drawShape(e,[[t,i],[t+n,i],[t+n,i+a],[t,i+a],[t,i]],s,o)},appendShape:function(e){return this.shapes[e.id]=e,this.shapeseq.push(e.id),this.lastShapeId=e.id,e.id},replaceWithShape:function(e,t){var i,n=this.shapeseq;for(this.shapes[t.id]=t,i=n.length;i--;)n[i]==e&&(n[i]=t.id);delete this.shapes[e]},replaceWithShapes:function(e,t){for(var i,n,a=this.shapeseq,s={},o=e.length;o--;)s[e[o]]=!0;for(o=a.length;o--;)s[i=a[o]]&&(a.splice(o,1),delete this.shapes[i],n=o);for(o=t.length;o--;)a.splice(n,0,t[o].id),this.shapes[t[o].id]=t[o]},insertAfterShape:function(e,t){for(var i=this.shapeseq,n=i.length;n--;)if(i[n]===e)return i.splice(n+1,0,t.id),void(this.shapes[t.id]=t)},removeShapeId:function(e){for(var t=this.shapeseq,i=t.length;i--;)if(t[i]===e){t.splice(i,1);break}delete this.shapes[e]},getShapeAt:function(e,t,i){return this.targetX=t,this.targetY=i,this.render(),this.currentTargetShapeId},render:function(){var e,t,i=this.shapeseq,n=this.shapes,a=i.length;for(this._getContext().clearRect(0,0,this.pixelWidth,this.pixelHeight),t=0;t<a;t++)this["_draw"+(e=n[i[t]]).type].apply(this,e.args);this.interact||(this.shapes={},this.shapeseq=[])}}),g=b(i,{init:function(e,t,i){g._super.init.call(this,e,t,i),i[0]&&(i=i[0]),I.data(i,"_jqs_vcanvas",this),this.canvas=_.createElement("span"),I(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:e,height:t,margin:"0px",padding:"0px",verticalAlign:"top"}),this._insert(this.canvas,i),this._calculatePixelDims(e,t,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,i='<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" style="position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height="+this.pixelHeight+'px;"></v:group>',this.canvas.insertAdjacentHTML("beforeEnd",i),this.group=I(this.canvas).children()[0],this.rendered=!1,this.prerender=""},_drawShape:function(e,t,i,n,a){for(var s,o,r=[],l=0,d=t.length;l<d;l++)r[l]=t[l][0]+","+t[l][1];return s=r.splice(0,1),a=a===P?1:a,o=r[0]===r[r.length-1]?"x ":"",'<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+e+'" '+(i===P?' stroked="false" ':' strokeWeight="'+a+'px" strokeColor="'+i+'" ')+(n===P?' filled="false"':' fillColor="'+n+'" filled="true" ')+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+s+" l "+r.join(", ")+" "+o+'e"> </v:shape>'},_drawCircle:function(e,t,i,n,a,s,o){return'<v:oval  id="jqsshape'+e+'" '+(a===P?' stroked="false" ':' strokeWeight="'+o+'px" strokeColor="'+a+'" ')+(s===P?' filled="false"':' fillColor="'+s+'" filled="true" ')+' style="position:absolute;top:'+(i-=n)+"px; left:"+(t-=n)+"px; width:"+2*n+"px; height:"+2*n+'px"></v:oval>'},_drawPieSlice:function(e,t,i,n,a,s,o,r){var l,d,h,c;if(a===s)return"";if(s-a==2*H.PI&&(a=0,s=2*H.PI),l=t+H.round(H.cos(a)*n),d=i+H.round(H.sin(a)*n),h=t+H.round(H.cos(s)*n),c=i+H.round(H.sin(s)*n),l===h&&d===c){if(s-a<H.PI)return"";l=h=t+n,d=c=i}return l===h&&d===c&&s-a<H.PI?"":'<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+e+'" '+(o===P?' stroked="false" ':' strokeWeight="1px" strokeColor="'+o+'" ')+(r===P?' filled="false"':' fillColor="'+r+'" filled="true" ')+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+t+","+i+" wa "+[t-n,i-n,t+n,i+n,l,d,h,c].join(", ")+' x e"> </v:shape>'},_drawRect:function(e,t,i,n,a,s,o){return this._drawShape(e,[[t,i],[t,i+a],[t+n,i+a],[t+n,i],[t,i]],s,o)},reset:function(){this.group.innerHTML=""},appendShape:function(e){var t=this["_draw"+e.type].apply(this,e.args);return this.rendered?this.group.insertAdjacentHTML("beforeEnd",t):this.prerender+=t,this.lastShapeId=e.id,e.id},replaceWithShape:function(e,t){e=I("#jqsshape"+e),t=this["_draw"+t.type].apply(this,t.args);e[0].outerHTML=t},replaceWithShapes:function(e,t){for(var i=I("#jqsshape"+e[0]),n="",a=t.length,s=0;s<a;s++)n+=this["_draw"+t[s].type].apply(this,t[s].args);for(i[0].outerHTML=n,s=1;s<e.length;s++)I("#jqsshape"+e[s]).remove()},insertAfterShape:function(e,t){e=I("#jqsshape"+e),t=this["_draw"+t.type].apply(this,t.args);e[0].insertAdjacentHTML("afterEnd",t)},removeShapeId:function(e){e=I("#jqsshape"+e);this.group.removeChild(e[0])},getShapeAt:function(e,t,i){return e.id.substr(8)},render:function(){this.rendered||(this.group.innerHTML=this.prerender,this.rendered=!0)}})},"function"==typeof define&&define.amd?define(["jquery"],e):jQuery&&!jQuery.fn.sparkline&&e(jQuery)}(document,Math),function(){var d=100,h=["#FF9900","#FFFFFF","#B3B4B4","#6B6B6B","#28DE28","#13F7F9","#E6EE18","#C41204","#CA3CB8","#0B1CFB"];function c(i,e,n){function t(e,t){a[t]||(a[t]=[]),a[t].length>=d&&a[t].shift(),a[t].push(Number(e)),(void 0===s||e<s)&&(s=e),(void 0===o||o<e)&&(o=e)}var a=$(i).data().values,s=$(i).data().valueMin,o=$(i).data().valueMax,r=(a||(a=[],o=s=void 0),_.isArray(e)?_.each(e,t):t(e,0),$(i).data().values=a,$(i).data().valueMin=s,$(i).data().valueMax=o,'<span style="color: {{color}}">&#9679;</span> {{y}}'),l=!1;_.each(a,function(e,t){$(i).sparkline(e,{type:"line",composite:l,height:"100%",width:"100%",fillColor:!1,lineColor:h[t%h.length],lineWidth:2,spotRadius:3,spotColor:!1,minSpotColor:"#78AB49",maxSpotColor:"#78AB49",highlightSpotColor:"#9D3926",highlightLineColor:"#9D3926",chartRangeMin:s,chartRangeMax:o,tooltipFormat:n&&n[t]?r+" ("+n[t]+")":r}),l=!0})}function i(e){var l=e,t=$('<div class="tw-display"></div>'),n=$('<h2 class="section-title tw-title tw-td"></h2>'),d=$('<div class="tw-value"></div>'),a=$('<div class="tw-unit"></div>'),h=$('<div class="tw-sparkline tw-td"></div>');function s(){_.isUndefined(l.units)||""==l.units?d.css("max-width","100%"):d.css("max-width",t.innerWidth()-a.outerWidth(!0)+"px")}this.render=function(e){$(e).empty(),$(t).append($('<div class="tw-tr"></div>').append(n)).append($('<div class="tw-tr"></div>').append($('<div class="tw-value-wrapper tw-td"></div>').append(d).append(a))).append($('<div class="tw-tr"></div>').append(h)),$(e).append(t),s()},this.onSettingsChanged=function(e){l=e;var t=!_.isUndefined(e.title)&&""!=e.title,i=!_.isUndefined(e.units)&&""!=e.units,t=(e.sparkline?h.attr("style",null):(delete h.data().values,h.empty(),h.hide()),t?(n.html(_.isUndefined(e.title)?"":e.title),n.attr("style","user-select: none")):(n.empty(),n.hide()),i?(a.html(_.isUndefined(e.units)?"":e.units),a.attr("style","user-select: none")):(a.empty(),a.hide()),30);"big"==e.size&&(t=75,e.sparkline)&&(t=60),d.css({"font-size":t+"px"}),d.css({"user-select":"none"}),s()},this.onSizeChanged=function(){s()},this.onCalculatedValueChanged=function(e,t){var i,n,a,s,o,r;"value"==e&&(l.animate?(i=t,n=d,e=500,(r=$(n).text())!=i&&($.isNumeric(i)&&$.isNumeric(r)?(s=0,1<(a=i.toString().split(".")).length&&(s=a[1].length),o=0,1<(a=r.toString().split(".")).length&&(o=a[1].length),jQuery({transitionValue:Number(r),precisionValue:o}).animate({transitionValue:Number(i),precisionValue:s},{duration:e,step:function(){$(n).text(this.transitionValue.toFixed(this.precisionValue))},done:function(){$(n).text(i)}})):$(n).text(i))):d.text(t),l.sparkline)&&c(h,t)},this.onDispose=function(){},this.getHeight=function(){return"big"==l.size||l.sparkline?2:1},this.onSettingsChanged(e)}function n(e){var i=$('<div class="html-widget"></div>'),t=e;this.render=function(e){$(e).append(i)},this.onSettingsChanged=function(e){t=e},this.onCalculatedValueChanged=function(e,t){"html"==e&&i.html(t)},this.onDispose=function(){},this.getHeight=function(){return Number(t.height)},this.onSettingsChanged(e)}var e=freeboard.getStyleString("values");freeboard.addStyle(".widget-big-text",e+"font-size:75px;"),freeboard.addStyle(".tw-display","width: 100%; height:100%; display:table; table-layout:fixed;"),freeboard.addStyle(".tw-tr","display:table-row;"),freeboard.addStyle(".tw-tg","display:table-row-group;"),freeboard.addStyle(".tw-tc","display:table-caption;"),freeboard.addStyle(".tw-td","display:table-cell;"),freeboard.addStyle(".tw-value",e+"overflow: hidden;display: inline-block;text-overflow: ellipsis;"),freeboard.addStyle(".tw-unit","display: inline-block;padding-left: 10px;padding-bottom: 1.1em;vertical-align: bottom;"),freeboard.addStyle(".tw-value-wrapper","position: relative;vertical-align: middle;height:100%;"),freeboard.addStyle(".tw-sparkline","height:20px;"),freeboard.loadWidgetPlugin({type_name:"text_widget",display_name:"Text",settings:[{name:"title",display_name:"Title",type:"text"},{name:"size",display_name:"Size",type:"option",options:[{name:"Regular",value:"regular"},{name:"Big",value:"big"}]},{name:"value",display_name:"Value",type:"calculated"},{name:"sparkline",display_name:"Include Sparkline",type:"boolean"},{name:"animate",display_name:"Animate Value Changes",type:"boolean",default_value:!0},{name:"units",display_name:"Units",type:"text"}],newInstance:function(e,t){t(new i(e))}}),freeboard.addStyle(".gm-style-cc a","text-shadow:none;"),freeboard.addStyle(".html-widget","white-space:normal;width:100%;height:100%");freeboard.loadWidgetPlugin({type_name:"html",display_name:"HTML",fill_size:!0,settings:[{name:"html",display_name:"HTML",type:"calculated",description:"Can be literal HTML, or javascript that outputs HTML."},{name:"height",display_name:"Height Blocks",type:"number",default_value:4,description:"A height block is around 60 pixels"}],newInstance:function(e,t){t(new n(e))}})}();